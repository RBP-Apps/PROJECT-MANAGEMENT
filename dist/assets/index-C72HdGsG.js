import{i as ts,r as d,j as e,k as ls,L as Ss,O as fe,B as Cs,m as Ds,n as be,p as Is,d as Ps}from"./react-vendor-CxEIhHiJ.js";import{t as As,n as Rs,p as os}from"./vendor-CUoOuhzX.js";import{S as ds,R as xs,T as Fs,C as ms,a as hs,b as ps,P as us,O as bs,c as Ms,L as Bs,d as Ts,e as Os,f as Us,g as Ls,h as zs,I as _s,V as Es,i as $s,j as Vs,k as Js,l as Hs,m as Ks,n as Zs,o as Ws,p as Ys,D as Gs,q as qs,r as Xs,s as Qs,t as ea,u as sa,v as aa}from"./radix-BKu6XTTw.js";import{X as gs,L as ta,G as la,F as fs,S as js,B as ra,W as We,I as na,a as Je,C as Ne,A as qe,b as He,c as as,d as ia,M as ca,e as oa,R as da,T as xa,f as ma,g as ha,h as Ns,i as ws,j as pa,H as Ge,P as _e,k as pe,U as Fe,l as Ze,m as Ke,n as ua,o as ba,E as ga,p as fa,q as ja,r as Na,s as is,t as ys,u as wa,v as ya,w as cs,x as va}from"./lucide-DAwtrf9M.js";(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))_(w);new MutationObserver(w=>{for(const Z of w)if(Z.type==="childList")for(const X of Z.addedNodes)X.tagName==="LINK"&&X.rel==="modulepreload"&&_(X)}).observe(document,{childList:!0,subtree:!0});function C(w){const Z={};return w.integrity&&(Z.integrity=w.integrity),w.referrerPolicy&&(Z.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?Z.credentials="include":w.crossOrigin==="anonymous"?Z.credentials="omit":Z.credentials="same-origin",Z}function _(w){if(w.ep)return;w.ep=!0;const Z=C(w);fetch(w.href,Z)}})();function ka(){const m=ts();return d.useEffect(()=>{m("/login")},[m]),null}function me(...m){return As(Rs(m))}const Sa=os("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function G({className:m,variant:v,size:C,asChild:_=!1,...w}){const Z=_?ds:"button";return e.jsx(Z,{"data-slot":"button",className:me(Sa({variant:v,size:C,className:m})),...w})}function Ca({...m}){return e.jsx(xs,{"data-slot":"sheet",...m})}function Da({...m}){return e.jsx(Fs,{"data-slot":"sheet-trigger",...m})}function Ia({...m}){return e.jsx(us,{"data-slot":"sheet-portal",...m})}function Pa({className:m,...v}){return e.jsx(bs,{"data-slot":"sheet-overlay",className:me("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",m),...v})}function Aa({className:m,children:v,side:C="right",..._}){return e.jsxs(Ia,{children:[e.jsx(Pa,{}),e.jsxs(ms,{"data-slot":"sheet-content",className:me("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",C==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",C==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",C==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",C==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",m),..._,children:[v,e.jsxs(hs,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[e.jsx(gs,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Ra({className:m,...v}){return e.jsx(ps,{"data-slot":"sheet-title",className:me("text-foreground font-semibold",m),...v})}const Fa=[{name:"Dashboard",href:"/dashboard",icon:ta},{name:"Portal",href:"/portal",icon:la},{name:"LOI & MR",href:"/loi-mr",icon:fs},{name:"Sanction",href:"/sanction",icon:js},{name:"Foundation",href:"/foundation",icon:ra},{name:"Installation",href:"/installation",icon:We},{name:"System Info",href:"/system-info",icon:na},{name:"Insurance",href:"/insurance",icon:Je},{name:"JCC Completion",href:"/jcc-completion",icon:Ne},{name:"JCC Status",href:"/jcc-status",icon:qe},{name:"Payment",href:"/payment",icon:He},{name:"Settings",href:"/setting",icon:as}];function vs({className:m,onLinkClick:v}){const C=ls(),_=ts(),[w,Z]=d.useState("");d.useEffect(()=>{const Q=localStorage.getItem("username");Q&&Z(Q)},[]);const X=()=>{localStorage.removeItem("isAuthenticated"),localStorage.removeItem("username"),_("/login")};return e.jsxs("div",{className:me("flex h-full flex-col bg-white shadow-lg border-r border-gray-100",m),children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Panel"}),e.jsxs("p",{className:"text-sm font-medium text-slate-600 mt-2",children:["Welcome back, ",e.jsx("span",{className:"font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent",children:w||"User"}),"!"]})]}),e.jsx("nav",{className:"flex-1 overflow-y-auto p-4 space-y-1",children:Fa.map(Q=>{const f=Q.icon,ne=C.pathname===Q.href;return e.jsxs(Ss,{to:Q.href,onClick:v,className:me("flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium transition-all duration-300 ease-in-out",ne?"bg-cyan-100 text-cyan-700 shadow-sm border border-cyan-200":"text-gray-600 hover:bg-gradient-to-r hover:from-cyan-500 hover:to-blue-600 hover:text-white hover:shadow-md hover:translate-x-1"),children:[e.jsx(f,{className:"h-5 w-5"}),Q.name]},Q.href)})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs(G,{onClick:X,variant:"outline",className:"w-full justify-start gap-3 text-gray-700 border-gray-200 hover:bg-red-50 hover:text-red-600 hover:border-red-200",children:[e.jsx(ia,{className:"h-5 w-5"}),"Logout"]})})]})}function Ie(){return e.jsx("div",{className:"hidden md:flex h-screen w-64 flex-col",children:e.jsx(vs,{})})}function Ma(){const[m,v]=d.useState(!1);return e.jsxs(Ca,{open:m,onOpenChange:v,children:[e.jsx(Da,{asChild:!0,children:e.jsxs(G,{variant:"ghost",size:"icon",className:"md:hidden text-slate-600 hover:bg-blue-100 hover:text-blue-600 transition-colors",children:[e.jsx(ca,{className:"h-6 w-6"}),e.jsx("span",{className:"sr-only",children:"Toggle sidebar"})]})}),e.jsxs(Aa,{side:"left",className:"p-0 w-72",children:[e.jsx(Ra,{className:"sr-only",children:"Navigation Menu"}),e.jsx(vs,{onLinkClick:()=>v(!1)})]})]})}function Pe(){const[m,v]=d.useState("");d.useEffect(()=>{const X=localStorage.getItem("username");X&&v(X)},[]);const C=ls(),_={"/dashboard":{title:"Dashboard",description:"Overview of your project status."},"/portal":{title:"Portal Management",description:"Manage portal entires and data."},"/loi-mr":{title:"LOI & MR Processing",description:"Manage Letters of Intent and Material Receipts for beneficiaries."},"/sanction":{title:"Sanction Order Processing",description:"Manage and approve sanction orders for beneficiaries."},"/foundation":{title:"Foundation Management",description:"Manage foundation work and track material status"},"/installation":{title:"Installation Management",description:"Process and track installation work orders"},"/system-info":{title:"System Information",description:"Record and update system installation details."},"/insurance":{title:"Insurance Management",description:"Manage insurance policies and track beneficiary coverage"},"/jcc-completion":{title:"JCC Completion",description:"Manage Job Completion Certificates and track completion status"},"/jcc-status":{title:"JCC Status Tracking",description:"Track JCC approval status across different offices (DO, RO, ZO, HO)"},"/payment":{title:"Payment Processing",description:"Manage payments, calculate taxes, and track history."}},w=C.pathname,Z=_[w]||{title:"Admin Panel",description:"Welcome back, Admin!"};return e.jsxs("header",{className:"h-20 border-b border-slate-100 bg-white/80 backdrop-blur-md px-6 flex items-center justify-between shadow-sm z-20 sticky top-0 transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ma,{}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-800 tracking-tight leading-tight",children:Z.title}),e.jsx("p",{className:"text-xs text-slate-500 hidden md:block",children:Z.description})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"hidden md:flex flex-col items-end",children:[e.jsx("span",{className:"text-xs font-semibold text-slate-700",children:new Date().toLocaleDateString("en-US",{weekday:"long"})}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),e.jsx("div",{className:"h-9 w-9 rounded-full bg-linear-to-tr from-blue-500 to-cyan-500 p-[2px] shadow-md",children:e.jsx("div",{className:"h-full w-full rounded-full bg-white flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:m?m[0].toUpperCase():"A"})})})]})]})}function Ae({className:m}){return e.jsx("footer",{className:`h-12 border-t border-border bg-card px-6 flex items-center justify-center ${m||""}`,children:e.jsx("p",{className:"text-sm font-bold bg-linear-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent",children:"POWERED BY BOTIVATE"})})}function Re({children:m}){const v=ts(),C=ls();return d.useEffect(()=>{!localStorage.getItem("isAuthenticated")&&C.pathname!=="/login"&&v("/login")},[C.pathname,v]),e.jsx(e.Fragment,{children:m})}function Ba({children:m}){return e.jsx(Re,{children:e.jsxs("div",{className:"flex h-dvh md:h-screen",children:[e.jsx(Ie,{}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden min-h-0",children:[e.jsx(Pe,{}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto bg-gray-50/50 p-6 md:p-8 pt-8 md:pt-10 scroll-smooth",children:e.jsx("div",{className:"mx-auto max-w-7xl animate-in fade-in slide-in-from-bottom-2 duration-500",children:e.jsx(fe,{})})}),e.jsx(Ae,{className:"h-8 md:h-12 shrink-0 bg-gray-50/50"})]})]})})}function Ta({children:m}){return e.jsx(Re,{children:e.jsxs("div",{className:"flex h-dvh md:h-screen",children:[e.jsx(Ie,{}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden min-h-0",children:[e.jsx(Pe,{}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto p-4 md:p-6 bg-background",children:e.jsx(fe,{})}),e.jsx(Ae,{className:"h-8 md:h-12 shrink-0"})]})]})})}function Oa({children:m}){return e.jsx(Re,{children:e.jsxs("div",{className:"flex h-dvh md:h-screen",children:[e.jsx(Ie,{}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden min-h-0",children:[e.jsx(Pe,{}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto p-4 md:p-6 bg-background",children:e.jsx(fe,{})}),e.jsx(Ae,{className:"h-8 md:h-12 shrink-0"})]})]})})}function Ua({children:m}){return e.jsx(Re,{children:e.jsxs("div",{className:"flex h-dvh md:h-screen",children:[e.jsx(Ie,{}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden min-h-0",children:[e.jsx(Pe,{}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto p-4 md:p-6 bg-background",children:e.jsx(fe,{})}),e.jsx(Ae,{className:"h-8 md:h-12 shrink-0"})]})]})})}function La({children:m}){return e.jsx(Re,{children:e.jsxs("div",{className:"flex h-dvh md:h-screen",children:[e.jsx(Ie,{}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden min-h-0",children:[e.jsx(Pe,{}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto p-4 md:p-6 bg-background",children:e.jsx(fe,{})}),e.jsx(Ae,{className:"h-8 md:h-12 shrink-0"})]})]})})}function za({children:m}){return e.jsx(Re,{children:e.jsxs("div",{className:"flex h-dvh md:h-screen",children:[e.jsx(Ie,{}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden min-h-0",children:[e.jsx(Pe,{}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto p-4 md:p-6 bg-background",children:e.jsx(fe,{})}),e.jsx(Ae,{className:"h-8 md:h-12 shrink-0"})]})]})})}function _a({children:m}){return e.jsx(Re,{children:e.jsxs("div",{className:"flex h-dvh md:h-screen",children:[e.jsx(Ie,{}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden min-h-0",children:[e.jsx(Pe,{}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto p-4 md:p-6 bg-background",children:e.jsx(fe,{})}),e.jsx(Ae,{className:"h-8 md:h-12 shrink-0"})]})]})})}function Ea({children:m}){return e.jsx(Re,{children:e.jsxs("div",{className:"flex h-dvh md:h-screen",children:[e.jsx(Ie,{}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden min-h-0",children:[e.jsx(Pe,{}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto p-4 md:p-6 bg-background",children:e.jsx(fe,{})}),e.jsx(Ae,{className:"h-8 md:h-12 shrink-0"})]})]})})}function $a({children:m}){return e.jsx(Re,{children:e.jsxs("div",{className:"flex h-dvh md:h-screen",children:[e.jsx(Ie,{}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden min-h-0",children:[e.jsx(Pe,{}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto p-4 md:p-6 bg-background",children:e.jsx(fe,{})}),e.jsx(Ae,{className:"h-8 md:h-12 shrink-0"})]})]})})}function Va({children:m}){return e.jsx(Re,{children:e.jsxs("div",{className:"flex h-dvh md:h-screen",children:[e.jsx(Ie,{}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden min-h-0",children:[e.jsx(Pe,{}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto p-4 md:p-6 bg-background",children:e.jsx(fe,{})}),e.jsx(Ae,{className:"h-8 md:h-12 shrink-0"})]})]})})}function Ja(){return e.jsx(Re,{children:e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx(Ie,{}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[e.jsx(Pe,{}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-slate-50 p-4 md:p-8",children:e.jsx("div",{className:"mx-auto max-w-6xl animate-in fade-in slide-in-from-bottom-4 duration-500",children:e.jsx(fe,{})})}),e.jsx(Ae,{})]})]})})}function ce({className:m,...v}){return e.jsx("div",{"data-slot":"card",className:me("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",m),...v})}function ge({className:m,...v}){return e.jsx("div",{"data-slot":"card-header",className:me("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",m),...v})}function je({className:m,...v}){return e.jsx("div",{"data-slot":"card-title",className:me("leading-none font-semibold",m),...v})}function oe({className:m,...v}){return e.jsx("div",{"data-slot":"card-content",className:me("px-6",m),...v})}function we({className:m,...v}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto scrollbar-hide min-h-full",children:e.jsx("table",{"data-slot":"table",className:me("w-full caption-bottom text-sm",m),...v})})}function ye({className:m,...v}){return e.jsx("thead",{"data-slot":"table-header",className:me("[&_tr]:border-b",m),...v})}function ve({className:m,...v}){return e.jsx("tbody",{"data-slot":"table-body",className:me("[&_tr:last-child]:border-0",m),...v})}function R({className:m,...v}){return e.jsx("tr",{"data-slot":"table-row",className:me("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",m),...v})}function l({className:m,...v}){return e.jsx("th",{"data-slot":"table-head",className:me("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",m),...v})}function a({className:m,...v}){return e.jsx("td",{"data-slot":"table-cell",className:me("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",m),...v})}const Ha=os("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function $({className:m,variant:v,asChild:C=!1,..._}){const w=C?ds:"span";return e.jsx(w,{"data-slot":"badge",className:me(Ha({variant:v}),m),..._})}function Ka(){const[m,v]=d.useState([]),[C,_]=d.useState({totalProjects:0,totalCapacity:0,totalSanctioned:0,completionRate:0}),[w,Z]=d.useState(!0),[X,Q]=d.useState(null),[f,ne]=d.useState(null),ae=async()=>{Z(!0),Q(null);try{const E="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",re="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",ee=new URLSearchParams({action:"read",sheet:"Project Main",sheetName:"Project Main",id:re.trim()}),D=await fetch(`${E}?${ee.toString()}`);if(!D.ok)throw new Error("Network Error");const le=await D.json(),te=Array.isArray(le)?le:le.data||[];if(te.length===0){v([]),Z(!1);return}let F=-1;const H=["regid","beneficiaryname","village"];for(let j=0;j<Math.min(te.length,10);j++){const J=te[j];if(!Array.isArray(J))continue;const s=J.map(y=>String(y).toLowerCase().replace(/\s+/g,""));if(H.filter(y=>s.includes(y)).length>=2){F=j;break}}F===-1&&te.length>5&&(F=5),(F===-1||!te[F])&&(console.warn("Could not identify header row in Project Main, retrying default index 0"),F=0);const p=te[F].map(j=>String(j).trim()).map(j=>j.toLowerCase()),T=j=>p.findIndex(J=>j.every(s=>J.includes(s))),u={company:T(["company"]),district:T(["district"]),installer:T(["installer"]),pumpType:T(["pump","type"]),sanctionNo:T(["sanction","no"]),fdDispatch:T(["fd","receiving"]),fdDone:T(["actual","3"]),insDispatch:T(["ins","receiving"]),insDone:T(["actual","4"]),payment:T(["payment","done"]),amount:T(["amount"])},W=new Map;let U=0,O=0,q=0;for(let j=F+1;j<te.length;j++){const J=te[j];if(!J)continue;const s=u.company!==-1&&J[u.company]?String(J[u.company]).trim():"Unknown",y=u.district!==-1&&J[u.district]?String(J[u.district]).trim():"Unknown";if(s==="Unknown"&&y==="Unknown")continue;U++;const g=`${s}|${y}`;W.has(g)||W.set(g,{id:g,company:s,district:y,installer:u.installer!==-1&&J[u.installer]?J[u.installer]:"-",capacity:0,target:"-",sanction:0,balance:0,foundationDispatch:0,foundationComplete:0,installationDispatch:0,installationComplete:0,jccRbp:0,jccDoSubmitted:0,jccRo:0,jccRoao:0,jccZo:0,jccHo:0,paymentDone:0});const c=W.get(g);u.sanctionNo!==-1&&J[u.sanctionNo]&&(c.sanction++,O++),u.fdDispatch!==-1&&J[u.fdDispatch]&&c.foundationDispatch++,u.fdDone!==-1&&J[u.fdDone]&&c.foundationComplete++,u.insDispatch!==-1&&J[u.insDispatch]&&c.installationDispatch++,u.insDone!==-1&&J[u.insDone]&&(c.installationComplete++,q++)}const de=Array.from(W.values()),se=U>0?(q/U*100).toFixed(1):0;v(de),_({totalProjects:U,totalCapacity:de.length+" Sites",totalSanctioned:O,completionRate:se}),ne(new Date)}catch(E){console.error("Dashboard fetch error:",E),Q(E.message)}finally{Z(!1)}};return d.useEffect(()=>{ae()},[]),e.jsxs("div",{className:"space-y-6 p-6 md:p-8 animate-fade-in-up min-h-screen bg-slate-50/50",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-700 to-cyan-600 bg-clip-text text-transparent",children:"Project Dashboard"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Real-time analytics aggregated from Project Main"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f&&e.jsxs("span",{className:"text-xs text-slate-400 mr-2 flex items-center gap-1",children:[e.jsx(oa,{className:"h-3 w-3"})," Updated: ",f.toLocaleTimeString()]}),e.jsxs(G,{onClick:ae,disabled:w,variant:"outline",className:"border-slate-200 hover:bg-white hover:text-blue-600 hover:border-blue-300 hover:shadow-md transition-all duration-300",children:[e.jsx(da,{className:me("h-4 w-4 mr-2",w&&"animate-spin")}),"Refresh Data"]})]})]}),e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(ce,{className:"border-l-4 border-l-blue-500 border-y border-r border-blue-50 shadow-sm bg-white/80 backdrop-blur hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-default group",children:[e.jsxs(ge,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(je,{className:"text-sm font-medium text-slate-500",children:"Total Beneficiaries"}),e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(fs,{className:"h-4 w-4 text-blue-600"})})]}),e.jsxs(oe,{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:w?"...":C.totalProjects}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Total registered projects"})]})]}),e.jsxs(ce,{className:"border-l-4 border-l-purple-500 border-y border-r border-purple-50 shadow-sm bg-white/80 backdrop-blur hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-default group",children:[e.jsxs(ge,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(je,{className:"text-sm font-medium text-slate-500",children:"Active Companies"}),e.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:e.jsx(qe,{className:"h-4 w-4 text-purple-600"})})]}),e.jsxs(oe,{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:w?"...":m.length}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Operating districts"})]})]}),e.jsxs(ce,{className:"border-l-4 border-l-green-500 border-y border-r border-green-50 shadow-sm bg-white/80 backdrop-blur hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-default group",children:[e.jsxs(ge,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(je,{className:"text-sm font-medium text-slate-500",children:"Sanctioned"}),e.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:e.jsx(Ne,{className:"h-4 w-4 text-green-600"})})]}),e.jsxs(oe,{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:w?"...":C.totalSanctioned}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Total sanctioned units"})]})]}),e.jsxs(ce,{className:"border-l-4 border-l-orange-500 border-y border-r border-orange-50 shadow-sm bg-white/80 backdrop-blur hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-default group",children:[e.jsxs(ge,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(je,{className:"text-sm font-medium text-slate-500",children:"Completion Rate"}),e.jsx("div",{className:"p-2 bg-orange-50 rounded-lg",children:e.jsx(xa,{className:"h-4 w-4 text-orange-600"})})]}),e.jsxs(oe,{children:[e.jsxs("div",{className:"text-2xl font-bold text-slate-800",children:[w?"...":C.completionRate,"%"]}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Installation complete"})]})]})]}),e.jsxs(ce,{className:"border border-slate-200 shadow-lg shadow-slate-200/50 bg-white overflow-hidden",children:[e.jsx(ge,{className:"border-b border-slate-100 bg-slate-50/50 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(je,{className:"text-lg font-semibold text-slate-800",children:"Master Tracking Sheet"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Auto-aggregated by Company & District from source data"})]}),e.jsxs($,{variant:"secondary",className:"bg-white border-slate-200 text-slate-600",children:[e.jsx(ma,{className:"h-3 w-3 mr-1 text-green-500"})," Live Data"]})]})}),e.jsx(oe,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-track]:bg-slate-50 [&::-webkit-scrollbar-thumb]:bg-slate-200 [&::-webkit-scrollbar-thumb]:rounded-full hover:[&::-webkit-scrollbar-thumb]:bg-slate-300",children:e.jsxs(we,{className:"w-full text-sm text-left border-collapse",children:[e.jsx(ye,{className:"bg-slate-50/80 sticky top-0 z-10 shadow-sm",children:e.jsxs(R,{className:"border-b border-slate-200 hover:bg-transparent",children:[e.jsx(l,{className:"h-12 px-4 font-bold text-slate-600 text-xs uppercase tracking-wider whitespace-nowrap bg-slate-50/90 backdrop-blur border-r border-slate-200/50 min-w-[150px]",children:"Company"}),e.jsx(l,{className:"h-12 px-4 font-bold text-slate-600 text-xs uppercase tracking-wider whitespace-nowrap bg-slate-50/90 backdrop-blur border-r border-slate-200/50 min-w-[120px]",children:"District"}),e.jsx(l,{className:"h-12 px-4 font-bold text-slate-600 text-xs uppercase tracking-wider whitespace-nowrap bg-slate-50/90 backdrop-blur border-r border-slate-200/50 min-w-[120px]",children:"Installer"}),e.jsx(l,{className:"h-12 px-4 font-bold text-slate-600 text-xs uppercase tracking-wider whitespace-nowrap bg-slate-50/90 backdrop-blur border-r border-slate-200/50 text-center min-w-[80px]",children:"Target"}),e.jsx(l,{className:"h-12 px-4 font-bold text-slate-600 text-xs uppercase tracking-wider whitespace-nowrap bg-slate-50/90 backdrop-blur border-r border-slate-200/50 text-center min-w-[80px]",children:"Sanction"}),e.jsx(l,{className:"h-12 px-4 font-bold text-slate-600 text-xs uppercase tracking-wider whitespace-nowrap bg-slate-50/90 backdrop-blur border-r border-slate-200/50 text-center min-w-[80px]",children:"Balance"}),e.jsx(l,{className:"h-12 px-2 font-bold text-blue-700 text-xs uppercase tracking-wider whitespace-nowrap bg-blue-50/50 border-r border-blue-100 text-center min-w-[100px]",children:"Fnd. Dispatch"}),e.jsx(l,{className:"h-12 px-2 font-bold text-blue-700 text-xs uppercase tracking-wider whitespace-nowrap bg-blue-50/50 border-r border-slate-200/50 text-center min-w-[100px]",children:"Fnd. Complete"}),e.jsx(l,{className:"h-12 px-2 font-bold text-purple-700 text-xs uppercase tracking-wider whitespace-nowrap bg-purple-50/50 border-r border-purple-100 text-center min-w-[100px]",children:"Inst. Dispatch"}),e.jsx(l,{className:"h-12 px-2 font-bold text-purple-700 text-xs uppercase tracking-wider whitespace-nowrap bg-purple-50/50 border-r border-slate-200/50 text-center min-w-[100px]",children:"Inst. Complete"}),e.jsx(l,{className:"h-12 px-4 font-bold text-emerald-700 text-xs uppercase tracking-wider whitespace-nowrap bg-emerald-50/50 text-center min-w-[100px]",children:"Payment Done"})]})}),e.jsx(ve,{children:w?Array.from({length:10}).map((E,re)=>e.jsx(R,{className:"animate-pulse border-b border-slate-100",children:Array.from({length:11}).map((ee,D)=>e.jsx(a,{className:"p-3",children:e.jsx("div",{className:"h-4 bg-slate-100 rounded w-full"})},D))},re)):X?e.jsx(R,{children:e.jsx(a,{colSpan:11,className:"h-64 text-center text-red-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(ha,{className:"h-8 w-8"}),e.jsx("p",{children:X}),e.jsx(G,{variant:"outline",size:"sm",onClick:ae,className:"mt-2",children:"Try Again"})]})})}):m.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:11,className:"h-64 text-center text-slate-400",children:"No data found in Project Main."})}):m.map(E=>e.jsxs(R,{className:"group hover:bg-blue-50/50 transition-all duration-200 border-b border-slate-100 last:border-0 hover:shadow-sm cursor-default",children:[e.jsx(a,{className:"font-medium text-slate-800 border-r border-slate-100",children:E.company}),e.jsx(a,{className:"text-slate-600 border-r border-slate-100",children:E.district}),e.jsx(a,{className:"text-slate-600 border-r border-slate-100",children:E.installer}),e.jsx(a,{className:"text-slate-400 text-center border-r border-slate-100 font-mono text-xs",children:"-"})," ",e.jsx(a,{className:"text-blue-600 font-semibold text-center border-r border-slate-100 font-mono text-xs bg-blue-50/30",children:E.sanction}),e.jsx(a,{className:"text-slate-400 text-center border-r border-slate-100 font-mono text-xs",children:"-"})," ",e.jsx(a,{className:"text-center border-r border-slate-100 text-slate-600 text-xs",children:E.foundationDispatch}),e.jsx(a,{className:"text-center border-r border-slate-100 text-slate-600 text-xs bg-green-50/20",children:E.foundationComplete}),e.jsx(a,{className:"text-center border-r border-slate-100 text-slate-600 text-xs",children:E.installationDispatch}),e.jsx(a,{className:"text-center border-r border-slate-100 text-slate-600 text-xs bg-green-50/20",children:E.installationComplete}),e.jsx(a,{className:"text-center font-bold text-emerald-600 bg-emerald-50/30",children:E.paymentDone})]},E.id))})]})})})]})]})}function Ee({className:m,...v}){return e.jsx(Ms,{"data-slot":"tabs",className:me("flex flex-col gap-2",m),...v})}function $e({className:m,...v}){return e.jsx(Bs,{"data-slot":"tabs-list",className:me("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",m),...v})}function Se({className:m,...v}){return e.jsx(Ts,{"data-slot":"tabs-trigger",className:me("data-[state=active]:bg-blue-100 data-[state=active]:text-blue-900 dark:data-[state=active]:bg-blue-900 dark:data-[state=active]:text-blue-100 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",m),...v})}function Ce({className:m,...v}){return e.jsx(Os,{"data-slot":"tabs-content",className:me("flex-1 outline-none",m),...v})}function z({className:m,type:v,...C}){return e.jsx("input",{type:v,"data-slot":"input",suppressHydrationWarning:!0,className:me("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",m),...C})}function M({className:m,...v}){return e.jsx(Us,{"data-slot":"label",className:me("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",m),...v})}function Xe({...m}){return e.jsx(Ls,{"data-slot":"select",...m})}function Qe({...m}){return e.jsx(Es,{"data-slot":"select-value",...m})}function es({className:m,size:v="default",children:C,..._}){return e.jsxs(zs,{"data-slot":"select-trigger","data-size":v,className:me("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",m),..._,children:[C,e.jsx(_s,{asChild:!0,children:e.jsx(Ns,{className:"size-4 opacity-50"})})]})}function ss({className:m,children:v,position:C="popper",..._}){return e.jsx($s,{children:e.jsxs(Vs,{"data-slot":"select-content",className:me("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",C==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",m),position:C,..._,children:[e.jsx(Za,{}),e.jsx(Js,{className:me("p-1",C==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:v}),e.jsx(Wa,{})]})})}function Me({className:m,children:v,...C}){return e.jsxs(Hs,{"data-slot":"select-item",className:me("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",m),...C,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(Ks,{children:e.jsx(ws,{className:"size-4"})})}),e.jsx(Zs,{children:v})]})}function Za({className:m,...v}){return e.jsx(Ws,{"data-slot":"select-scroll-up-button",className:me("flex cursor-default items-center justify-center py-1",m),...v,children:e.jsx(pa,{className:"size-4"})})}function Wa({className:m,...v}){return e.jsx(Ys,{"data-slot":"select-scroll-down-button",className:me("flex cursor-default items-center justify-center py-1",m),...v,children:e.jsx(Ns,{className:"size-4"})})}function Be({...m}){return e.jsx(xs,{"data-slot":"dialog",...m})}function Ya({...m}){return e.jsx(us,{"data-slot":"dialog-portal",...m})}function Ga({className:m,...v}){return e.jsx(bs,{"data-slot":"dialog-overlay",className:me("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",m),...v})}function Te({className:m,children:v,showCloseButton:C=!0,..._}){return e.jsxs(Ya,{"data-slot":"dialog-portal",children:[e.jsx(Ga,{}),e.jsxs(ms,{"data-slot":"dialog-content",className:me("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",m),..._,children:[v,C&&e.jsxs(hs,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(gs,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Oe({className:m,...v}){return e.jsx("div",{"data-slot":"dialog-header",className:me("flex flex-col gap-2 text-center sm:text-left",m),...v})}function Ue({className:m,...v}){return e.jsx(ps,{"data-slot":"dialog-title",className:me("text-lg leading-none font-semibold",m),...v})}function Le({className:m,...v}){return e.jsx(Gs,{"data-slot":"dialog-description",className:me("text-muted-foreground text-sm",m),...v})}function ze({className:m,...v}){return e.jsx(qs,{"data-slot":"checkbox",className:me("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",m),...v,children:e.jsx(Xs,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(ws,{className:"size-3.5"})})})}function qa(){const[m,v]=d.useState("pending"),[C,_]=d.useState(!1),[w,Z]=d.useState([]),[X,Q]=d.useState([]),[f,ne]=d.useState(null),[ae,E]=d.useState(!1),[re,ee]=d.useState(!1),[D,le]=d.useState([]),[te,F]=d.useState(!1),H=(t,P)=>{le(P?A=>[...A,t]:A=>A.filter(b=>b!==t))},[k,p]=d.useState({fdMaterialAgeing:"",fdMaterialReceivingDate:"",challanLink:null,foundationStatus:"",foundationCompletionDate:"",fdPhotoOkDate:""}),[T,u]=d.useState(!0),[W,U]=d.useState({}),[O,q]=d.useState({}),de=async()=>{u(!0);try{const t="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",P="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",A=new URLSearchParams({action:"read",sheet:"Project Main",sheetName:"Project Main",id:P.trim()}),b=await fetch(`${t}?${A.toString()}`);if(!b.ok)throw new Error("Network Error");const o=await b.json(),x=Array.isArray(o)?o:o.data||[];if(x.length===0){Z([]),Q([]),u(!1);return}let S=-1;const Y=["regid","beneficiaryname","village"];for(let L=0;L<Math.min(x.length,10);L++){const K=x[L];if(!Array.isArray(K))continue;const he=K.map(xe=>String(xe).toLowerCase().replace(/\s+/g,""));if(Y.filter(xe=>he.includes(xe)).length>=2){S=L;break}}if(S===-1&&x.length>5&&(S=5),S===-1||!x[S]){console.error("Could not identify header row"),u(!1);return}const r=x[S].map(L=>String(L).trim()),n=r.map(L=>L.toLowerCase()),i=L=>n.findIndex(K=>L.every(he=>K.includes(he))),h={serialNo:i(["serial"]),regId:i(["reg","id"]),beneficiaryName:i(["beneficiary","name"]),fatherName:i(["father"]),village:i(["village"]),block:i(["block"]),district:i(["district"]),category:i(["category"]),pumpSource:i(["pump","source"]),pumpType:i(["pump","type"]),company:i(["company"]),installer:i(["installer"]),otherRemark:i(["remark"]),loiDocument:i(["loi","file"]),mrNo:i(["mr","no"]),mrDate:i(["mr","date"]),amount:i(["amount"]),paidBy:i(["paid","by"]),beneficiaryShare:i(["share"]),sanctionNo:i(["sanction","no"]),sanctionDate:i(["sanction","date"]),fdMaterialAgeing:i(["fd","material","ageing"]),fdMaterialReceivingDate:i(["fd","material","receiving"]),challanLink:i(["challan"]),foundationStatus:(()=>{const L=i(["foundation","status"]);return L!==-1?L:i(["fd","status"])})(),foundationCompletionDate:(()=>{const L=i(["foundation","completion"]);return L!==-1?L:i(["fd","completion"])})(),fdPhotoOkDate:i(["fd","photo"]),actual2:i(["actual","2"]),planned1:i(["planned","1"]),actual1:i(["actual","1"]),delay1:i(["delay","1"]),planned2:i(["planned","2"]),delay2:i(["delay","2"]),planned3:i(["planned","3"]),actual3:i(["actual","3"]),delay3:i(["delay","3"])},V={};Object.keys(h).forEach(L=>{h[L]!==-1&&(V[L]=r[h[L]])}),U(V),q(h);const I=[],N=[];for(let L=S+1;L<x.length;L++){const K=x[L];if(!K||K.length===0||h.regId===-1||!K[h.regId])continue;const he={serialNo:K[h.serialNo]||"-",regId:K[h.regId]||"-",beneficiaryName:K[h.beneficiaryName]||"-",fatherName:K[h.fatherName]||"-",village:K[h.village]||"-",block:K[h.block]||"-",district:K[h.district]||"-",category:K[h.category]||"-",pumpSource:K[h.pumpSource]||"-",pumpType:K[h.pumpType]||"-",company:K[h.company]||"-",installer:K[h.installer]||"-",otherRemark:K[h.otherRemark]||"",loiFileName:K[h.loiDocument]||"",mrNo:K[h.mrNo]||"-",mrDate:K[h.mrDate]||"-",amount:K[h.amount]||"-",paidBy:K[h.paidBy]||"-",beneficiaryShare:K[h.beneficiaryShare]||"-",sanctionNo:K[h.sanctionNo]||"",sanctionDate:K[h.sanctionDate]||"",fdMaterialAgeing:K[h.fdMaterialAgeing]||"",fdMaterialReceivingDate:K[h.fdMaterialReceivingDate]||"",challanLink:K[h.challanLink]||"",foundationStatus:K[h.foundationStatus]||"",foundationCompletionDate:K[h.foundationCompletionDate]||"",fdPhotoOkDate:K[h.fdPhotoOkDate]||"",actual2:K[h.actual2],planned1:K[h.planned1],actual1:K[h.actual1],delay1:K[h.delay1],planned2:K[h.planned2],delay2:K[h.delay2],planned3:K[h.planned3],actual3:K[h.actual3],delay3:K[h.delay3],rowIndex:L+1},xe=he.planned3&&String(he.planned3).trim()!=="";he.actual3&&String(he.actual3).trim()!==""?N.push(he):xe&&I.push(he)}Z(I),Q(N)}catch(t){console.error("Error fetching data:",t)}finally{u(!1)}};d.useEffect(()=>{de()},[]),d.useEffect(()=>{if(C){const t=setTimeout(()=>{E(!1),setTimeout(()=>_(!1),300)},2e3);return()=>clearTimeout(t)}},[C]);const se=t=>{ne(t),F(!1),_(!1),p({fdMaterialAgeing:"",fdMaterialReceivingDate:"",challanLink:null,foundationStatus:"",foundationCompletionDate:"",fdPhotoOkDate:""}),E(!0)},j=()=>{D.length<2||(ne(null),F(!0),_(!1),p({fdMaterialAgeing:"",fdMaterialReceivingDate:"",challanLink:null,foundationStatus:"",foundationCompletionDate:"",fdPhotoOkDate:""}),E(!0))},J=t=>{t.target.files&&t.target.files[0]&&p({...k,challanLink:t.target.files[0].name,challanFileObj:t.target.files[0]})},s=t=>new Promise((P,A)=>{const b=new FileReader;b.readAsDataURL(t),b.onload=()=>P(b.result.split(",")[1]),b.onerror=o=>A(o)}),y=t=>{if(!t||t.includes("/preview"))return t;const P=t.match(/[-\w]{25,}/);return P?`https://drive.google.com/file/d/${P[0]}/preview`:t},[g,c]=d.useState(!1),B=async()=>{if(!(!f&&!te)){c(!0);try{const t="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",P="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo";let A="";if(k.challanFileObj){const Y=await s(k.challanFileObj),r="1pqyJUlUD0zwnojUvNezJgxzim8gjUfmM",n=new URLSearchParams({action:"uploadFile",base64Data:Y,fileName:k.challanFileObj.name,mimeType:k.challanFileObj.type,folderId:r||"1pqyJUlUD0zwnojUvNezJgxzim8gjUfmM"}),h=await(await fetch(t,{method:"POST",body:n})).json();if(h.success&&h.fileUrl)A=h.fileUrl;else throw new Error("File upload failed")}const b=te?w.filter(Y=>D.includes(Y.serialNo)):[f],o=new Date,x=`${o.getFullYear()}/${String(o.getMonth()+1).padStart(2,"0")}/${String(o.getDate()).padStart(2,"0")} ${String(o.getHours()).padStart(2,"0")}:${String(o.getMinutes()).padStart(2,"0")}:${String(o.getSeconds()).padStart(2,"0")}`,S=b.map(async Y=>{const r={},n=(h,V)=>{const I=O[h];I!==void 0&&I>=0&&V!==void 0&&V!==null&&V!==""&&(r[I]=V)};n("fdMaterialAgeing",k.fdMaterialAgeing),n("fdMaterialReceivingDate",k.fdMaterialReceivingDate),n("foundationStatus",k.foundationStatus),n("foundationCompletionDate",k.foundationCompletionDate),n("fdPhotoOkDate",k.fdPhotoOkDate),n("actual3",x),A&&n("challanLink",A);const i=new URLSearchParams({action:"update",sheetName:"Project Main",id:P,rowIndex:Y.rowIndex,rowData:JSON.stringify(r)});return fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()})});await Promise.all(S),await de(),_(!0),te&&le([])}catch(t){console.error("Submission error:",t),alert("Failed to submit data: "+t.message)}finally{c(!1)}}};return e.jsxs("div",{className:"space-y-8 p-6 md:p-8 max-w-[1600px] mx-auto bg-slate-50/50 min-h-screen animate-fade-in-up",children:[e.jsxs(Ee,{defaultValue:"pending",className:"w-full",onValueChange:v,children:[e.jsxs($e,{className:"grid w-full grid-cols-2 relative p-1 bg-slate-100/80 h-14 rounded-xl border border-slate-200",children:[e.jsx("div",{className:`absolute top-1 bottom-1 left-1 w-[calc(50%-0.5rem)] rounded-lg bg-white shadow-sm transition-all duration-300 ease-in-out ${m==="history"?"translate-x-full":"translate-x-0"}`}),e.jsx(Se,{value:"pending",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Pending Actions"}),e.jsx(Se,{value:"history",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"History & Records"})]}),e.jsx(Ce,{value:"pending",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-left-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(Ge,{className:"h-4 w-4 text-blue-600"})}),"Pending Foundation"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[D.length>=2&&e.jsxs(G,{onClick:j,className:"bg-blue-600 hover:bg-blue-700 text-white shadow-md shadow-blue-200 transition-all duration-300 animate-in fade-in slide-in-from-right-4",size:"sm",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Foundation Selected (",D.length,")"]}),e.jsxs($,{variant:"outline",className:"bg-yellow-100 text-yellow-700 border-yellow-200 px-3 py-1",children:[w.length," Pending"]})]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-4 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap w-12",children:"Select"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap min-w-[150px]",children:"Action"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Father's Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Block"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Category"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Source"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Type"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Installer"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Other Remark"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"LOI Document"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Paid By"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Share"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Sanction No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Sanction Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:T?Array.from({length:6}).map((t,P)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:23}).map((A,b)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded mx-auto"})},b))},`pending-skeleton-${P}`)):w.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:23,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(Ge,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No pending foundation requests found"})]})})}):w.map(t=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"px-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(ze,{checked:D.includes(t.serialNo),onCheckedChange:P=>H(t.serialNo,P),"aria-label":`Select row ${t.serialNo}`,className:"checkbox-3d border-slate-400 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 h-5 w-5 shadow-sm transition-all duration-300 ease-out active:scale-75 hover:scale-110 data-[state=checked]:scale-110"})})}),e.jsx(a,{children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>se(t),disabled:D.length>=2,className:"bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white border border-blue-200 shadow-xs text-xs font-semibold h-8 px-4 rounded-full flex items-center gap-2 transition-all duration-300 mx-auto disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ge,{className:"h-3.5 w-3.5"}),"Process"]})}),e.jsx(a,{className:"whitespace-nowrap font-mono text-xs text-slate-500 bg-slate-50 py-1 px-2 rounded-md mx-auto w-fit",children:t.regId}),e.jsx(a,{className:"whitespace-nowrap font-medium text-slate-800",children:t.beneficiaryName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.fatherName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.village}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.block}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.district}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.category}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.pumpSource}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.pumpType}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.company}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.installer}),e.jsx(a,{className:"whitespace-nowrap text-slate-500 italic",children:t.otherRemark||"-"}),e.jsx(a,{className:"whitespace-nowrap",children:t.loiFileName?t.loiFileName.startsWith("http")?e.jsxs("a",{href:y(t.loiFileName),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-xs flex items-center justify-center gap-1",children:[e.jsx(pe,{className:"h-4 w-4"}),"Preview"]}):e.jsx("span",{className:"text-slate-600 text-xs",children:t.loiFileName}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.mrNo}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.mrDate}),e.jsxs(a,{className:"whitespace-nowrap font-medium text-slate-700",children:["",t.amount]}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.paidBy}),e.jsx(a,{className:"whitespace-nowrap text-slate-500",children:t.beneficiaryShare||"-"}),e.jsx(a,{className:"whitespace-nowrap font-medium",children:t.sanctionNo?e.jsx("span",{className:"font-mono bg-orange-50 px-2 py-0.5 rounded border border-orange-100 text-orange-700",children:t.sanctionNo}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.sanctionDate}),e.jsx(a,{children:e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Pending"})})]},t.serialNo))})]})}),e.jsx("div",{className:"md:hidden space-y-4 p-4 bg-slate-50",children:w.map(t=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{variant:"secondary",className:"bg-slate-100 text-slate-600",children:t.serialNo}),e.jsx("h4",{className:"font-semibold text-base text-slate-800",children:t.beneficiaryName}),e.jsx("p",{className:"text-muted-foreground text-xs font-mono",children:t.regId})]}),e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200 text-xs",children:"Pending"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3 text-xs border-t border-b py-3 my-2 border-slate-100",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Father's Name"}),e.jsx("span",{className:"font-medium text-slate-700",children:t.fatherName})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Sanction No"}),e.jsx("span",{className:"font-medium text-orange-600 font-mono",children:t.sanctionNo||"-"})]})]}),e.jsxs(G,{size:"sm",disabled:D.length>=2,className:"w-full bg-linear-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-md disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>se(t),children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Process Foundation"]})]})},t.serialNo))})]})]})}),e.jsx(Ce,{value:"history",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-right-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(pe,{className:"h-4 w-4 text-blue-600"})}),"Foundation History"]}),e.jsxs($,{variant:"outline",className:"bg-blue-100 text-blue-700 border-blue-200 px-3 py-1",children:[X.length," Records"]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Father's Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Block"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Category"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Source"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Type"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Installer"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Other Remark"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap min-w-[200px]",children:"LOI Document"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Paid By"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Share"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Sanction No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Sanction Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"FD Material Ageing"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"FD Material Receiving Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap min-w-[200px]",children:"Challan Link"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Foundation Status"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"FD Completion Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"FD Photo OK Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:T?Array.from({length:6}).map((t,P)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:28}).map((A,b)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded mx-auto"})},b))},`history-skeleton-${P}`)):X.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:28,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:"No foundation history found."})}):X.map(t=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"whitespace-nowrap font-mono text-xs text-slate-500 bg-slate-50 py-1 px-2 rounded-md mx-auto w-fit",children:t.regId}),e.jsx(a,{className:"whitespace-nowrap font-medium text-slate-800",children:t.beneficiaryName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.fatherName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.village}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.block}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.district}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.category}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.pumpSource}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.pumpType}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.company}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.installer}),e.jsx(a,{className:"whitespace-nowrap text-slate-500 italic",children:t.otherRemark||"-"}),e.jsx(a,{className:"whitespace-nowrap",children:t.loiFileName?t.loiFileName.startsWith("http")?e.jsxs("a",{href:y(t.loiFileName),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-xs flex items-center justify-center gap-1",children:[e.jsx(pe,{className:"h-4 w-4"}),"View Document"]}):e.jsx("span",{className:"text-slate-600 text-xs",children:t.loiFileName}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.mrNo}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.mrDate}),e.jsxs(a,{className:"whitespace-nowrap font-medium text-slate-700",children:["",t.amount]}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.paidBy}),e.jsx(a,{className:"whitespace-nowrap text-slate-500",children:t.beneficiaryShare||"-"}),e.jsx(a,{className:"whitespace-nowrap",children:t.sanctionNo?e.jsx("span",{className:"font-mono bg-orange-50 px-2 py-0.5 rounded border border-orange-100 text-orange-700",children:t.sanctionNo}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.sanctionDate}),e.jsx(a,{className:"whitespace-nowrap bg-green-50/50 text-green-700 font-medium",children:t.fdMaterialAgeing}),e.jsx(a,{className:"whitespace-nowrap bg-green-50/30 text-slate-700",children:t.fdMaterialReceivingDate}),e.jsx(a,{className:"whitespace-nowrap bg-blue-50/30",children:t.challanLink?t.challanLink.startsWith("http")?e.jsxs("a",{href:y(t.challanLink),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-xs flex items-center justify-center gap-1",children:[e.jsx(pe,{className:"h-4 w-4"}),"View Challan"]}):e.jsx("span",{className:"text-slate-600 text-xs",children:t.challanLink}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{className:"whitespace-nowrap bg-green-50/50 font-bold",children:e.jsx($,{variant:"outline",className:`
                              ${t.foundationStatus==="Completed"?"bg-green-100 text-green-700 border-green-200":""}
                              ${t.foundationStatus==="In Progress"?"bg-blue-100 text-blue-700 border-blue-200":""}
                              ${t.foundationStatus==="Pending"?"bg-yellow-100 text-yellow-700 border-yellow-200":""}
                              ${t.foundationStatus==="On Hold"?"bg-red-100 text-red-700 border-red-200":""}
                              ${["Completed","In Progress","Pending","On Hold"].includes(t.foundationStatus)?"":"bg-slate-100 text-slate-700 border-slate-200"}
                            `,children:t.foundationStatus})}),e.jsx(a,{className:"whitespace-nowrap bg-green-50/30 text-slate-700",children:t.foundationCompletionDate}),e.jsx(a,{className:"whitespace-nowrap bg-green-50/30 text-slate-700",children:t.fdPhotoOkDate}),e.jsx(a,{className:"whitespace-nowrap",children:e.jsx($,{className:"bg-teal-100 text-teal-800 hover:bg-teal-200 border-teal-200",children:"Completed"})})]},t.serialNo))})]})}),e.jsx("div",{className:"md:hidden space-y-4 p-4 bg-slate-50",children:X.map(t=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{variant:"secondary",className:"bg-slate-100 text-slate-600",children:t.serialNo}),e.jsx("h4",{className:"font-semibold text-base text-slate-800",children:t.beneficiaryName}),e.jsx("p",{className:"text-muted-foreground text-xs font-mono",children:t.regId})]}),e.jsx($,{className:"bg-teal-100 text-teal-800 border-teal-200 text-xs",children:"Completed"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3 text-xs border-t border-b py-3 my-2 border-slate-100",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:e.jsx($,{variant:"outline",className:`
                              ${t.foundationStatus==="Completed"?"bg-green-100 text-green-700 border-green-200":""}
                              ${t.foundationStatus==="In Progress"?"bg-blue-100 text-blue-700 border-blue-200":""}
                              ${t.foundationStatus==="Pending"?"bg-yellow-100 text-yellow-700 border-yellow-200":""}
                              ${t.foundationStatus==="On Hold"?"bg-red-100 text-red-700 border-red-200":""}
                              ${["Completed","In Progress","Pending","On Hold"].includes(t.foundationStatus)?"":"bg-slate-100 text-slate-700 border-slate-200"}
                            `,children:t.foundationStatus})})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Completed On"}),e.jsx("span",{className:"font-medium text-slate-700",children:t.foundationCompletionDate})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"FD Ageing"}),e.jsx("span",{className:"font-medium text-slate-700",children:t.fdMaterialAgeing})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Material Rcvd"}),e.jsx("span",{className:"font-medium text-slate-700",children:t.fdMaterialReceivingDate})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase block mb-1 font-semibold",children:"Challan Document"}),t.challanLink&&t.challanLink.startsWith("http")?e.jsxs("a",{href:y(t.challanLink),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline cursor-pointer flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3"}),"View Challan (File)"]}):e.jsx("span",{className:"text-gray-400 italic",children:t.challanLink?t.challanLink:"No document"})]})]})]})},t.serialNo))})]})]})})]}),e.jsx(Be,{open:ae,onOpenChange:E,children:e.jsx(Te,{showCloseButton:!C,className:`max-w-4xl max-h-[90vh] overflow-y-auto p-0 gap-0 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none] ${C?"bg-transparent !shadow-none !border-none":""}`,children:C?e.jsxs("div",{className:"flex flex-col items-center justify-center w-full p-8 text-center space-y-6 animate-in fade-in duration-300",children:[e.jsx("div",{className:"rounded-full bg-white p-5 shadow-2xl shadow-white/20 ring-8 ring-white/10 animate-in zoom-in duration-500 ease-out",children:e.jsx(Ne,{className:"h-16 w-16 text-green-600 scale-110"})}),e.jsx("h2",{className:"text-3xl font-bold text-white drop-shadow-md animate-in slide-in-from-bottom-4 fade-in duration-500 delay-150 ease-out tracking-wide",children:"Submitted Successfully!"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{className:"p-6 pb-2 border-b border-blue-100 bg-blue-50/30",children:[e.jsxs(Ue,{className:"text-xl font-bold bg-linear-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 p-1.5 rounded-md",children:e.jsx(Ge,{className:"h-4 w-4 text-blue-600"})}),"Process Foundation Work"]}),e.jsx(Le,{className:"text-slate-500 ml-10",children:te?e.jsxs("span",{children:["Applying changes to ",e.jsxs("span",{className:"font-bold text-blue-700",children:[D.length," selected items"]}),". All fields below will be updated for these items."]}):e.jsxs("span",{children:["Processing foundation for ",e.jsx("span",{className:"font-semibold text-slate-700",children:f==null?void 0:f.beneficiaryName})," ",e.jsx("span",{className:"font-mono text-xs bg-slate-100 px-1 py-0.5 rounded text-slate-600 border border-slate-200",children:f==null?void 0:f.serialNo})]})})]}),(f||te)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 space-y-6",children:[!te&&f&&e.jsxs("div",{className:"rounded-xl border border-blue-100 bg-linear-to-br from-blue-50/50 to-cyan-50/30 p-5 shadow-sm",children:[e.jsxs("h3",{className:"text-sm font-bold text-blue-900 mb-4 flex items-center gap-2 border-b border-blue-100 pb-2",children:[e.jsx("span",{className:"bg-white p-1 rounded shadow-sm",children:e.jsx(Ne,{className:"h-4 w-4 text-blue-500"})}),"BENEFICIARY DETAILS"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-y-5 gap-x-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Reg ID"}),e.jsx("div",{className:"font-medium text-slate-700 font-mono bg-white/50 px-2 py-1 rounded border border-blue-100/50 inline-block",children:f.regId})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Father's Name"}),e.jsx("p",{className:"font-medium text-slate-700",children:f.fatherName})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Village & Block"}),e.jsxs("p",{className:"font-medium text-slate-700",children:[f.village,", ",f.block]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"District"}),e.jsx("p",{className:"font-medium text-slate-700",children:f.district})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Sanction No"}),e.jsx("p",{className:"font-medium text-orange-600 font-mono",children:f.sanctionNo||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Sanction Date"}),e.jsx("p",{className:"font-medium text-slate-700",children:f.sanctionDate||"-"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-5 w-1 bg-cyan-500 rounded-full"}),e.jsx("h3",{className:"text-sm font-bold text-slate-800 uppercase tracking-wide",children:"Work Details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Material Receiving Date"}),e.jsx(z,{type:"date",value:k.fdMaterialReceivingDate,onChange:t=>p({...k,fdMaterialReceivingDate:t.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 transition-all bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Foundation Completion Date"}),e.jsx(z,{type:"date",value:k.foundationCompletionDate,onChange:t=>p({...k,foundationCompletionDate:t.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 transition-all bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Foundation Status"}),e.jsxs(Xe,{value:k.foundationStatus,onValueChange:t=>p({...k,foundationStatus:t}),children:[e.jsx(es,{className:"h-10 border-slate-200 focus:border-cyan-400 focus:ring-cyan-100 bg-white",children:e.jsx(Qe,{placeholder:"Select Status"})}),e.jsxs(ss,{children:[e.jsx(Me,{value:"In Progress",className:"text-blue-600 font-medium focus:bg-blue-50 focus:text-blue-700 cursor-pointer",children:"In Progress"}),e.jsx(Me,{value:"Completed",className:"text-green-600 font-medium focus:bg-green-50 focus:text-green-700 cursor-pointer",children:"Completed"}),e.jsx(Me,{value:"On Hold",className:"text-red-600 font-medium focus:bg-red-50 focus:text-red-700 cursor-pointer",children:"On Hold"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Photo OK Date"}),e.jsx(z,{type:"date",value:k.fdPhotoOkDate,onChange:t=>p({...k,fdPhotoOkDate:t.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 transition-all bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Material Ageing (Days)"}),e.jsx(z,{type:"number",value:k.fdMaterialAgeing,onChange:t=>p({...k,fdMaterialAgeing:t.target.value}),placeholder:"0",className:"h-10 border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 transition-all bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Upload Challan"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-200 rounded-xl p-3 bg-slate-50/50 flex flex-col items-center justify-center gap-1 hover:bg-slate-50 transition-all cursor-pointer group border-blue-100/50 hover:border-blue-200 h-24",onClick:()=>{var t;return(t=document.getElementById("challan-file"))==null?void 0:t.click()},children:[e.jsx("div",{className:"h-8 w-8 bg-white rounded-full flex items-center justify-center shadow-sm border border-slate-100 group-hover:scale-110 transition-transform",children:e.jsx(Fe,{className:"h-4 w-4 text-blue-500"})}),e.jsx("span",{className:"text-xs font-medium text-slate-600 group-hover:text-blue-600 transition-colors w-full text-center truncate px-2",children:k.challanLink||"Click to Upload"}),e.jsx(z,{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:J,className:"hidden",id:"challan-file"})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-100 pb-6 pr-6",children:[e.jsx(G,{variant:"ghost",onClick:()=>E(!1),className:"h-10 px-6 text-slate-600 hover:text-slate-800 hover:bg-slate-100/50",disabled:g,children:"Cancel"}),e.jsx(G,{onClick:B,className:"h-10 px-6 bg-linear-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-md transition-all hover:shadow-lg",disabled:g,children:g?"Processing...":"Complete Foundation"})]})]})]})})})]})}function Xa(){const[m,v]=d.useState("pending"),[C,_]=d.useState(!1),[w,Z]=d.useState([]),[X,Q]=d.useState([]),[f,ne]=d.useState(null),[ae,E]=d.useState(!1),[re,ee]=d.useState(!0),[D,le]=d.useState([]),[te,F]=d.useState(!1),[H,k]=d.useState({}),[p,T]=d.useState({}),[u,W]=d.useState(!1),[U,O]=d.useState({installationMaterialAgeing:"",installationMaterialReceivingDate:"",installationChallanLink:null,installationStatus:"",installationCompletionDate:"",insPhotoOkDate:""}),q=t=>{if(!t||t.includes("/preview"))return t;const P=t.match(/[-\w]{25,}/);return P?`https://drive.google.com/file/d/${P[0]}/preview`:t},de=async()=>{ee(!0);try{const t="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",P="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",A=new URLSearchParams({action:"read",sheet:"Project Main",sheetName:"Project Main",id:P.trim()}),b=await fetch(`${t}?${A.toString()}`);if(!b.ok)throw new Error("Network Error");const o=await b.json(),x=Array.isArray(o)?o:o.data||[];if(x.length===0){Z([]),Q([]),ee(!1);return}const S=5;if(S===-1||!x[S]){console.error("Header row not found"),ee(!1);return}const r=x[S].map(I=>String(I).trim()).map(I=>I.toLowerCase()),n=I=>r.findIndex(N=>I.every(L=>N.replace(/\s+/g,"").includes(L))),i={serialNo:n(["serial"]),regId:n(["reg","id"]),beneficiaryName:n(["beneficiary","name"]),fatherName:n(["father"]),village:n(["village"]),block:n(["block"]),district:n(["district"]),category:n(["category"]),pumpSource:n(["pump","source"]),pumpType:n(["pump","type"]),company:n(["company"]),installer:n(["installer"]),otherRemark:n(["remark"]),loiFileName:n(["loi"]),mrNo:n(["mr","no"]),mrDate:n(["mr","date"]),amount:n(["amount"]),paidBy:n(["paid","by"]),beneficiaryShare:n(["share"]),sanctionNo:n(["sanction","no"]),sanctionDate:n(["sanction","date"]),fdMaterialAgeing:n(["fd","ageing"]),fdMaterialReceivingDate:n(["fd","receiving"]),challanLink:(()=>{const I=n(["fd","challan"]);return I!==-1?I:n(["challan"])})(),foundationStatus:n(["foundation","status"]),foundationCompletionDate:(()=>{const I=n(["foundation","completion"]);return I!==-1?I:n(["fd","completion"])})(),fdPhotoOkDate:n(["fd","photo"]),actual3:n(["actual","3"]),planned4:n(["planned","4"]),actual4:n(["actual","4"]),installationMaterialAgeing:(()=>{const I=n(["im","ageing"]);if(I!==-1)return I;const N=n(["ins","ageing"]);return N!==-1?N:n(["installation","ageing"])})(),installationMaterialReceivingDate:(()=>{const I=n(["im","receiving"]);if(I!==-1)return I;const N=n(["ins","receiving"]);return N!==-1?N:n(["installation","receiving"])})(),installationStatus:n(["installation","status"]),installationChallanLink:(()=>{const I=n(["ins","challan"]);if(I!==-1)return I;const N=r.map((he,xe)=>he.includes("challan")?xe:-1).filter(he=>he!==-1),L=n(["fd","challan"])!==-1?n(["fd","challan"]):n(["challan"]),K=N.find(he=>he!==L);return K!==void 0?K:-1})(),installationCompletionDate:(()=>{const I=n(["ic","date"]);return I!==-1?I:n(["installation","completion"])})(),insPhotoOkDate:n(["ins","photo"])};console.log("Detected Columns:",i),T(i);const h=[],V=[];for(let I=S+1;I<x.length;I++){const N=x[I];if(!N||!N[i.regId])continue;const L={serialNo:N[i.serialNo],regId:N[i.regId],beneficiaryName:N[i.beneficiaryName],fatherName:N[i.fatherName],village:N[i.village],block:N[i.block],district:N[i.district],category:N[i.category],pumpSource:N[i.pumpSource],pumpType:N[i.pumpType],company:N[i.company],installer:N[i.installer],otherRemark:N[i.otherRemark],loiFileName:N[i.loiFileName],mrNo:N[i.mrNo],mrDate:N[i.mrDate],amount:N[i.amount],paidBy:N[i.paidBy],beneficiaryShare:N[i.beneficiaryShare],sanctionNo:N[i.sanctionNo],sanctionDate:N[i.sanctionDate],fdMaterialAgeing:N[i.fdMaterialAgeing],fdMaterialReceivingDate:N[i.fdMaterialReceivingDate],challanLink:N[i.challanLink],foundationStatus:N[i.foundationStatus],foundationCompletionDate:N[i.foundationCompletionDate]||"",fdPhotoOkDate:N[i.fdPhotoOkDate],installationMaterialAgeing:N[i.installationMaterialAgeing],installationMaterialReceivingDate:N[i.installationMaterialReceivingDate],installationChallanLink:N[i.installationChallanLink],installationStatus:N[i.installationStatus],installationCompletionDate:N[i.installationCompletionDate],insPhotoOkDate:N[i.insPhotoOkDate],actual3:N[i.actual3],planned4:N[i.planned4],actual4:N[i.actual4],rowIndex:I+1},K=L.actual4&&String(L.actual4).trim()!=="",he=L.planned4&&String(L.planned4).trim()!=="";K?V.push(L):he&&h.push(L)}Z(h),Q(V)}catch(t){console.error("Installation fetch error:",t)}finally{ee(!1),W(!0)}};d.useEffect(()=>{de()},[]),d.useEffect(()=>{if(C){const t=setTimeout(()=>{E(!1),setTimeout(()=>_(!1),300)},2e3);return()=>clearTimeout(t)}},[C]);const se=t=>{ne(t),_(!1),F(!1),O({installationMaterialAgeing:"",installationMaterialReceivingDate:"",installationChallanLink:null,installationStatus:"",installationCompletionDate:"",insPhotoOkDate:""}),E(!0)},j=(t,P)=>{le(P?A=>[...A,t]:A=>A.filter(b=>b!==t))},J=()=>{F(!0),ne(null),_(!1),O({installationMaterialAgeing:"",installationMaterialReceivingDate:"",installationChallanLink:null,installationStatus:"",installationCompletionDate:"",insPhotoOkDate:""}),E(!0)},[s,y]=d.useState(!1),g=t=>{t.target.files&&t.target.files[0]&&O({...U,installationChallanLink:t.target.files[0].name,installationChallanFileObj:t.target.files[0]})},c=t=>new Promise((P,A)=>{const b=new FileReader;b.readAsDataURL(t),b.onload=()=>P(b.result.split(",")[1]),b.onerror=o=>A(o)}),B=async()=>{if(!(!f&&(!te||D.length===0))){y(!0);try{const t="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",P="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",A="1pqyJUlUD0zwnojUvNezJgxzim8gjUfmM";let b="";if(U.installationChallanFileObj)try{const S=await c(U.installationChallanFileObj),Y=new URLSearchParams({action:"uploadFile",base64Data:S,fileName:`BULK_${U.installationChallanFileObj.name}`,mimeType:U.installationChallanFileObj.type,folderId:A||"1pqyJUlUD0zwnojUvNezJgxzim8gjUfmM"}),n=await(await fetch(t,{method:"POST",body:Y})).json();n.success&&n.fileUrl?b=n.fileUrl:(console.error("File upload failed",n),alert("Warning: File upload failed, but proceeding with data update. "+(n.message||"")))}catch(S){console.error("Upload error:",S),alert("Warning: File upload error. Proceeding with text data only.")}let o=[];te?o=w.filter(S=>D.includes(S.serialNo)):o=[f];const x=o.map(async S=>{const Y={},r=(V,I)=>{const N=p[V];N!==void 0&&N>=0&&I!==void 0&&I!==null&&I!==""&&(Y[N]=I)};r("installationMaterialAgeing",U.installationMaterialAgeing),r("installationMaterialReceivingDate",U.installationMaterialReceivingDate),r("installationStatus",U.installationStatus),r("installationCompletionDate",U.installationCompletionDate),r("insPhotoOkDate",U.insPhotoOkDate);const n=new Date,i=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")} ${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`;r("actual4",i),b&&r("installationChallanLink",b);const h=new URLSearchParams({action:"update",sheetName:"Project Main",id:P,rowIndex:S.rowIndex,rowData:JSON.stringify(Y)});return fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:h.toString()}).then(V=>V.json())});await Promise.all(x),le([]),F(!1),_(!0),de()}catch(t){console.error("Submission error:",t),alert("Failed to Submit: "+t.message)}finally{y(!1)}}};return e.jsxs("div",{className:"space-y-8 p-6 md:p-8 max-w-[1600px] mx-auto bg-slate-50/50 min-h-screen animate-fade-in-up",children:[e.jsxs(Ee,{defaultValue:"pending",className:"w-full",onValueChange:v,children:[e.jsxs($e,{className:"grid w-full grid-cols-2 relative p-1 bg-slate-100/80 h-14 rounded-xl border border-slate-200",children:[e.jsx("div",{className:`absolute top-1 bottom-1 left-1 w-[calc(50%-0.5rem)] rounded-lg bg-white shadow-sm transition-all duration-300 ease-in-out ${m==="history"?"translate-x-full":"translate-x-0"}`}),e.jsx(Se,{value:"pending",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Pending Installation"}),e.jsx(Se,{value:"history",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Installation History"})]}),e.jsx(Ce,{value:"pending",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-left-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(We,{className:"h-4 w-4 text-blue-600"})}),"Pending Installation"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[D.length>=2&&e.jsxs(G,{onClick:J,className:"bg-blue-600 hover:bg-blue-700 text-white shadow-md shadow-blue-200 transition-all duration-300 animate-in fade-in slide-in-from-right-4",size:"sm",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Installation Selected (",D.length,")"]}),e.jsxs($,{variant:"outline",className:"bg-yellow-100 text-yellow-700 border-yellow-200 px-3 py-1",children:[w.length," Pending"]})]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-4 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap w-12",children:"Select"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap min-w-[150px]",children:"Action"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Father's Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Block"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Category"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Source"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Type"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Installer"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Other Remark"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"LOI Document"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Paid By"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Share"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Sanction No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Sanction Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"FD Material Ageing"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"FD Material Receiving Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Challan Link"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Foundation Status"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Foundation Completion Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"FD Photo OK Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:re?Array.from({length:6}).map((t,P)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:29}).map((A,b)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded mx-auto"})},b))},`install-skel-${P}`)):w.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:29,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(We,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No pending installation requests found"})]})})}):w.map(t=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"px-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(ze,{checked:D.includes(t.serialNo),onCheckedChange:P=>j(t.serialNo,P),"aria-label":`Select row ${t.serialNo}`,className:"checkbox-3d border-slate-400 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 h-5 w-5 shadow-sm transition-all duration-300 ease-out active:scale-75 hover:scale-110 data-[state=checked]:scale-110"})})}),e.jsx(a,{children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>se(t),disabled:D.length>=2,className:"bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white border border-blue-200 shadow-xs text-xs font-semibold h-8 px-4 rounded-full flex items-center gap-2 transition-all duration-300 mx-auto disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(We,{className:"h-3.5 w-3.5"}),"Install"]})}),e.jsx(a,{className:"whitespace-nowrap font-mono text-xs text-slate-500 bg-slate-50 py-1 px-2 rounded-md mx-auto w-fit",children:t.regId}),e.jsx(a,{className:"whitespace-nowrap font-medium text-slate-800",children:t.beneficiaryName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.fatherName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.village}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.block}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.district}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.category}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.pumpSource}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.pumpType}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.company}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.installer}),e.jsx(a,{className:"whitespace-nowrap text-slate-500 italic",children:t.otherRemark||"-"}),e.jsx(a,{className:"whitespace-nowrap",children:t.loiFileName?t.loiFileName.startsWith("http")?e.jsxs("a",{href:q(t.loiFileName),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-xs flex items-center justify-center gap-1",children:[e.jsx(pe,{className:"h-4 w-4"}),"View Document"]}):e.jsx("span",{className:"text-slate-600 text-xs",children:t.loiFileName}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.mrNo}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.mrDate}),e.jsxs(a,{className:"whitespace-nowrap font-medium text-slate-700",children:["",t.amount]}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.paidBy}),e.jsx(a,{className:"whitespace-nowrap text-slate-500",children:t.beneficiaryShare||"-"}),e.jsx(a,{className:"whitespace-nowrap font-medium",children:t.sanctionNo?e.jsx("span",{className:"font-mono bg-orange-50 px-2 py-0.5 rounded border border-orange-100 text-orange-700",children:t.sanctionNo}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.sanctionDate}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.fdMaterialAgeing}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.fdMaterialReceivingDate}),e.jsx(a,{className:"whitespace-nowrap",children:t.challanLink?t.challanLink.startsWith("http")?e.jsxs("a",{href:q(t.challanLink),target:"_blank",rel:"noopener noreferrer",className:"text-green-600 underline text-xs flex items-center justify-center gap-1",children:[e.jsx(pe,{className:"h-4 w-4"}),"View Challan"]}):e.jsx("span",{className:"text-slate-600 text-xs",children:t.challanLink}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{className:"whitespace-nowrap font-medium text-green-700",children:t.foundationStatus}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.foundationCompletionDate}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.fdPhotoOkDate}),e.jsx(a,{children:e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Pending"})})]},t.serialNo))})]})}),e.jsx("div",{className:"md:hidden space-y-4 p-4 bg-slate-50",children:w.map(t=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{variant:"secondary",className:"bg-slate-100 text-slate-600",children:t.serialNo}),e.jsx("h4",{className:"font-semibold text-base text-slate-800",children:t.beneficiaryName}),e.jsx("p",{className:"text-muted-foreground text-xs font-mono",children:t.regId})]}),e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200 text-xs",children:"Pending"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3 text-xs border-t border-b py-3 my-2 border-slate-100",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Father's Name"}),e.jsx("span",{className:"font-medium text-slate-700",children:t.fatherName})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Village"}),e.jsx("span",{className:"font-medium text-slate-700",children:t.village})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"District"}),e.jsx("span",{className:"font-medium text-slate-700",children:t.district})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Sanction No"}),e.jsx("span",{className:"font-medium text-orange-600 font-mono",children:t.sanctionNo||"-"})]})]}),e.jsxs(G,{size:"sm",disabled:D.length>=2,className:"w-full bg-linear-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-md disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>se(t),children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Process Installation"]})]})},t.serialNo))})]})]})}),e.jsx(Ce,{value:"history",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-right-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(pe,{className:"h-4 w-4 text-blue-600"})}),"Installation History"]}),e.jsxs($,{variant:"outline",className:"bg-blue-100 text-blue-700 border-blue-200 px-3 py-1",children:[X.length," Records"]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Father's Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Block"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Category"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Source"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Type"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Installer"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Other Remark"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"LOI Document"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Paid By"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Share"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Sanction No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Sanction Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"FD Material Ageing"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"FD Material Receiving Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"FD Challan Link"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Foundation Status"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Foundation Completion Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"FD Photo OK Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap bg-blue-50/20",children:"Ins. Ageing"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap bg-blue-50/20",children:"Ins. Material Received"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap bg-blue-50/20",children:"Ins. Challan Link"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap bg-blue-50/20",children:"Ins. Status"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap bg-blue-50/20",children:"Ins. Completion Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap bg-blue-50/20",children:"Ins. Photo OK Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:re?Array.from({length:6}).map((t,P)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:34}).map((A,b)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded mx-auto"})},b))},`history-skel-${P}`)):X.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:34,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(pe,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No installation history found."})]})})}):X.map(t=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"whitespace-nowrap font-mono text-xs text-slate-500 bg-slate-50 py-1 px-2 rounded-md mx-auto w-fit",children:t.regId}),e.jsx(a,{className:"whitespace-nowrap font-medium text-slate-800",children:t.beneficiaryName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.fatherName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.village}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.block}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.district}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.category}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.pumpSource}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.pumpType}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.company}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.installer}),e.jsx(a,{className:"whitespace-nowrap text-slate-500 italic",children:t.otherRemark||"-"}),e.jsx(a,{className:"whitespace-nowrap",children:t.loiFileName?t.loiFileName.startsWith("http")?e.jsxs("a",{href:q(t.loiFileName),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-xs flex items-center justify-center gap-1 hover:text-blue-800",children:[e.jsx(pe,{className:"h-4 w-4"}),"View Document"]}):e.jsx("span",{className:"text-slate-600 text-xs",children:t.loiFileName}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.mrNo}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.mrDate}),e.jsxs(a,{className:"whitespace-nowrap font-medium text-slate-700",children:["",t.amount]}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.paidBy}),e.jsx(a,{className:"whitespace-nowrap text-slate-500",children:t.beneficiaryShare||"-"}),e.jsx(a,{className:"whitespace-nowrap",children:t.sanctionNo?e.jsx("span",{className:"font-mono bg-orange-50 px-2 py-0.5 rounded border border-orange-100 text-orange-700",children:t.sanctionNo}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.sanctionDate}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.fdMaterialAgeing}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.fdMaterialReceivingDate}),e.jsx(a,{className:"whitespace-nowrap",children:t.challanLink?t.challanLink.startsWith("http")?e.jsxs("a",{href:q(t.challanLink),target:"_blank",rel:"noopener noreferrer",className:"text-green-600 underline text-xs flex items-center justify-center gap-1 hover:text-green-800",children:[e.jsx(pe,{className:"h-4 w-4"}),"View Challan"]}):e.jsx("span",{className:"text-slate-600 text-xs",children:t.challanLink}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{className:"whitespace-nowrap text-green-700 font-medium",children:t.foundationStatus}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.foundationCompletionDate}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:t.fdPhotoOkDate}),e.jsx(a,{className:"whitespace-nowrap bg-blue-50/50 text-blue-700 font-medium",children:t.installationMaterialAgeing}),e.jsx(a,{className:"whitespace-nowrap bg-blue-50/50 text-slate-600",children:t.installationMaterialReceivingDate}),e.jsx(a,{className:"whitespace-nowrap bg-blue-50/50",children:t.installationChallanLink?t.installationChallanLink.startsWith("http")?e.jsxs("a",{href:q(t.installationChallanLink),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-xs flex items-center justify-center gap-1 hover:text-blue-800",children:[e.jsx(pe,{className:"h-4 w-4"}),"View Challan"]}):e.jsx("span",{className:"text-slate-600 text-xs",children:t.installationChallanLink}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{className:"whitespace-nowrap bg-blue-50/50 font-bold",children:e.jsx($,{variant:"outline",className:`
                              ${t.installationStatus==="Completed"?"bg-green-100 text-green-700 border-green-200":""}
                              ${t.installationStatus==="In Progress"?"bg-blue-100 text-blue-700 border-blue-200":""}
                              ${t.installationStatus==="Pending"?"bg-yellow-100 text-yellow-700 border-yellow-200":""}
                              ${t.installationStatus==="On Hold"?"bg-red-100 text-red-700 border-red-200":""}
                              ${["Completed","In Progress","Pending","On Hold"].includes(t.installationStatus)?"":"bg-slate-100 text-slate-700 border-slate-200"}
                            `,children:t.installationStatus})}),e.jsx(a,{className:"whitespace-nowrap bg-blue-50/50 text-slate-600",children:t.installationCompletionDate}),e.jsx(a,{className:"whitespace-nowrap bg-blue-50/50 text-slate-600",children:t.insPhotoOkDate}),e.jsx(a,{className:"whitespace-nowrap",children:e.jsx($,{className:"bg-teal-100 text-teal-800 hover:bg-teal-200 border-teal-200",children:"Installed"})})]},t.serialNo))})]})}),e.jsx("div",{className:"md:hidden space-y-4 p-4 bg-slate-50",children:X.map(t=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{variant:"secondary",className:"bg-slate-100 text-slate-600",children:t.serialNo}),e.jsx("h4",{className:"font-semibold text-base text-slate-800",children:t.beneficiaryName}),e.jsx("p",{className:"text-muted-foreground text-xs font-mono",children:t.regId})]}),e.jsx($,{className:"bg-teal-100 text-teal-800 border-teal-200 text-xs",children:"Installed"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3 text-xs border-t border-b py-3 my-2 border-slate-100",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:e.jsx($,{variant:"outline",className:`
                              ${t.installationStatus==="Completed"?"bg-green-100 text-green-700 border-green-200":""}
                              ${t.installationStatus==="In Progress"?"bg-blue-100 text-blue-700 border-blue-200":""}
                              ${t.installationStatus==="Pending"?"bg-yellow-100 text-yellow-700 border-yellow-200":""}
                              ${t.installationStatus==="On Hold"?"bg-red-100 text-red-700 border-red-200":""}
                              ${["Completed","In Progress","Pending","On Hold"].includes(t.installationStatus)?"":"bg-slate-100 text-slate-700 border-slate-200"}
                            `,children:t.installationStatus})})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Completed On"}),e.jsx("span",{className:"font-medium text-slate-700",children:t.installationCompletionDate})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Ins Ageing"}),e.jsx("span",{className:"font-medium text-slate-700",children:t.installationMaterialAgeing})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Material Rcvd"}),e.jsx("span",{className:"font-medium text-slate-700",children:t.installationMaterialReceivingDate})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase block mb-1 font-semibold",children:"Challan Document"}),t.installationChallanLink?e.jsxs("span",{className:"text-blue-600 underline cursor-pointer flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3"}),t.installationChallanLink," (File)"]}):e.jsx("span",{className:"text-gray-400 italic",children:"No document"})]})]})]})},t.serialNo))})]})]})})]}),e.jsx(Be,{open:ae,onOpenChange:E,children:e.jsx(Te,{showCloseButton:!C,className:`max-w-4xl max-h-[90vh] overflow-y-auto p-0 gap-0 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none] ${C?"bg-transparent !shadow-none !border-none":""}`,children:C?e.jsxs("div",{className:"flex flex-col items-center justify-center w-full p-8 text-center space-y-6 animate-in fade-in duration-300",children:[e.jsx("div",{className:"rounded-full bg-white p-5 shadow-2xl shadow-white/20 ring-8 ring-white/10 animate-in zoom-in duration-500 ease-out",children:e.jsx(Ne,{className:"h-16 w-16 text-green-600 scale-110"})}),e.jsx("h2",{className:"text-3xl font-bold text-white drop-shadow-md animate-in slide-in-from-bottom-4 fade-in duration-500 delay-150 ease-out tracking-wide",children:"Installed Successfully!"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{className:"p-6 pb-2 border-b border-blue-100 bg-blue-50/30",children:[e.jsxs(Ue,{className:"text-xl font-bold bg-linear-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 p-1.5 rounded-md",children:e.jsx(We,{className:"h-4 w-4 text-blue-600"})}),"Process Installation Work"]}),e.jsx(Le,{className:"text-slate-500 ml-10",children:te?e.jsxs("span",{children:["Applying changes to ",e.jsxs("span",{className:"font-bold text-blue-700",children:[D.length," selected items"]}),". All fields below will be updated for these items."]}):e.jsxs("span",{children:["Update installation details for ",e.jsx("span",{className:"font-semibold text-slate-700",children:f==null?void 0:f.beneficiaryName})," ",e.jsx("span",{className:"font-mono text-xs bg-slate-100 px-1 py-0.5 rounded text-slate-600 border border-slate-200",children:f==null?void 0:f.serialNo})]})})]}),e.jsx("div",{className:"p-6 space-y-6",children:(f||te)&&e.jsxs(e.Fragment,{children:[!te&&f&&e.jsxs("div",{className:"bg-slate-50/50 rounded-xl border border-slate-200 p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-blue-600"}),"Beneficiary Details"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-y-4 gap-x-8 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 text-xs block mb-1",children:"Serial No"}),e.jsx("p",{className:"font-medium text-slate-800",children:f.serialNo})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 text-xs block mb-1",children:"Reg ID"}),e.jsx("p",{className:"font-medium text-slate-800 font-mono",children:f.regId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 text-xs block mb-1",children:"Beneficiary Name"}),e.jsx("p",{className:"font-medium text-slate-800",children:f.beneficiaryName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 text-xs block mb-1",children:"Father's Name"}),e.jsx("p",{className:"font-medium text-slate-800",children:f.fatherName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 text-xs block mb-1",children:"Village/Block"}),e.jsxs("p",{className:"font-medium text-slate-800",children:[f.village,", ",f.block]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 text-xs block mb-1",children:"Pump Type"}),e.jsx("p",{className:"font-medium text-blue-700 bg-blue-50 inline-block px-2 py-0.5 rounded text-xs border border-blue-100",children:f.pumpType})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Installation Material Ageing"}),e.jsx(z,{value:U.installationMaterialAgeing,onChange:t=>O({...U,installationMaterialAgeing:t.target.value}),placeholder:"e.g. 30 days",className:"h-10 border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 transition-all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Installation Material Receiving Date"}),e.jsx(z,{type:"date",value:U.installationMaterialReceivingDate,onChange:t=>O({...U,installationMaterialReceivingDate:t.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 transition-all"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Challan Link"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-200 rounded-xl p-4 bg-slate-50/50 flex flex-col items-center justify-center gap-2 hover:bg-slate-50 transition-colors cursor-pointer group",onClick:()=>{var t;return(t=document.getElementById("installation-challan-file"))==null?void 0:t.click()},children:[e.jsx(z,{type:"file",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",onChange:g,className:"hidden",id:"installation-challan-file"}),e.jsx("div",{className:"p-3 bg-white rounded-full shadow-sm group-hover:scale-110 transition-transform",children:e.jsx(Fe,{className:"h-5 w-5 text-cyan-600"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 group-hover:text-cyan-700 transition-colors",children:U.installationChallanLink?"Change Challan Document":"Upload Challan Document"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"SVG, PNG, JPG or PDF (max. 10MB)"})]}),U.installationChallanLink&&e.jsxs($,{variant:"secondary",className:"mt-2 bg-cyan-50 text-cyan-700 border-cyan-200",children:[e.jsx(pe,{className:"h-3 w-3 mr-1"}),U.installationChallanLink]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Installation Status"}),e.jsxs(Xe,{value:U.installationStatus,onValueChange:t=>O({...U,installationStatus:t}),children:[e.jsx(es,{className:"h-10 border-slate-200 focus:border-cyan-400 focus:ring-cyan-100",children:e.jsx(Qe,{placeholder:"Select status"})}),e.jsxs(ss,{children:[e.jsx(Me,{value:"Completed",className:"text-green-600 font-medium focus:bg-green-50 focus:text-green-700 cursor-pointer",children:"Completed"}),e.jsx(Me,{value:"In Progress",className:"text-blue-600 font-medium focus:bg-blue-50 focus:text-blue-700 cursor-pointer",children:"In Progress"}),e.jsx(Me,{value:"Pending",className:"text-yellow-600 font-medium focus:bg-yellow-50 focus:text-yellow-700 cursor-pointer",children:"Pending"}),e.jsx(Me,{value:"On Hold",className:"text-red-600 font-medium focus:bg-red-50 focus:text-red-700 cursor-pointer",children:"On Hold"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Installation Completion Date"}),e.jsx(z,{type:"date",value:U.installationCompletionDate,onChange:t=>O({...U,installationCompletionDate:t.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 transition-all"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Ins Photo OK Date"}),e.jsx(z,{type:"date",value:U.insPhotoOkDate,onChange:t=>O({...U,insPhotoOkDate:t.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 transition-all"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-100 pb-6 pr-6",children:[e.jsx(G,{variant:"ghost",onClick:()=>E(!1),disabled:s,className:"h-10 px-6 text-slate-600 hover:text-slate-800 hover:bg-slate-100/50",children:"Cancel"}),e.jsx(G,{onClick:B,disabled:s,className:"h-10 px-6 bg-linear-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-md transition-all hover:shadow-lg min-w-[150px]",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Installing..."]}):"Complete Installation"})]})]})})]})})})]})}function Qa(){const[m,v]=d.useState("pending"),[C,_]=d.useState(!1),[w,Z]=d.useState([]),[X,Q]=d.useState([]),[f,ne]=d.useState(null),[ae,E]=d.useState({policyNo:"",policyDate:"",insuranceCompany:"",insuranceForm:null}),[re,ee]=d.useState(!1),[D,le]=d.useState(!0),[te,F]=d.useState({}),[H,k]=d.useState(!1),[p,T]=d.useState([]),[u,W]=d.useState(!1),U=s=>{if(!s)return"";const y=s.match(/[-\w]{25,}/);return`https://drive.google.com/file/d/${y?y[0]:s}/preview`},O=async()=>{console.log("Fetching Insurance Data...");try{const s="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",y="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",g=new URLSearchParams({action:"read",sheet:"Project Main",sheetName:"Project Main",id:y.trim()}),c=await fetch(`${s}?${g.toString()}`);if(!c.ok)throw new Error("Network Error");const B=await c.json(),t=Array.isArray(B)?B:B.data||[];if(t.length===0){console.warn("No rows found in sheet"),Z([]),Q([]),le(!1);return}const P=5;if(!t[P]){console.error("Header row missing"),le(!1);return}const b=t[P].map(r=>String(r).trim()).map(r=>r.toLowerCase()),o=r=>b.findIndex(n=>r.every(i=>n.replace(/\s+/g,"").includes(i))),x={serialNo:o(["serial"]),regId:o(["reg","id"]),beneficiaryName:o(["beneficiary","name"]),fatherName:o(["father"]),village:o(["village"]),block:o(["block"]),district:o(["district"]),pumpType:o(["pump","type"]),company:o(["company"]),installer:(()=>{let r=o(["installer"]);return r===-1&&(r=o(["agency"])),r===-1&&(r=o(["firm"])),r})(),installationCompletionDate:(()=>{let r=o(["install","date"]);return r===-1&&(r=o(["completion","date"])),r===-1&&(r=o(["commissioning","date"])),r})(),policyNo:o(["policy","no"]),policyDate:o(["policy","date"]),insuranceCompany:(()=>{let r=o(["insurance","company"]);return r===-1&&(r=o(["ins","comp"])),r===-1&&(r=o(["insurance","name"])),r})(),insuranceForm:(()=>{let r=o(["insurance","form"]);return r===-1&&(r=o(["insurance","pdf"])),r})(),actual5:(()=>{const r=o(["actual","5"]);return r!==-1?r:o(["system","info"])})(),planned6:o(["planned","6"]),actual6:(()=>{const r=o(["actual","6"]);return r!==-1?r:o(["insurance"])})()};console.log("Insurance Col Map:",x),F(x);const S=[],Y=[];for(let r=P+1;r<t.length;r++){const n=t[r];if(!n||!n[x.regId])continue;const i=N=>N!==-1&&n[N]!==void 0?n[N]:"",h={serialNo:i(x.serialNo),regId:i(x.regId),beneficiaryName:i(x.beneficiaryName),fatherName:i(x.fatherName),village:i(x.village),block:i(x.block),district:i(x.district),pumpType:i(x.pumpType),company:i(x.company),installer:i(x.installer),installationCompletionDate:i(x.installationCompletionDate),policyNo:i(x.policyNo),policyDate:i(x.policyDate),insuranceCompany:i(x.insuranceCompany),insuranceForm:i(x.insuranceForm),actual5:i(x.actual5),planned6:i(x.planned6),actual6:i(x.actual6),rowIndex:r+1},V=h.planned6&&String(h.planned6).trim()!=="";h.actual6&&String(h.actual6).trim()!==""?Y.push(h):V&&S.push(h)}console.log("Found Pending Insurance:",S.length),console.log("Found History Insurance:",Y.length),Z(S),Q(Y)}catch(s){console.error("Fetch Data Error:",s)}finally{le(!1)}};d.useEffect(()=>{O();const s=setTimeout(()=>le(!1),15e3);return()=>clearTimeout(s)},[]),d.useEffect(()=>{if(C){const s=setTimeout(()=>{ee(!1),setTimeout(()=>_(!1),300)},2e3);return()=>clearTimeout(s)}},[C]);const q=s=>{console.log("Process Insurance clicked for:",s),_(!1),W(!1);try{ne(s),E({policyNo:s.policyNo||"",policyDate:s.policyDate||"",insuranceCompany:s.insuranceCompany||"",insuranceForm:null}),ee(!0)}catch(y){console.error("Error in handleActionClick:",y)}},de=(s,y)=>{T(y?g=>[...g,s]:g=>g.filter(c=>c!==s))},se=()=>{W(!0),ne(null),_(!1),E({policyNo:"",policyDate:"",insuranceCompany:"",insuranceForm:null}),ee(!0)},j=s=>{s.target.files&&s.target.files[0]&&E({...ae,insuranceForm:s.target.files[0].name})},J=async()=>{if(!(!f&&(!u||p.length===0))){k(!0);try{const s="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",y="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo";let g=ae.insuranceForm;const c=document.getElementById("insurance-form-file");if(c&&c.files[0]){const b=c.files[0],o=new FileReader;g=await new Promise((x,S)=>{o.onload=async Y=>{const r=Y.target.result.split(",")[1],n=u?`BULK_${Date.now()}_${b.name}`:b.name,i=new URLSearchParams({action:"uploadFile",fileName:n,mimeType:b.type,base64Data:r,folderId:"1pqyJUlUD0zwnojUvNezJgxzim8gjUfmM"});try{const V=await(await fetch(`${s}`,{method:"POST",body:i})).json();V.success&&V.fileUrl?x(V.fileUrl):S("Upload failed")}catch(h){S(h)}},o.readAsDataURL(b)})}let B=[];u?B=w.filter(b=>p.includes(b.serialNo)):B=[f];const t=B.map(async b=>{const o={},x=(i,h)=>{const V=te[i];V!==void 0&&V>=0&&(o[V]=h)};x("policyNo","'"+ae.policyNo),x("policyDate",ae.policyDate),x("insuranceCompany",ae.insuranceCompany),x("insuranceForm",g);const S=new Date,Y=`${S.getFullYear()}/${String(S.getMonth()+1).padStart(2,"0")}/${String(S.getDate()).padStart(2,"0")} ${String(S.getHours()).padStart(2,"0")}:${String(S.getMinutes()).padStart(2,"0")}:${String(S.getSeconds()).padStart(2,"0")}`;x("actual6",Y);const r=new URLSearchParams({action:"update",sheet:"Project Main",sheetName:"Project Main",id:y,rowIndex:b.rowIndex,rowData:JSON.stringify(o)});return(await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r})).json()}),A=(await Promise.all(t)).filter(b=>b.status==="error"||b.result==="error");if(A.length>0)throw new Error(`${A.length} updates failed.`);await O(),ne(null),W(!1),T([]),_(!0)}catch(s){console.error("Submission Error:",s),alert("Error submitting form: "+s.message)}finally{k(!1)}}};return e.jsxs("div",{className:"space-y-8 p-6 md:p-8 max-w-[1600px] mx-auto bg-slate-50/50 min-h-screen animate-fade-in-up",children:[e.jsxs(Ee,{defaultValue:"pending",className:"w-full",onValueChange:v,children:[e.jsxs($e,{className:"grid w-full grid-cols-2 relative p-1 bg-slate-100/80 h-14 rounded-xl border border-slate-200",children:[e.jsx("div",{className:`absolute top-1 bottom-1 left-1 w-[calc(50%-0.5rem)] rounded-lg bg-white shadow-sm transition-all duration-300 ease-in-out ${m==="history"?"translate-x-full":"translate-x-0"}`}),e.jsx(Se,{value:"pending",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Pending Actions"}),e.jsx(Se,{value:"history",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"History & Records"})]}),e.jsx(Ce,{value:"pending",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(Je,{className:"h-4 w-4 text-blue-600"})}),"Pending Insurance"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p.length>=2&&e.jsxs(G,{onClick:se,className:"bg-blue-600 hover:bg-blue-700 text-white shadow-md shadow-blue-200 transition-all duration-300 animate-in fade-in slide-in-from-right-4",size:"sm",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Insure Selected (",p.length,")"]}),e.jsxs($,{variant:"outline",className:"bg-yellow-100 text-yellow-700 border-yellow-200 px-3 py-1",children:[w.length," Pending"]})]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-4 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap w-12",children:"Select"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap min-w-[150px]",children:"Action"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Father's Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Block"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Type"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Installer"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Installation Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:D?Array.from({length:6}).map((s,y)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:13}).map((g,c)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded mx-auto"})},c))},`pending-skel-${y}`)):w.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:13,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(Je,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No pending insurance requests found"})]})})}):w.map(s=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"px-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(ze,{checked:p.includes(s.serialNo),onCheckedChange:y=>de(s.serialNo,y),"aria-label":`Select row ${s.serialNo}`,className:"checkbox-3d border-slate-400 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 h-5 w-5 shadow-sm transition-all duration-300 ease-out active:scale-75 hover:scale-110 data-[state=checked]:scale-110"})})}),e.jsx(a,{children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>q(s),disabled:p.length>=2,className:"bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white border border-blue-200 shadow-xs text-xs font-semibold h-8 px-4 rounded-full flex items-center gap-2 transition-all duration-300 mx-auto disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Je,{className:"h-3.5 w-3.5"}),"Insure"]})}),e.jsx(a,{className:"whitespace-nowrap font-mono text-xs text-slate-500 bg-slate-50 py-1 px-2 rounded-md mx-auto w-fit",children:s.regId}),e.jsx(a,{className:"whitespace-nowrap font-medium text-slate-800",children:s.beneficiaryName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.fatherName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.village}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.block}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.district}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.pumpType}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.company}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.installer}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.installationCompletionDate||"-"}),e.jsx(a,{children:e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Pending"})})]},s.serialNo))})]})}),e.jsx("div",{className:"block md:hidden space-y-4 p-4 bg-slate-50",children:w.map(s=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{variant:"secondary",className:"bg-slate-100 text-slate-600",children:s.serialNo}),e.jsx("h4",{className:"font-semibold text-base text-slate-800",children:s.beneficiaryName}),e.jsx("p",{className:"text-muted-foreground text-xs font-mono",children:s.regId})]}),e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200 text-xs",children:"Pending"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3 text-xs border-t border-b py-3 my-2 border-slate-100",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Father's Name"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.fatherName})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Village"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.village})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"District"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.district})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Pump Type"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.pumpType})]})]}),e.jsxs(G,{size:"sm",disabled:p.length>=2,className:"w-full bg-linear-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-md disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>q(s),children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Process Insurance"]})]})},s.serialNo))})]})]})}),e.jsx(Ce,{value:"history",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-right-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(pe,{className:"h-4 w-4 text-blue-600"})}),"Insurance History"]}),e.jsxs($,{variant:"outline",className:"bg-blue-100 text-blue-700 border-blue-200 px-3 py-1",children:[X.length," Records"]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Type"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Policy No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Insurance Co."}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Policy Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Document"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:D?Array.from({length:6}).map((s,y)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:10}).map((g,c)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded mx-auto"})},c))},`history-skel-${y}`)):X.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:10,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(pe,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No insurance records yet."})]})})}):X.map(s=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{children:e.jsx("span",{className:"font-mono text-xs text-slate-500 bg-slate-50 py-1 px-2 rounded-md",children:s.regId})}),e.jsx(a,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-800",children:s.beneficiaryName}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.village,", ",s.block]})]})}),e.jsx(a,{className:"text-slate-600",children:s.district}),e.jsx(a,{className:"text-slate-600",children:s.pumpType}),e.jsx(a,{className:"text-slate-600",children:s.company}),e.jsx(a,{className:"font-medium text-blue-700 bg-blue-50/50",children:s.policyNo}),e.jsx(a,{className:"text-slate-600",children:s.insuranceCompany}),e.jsx(a,{className:"text-slate-600",children:s.policyDate}),e.jsx(a,{children:s.insuranceForm?e.jsx($,{variant:"outline",className:"bg-blue-50 text-blue-700 hover:bg-blue-100 cursor-pointer border-blue-200 gap-1",onClick:()=>window.open(U(s.insuranceForm),"_blank"),children:s.insuranceForm.includes("drive.google.com")?"View Document":s.insuranceForm}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{children:e.jsx($,{className:"bg-teal-100 text-teal-800 border-teal-200",children:"Insured"})})]},s.serialNo))})]})}),e.jsx("div",{className:"block md:hidden space-y-4 p-4 bg-slate-50",children:X.map(s=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-semibold text-blue-900",children:s.serialNo}),e.jsx("p",{className:"text-base font-medium text-slate-800",children:s.beneficiaryName}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:[s.district,"  ",s.village]})]}),e.jsx($,{className:"bg-teal-100 text-teal-800 border-teal-200",children:"Insured"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs border-t border-slate-100 pt-2 mt-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Pump:"})," ",s.pumpType]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Company:"})," ",s.company]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Policy No:"})," ",e.jsx("span",{className:"text-blue-700 font-medium",children:s.policyNo})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Ins. Co:"})," ",s.insuranceCompany]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Policy Date:"})," ",s.policyDate]}),s.insuranceForm&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Form:"})," ",e.jsx("span",{className:"text-blue-600 underline",children:s.insuranceForm})]})]})]})},s.serialNo))})]})]})})]}),e.jsx(Be,{open:re,onOpenChange:ee,children:e.jsx(Te,{showCloseButton:!C,className:`max-w-4xl max-h-[90vh] overflow-y-auto p-0 gap-0 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none] ${C?"bg-transparent !shadow-none !border-none":"bg-white"}`,children:C?e.jsxs("div",{className:"flex flex-col items-center justify-center w-full p-8 text-center space-y-6 animate-in fade-in duration-300",children:[e.jsx("div",{className:"rounded-full bg-white p-5 shadow-2xl shadow-white/20 ring-8 ring-white/10 animate-in zoom-in duration-500 ease-out",children:e.jsx(Ne,{className:"h-16 w-16 text-green-600 scale-110"})}),e.jsx("h2",{className:"text-3xl font-bold text-white drop-shadow-md animate-in slide-in-from-bottom-4 fade-in duration-500 delay-150 ease-out tracking-wide",children:"Submitted Successfully!"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{className:"p-6 pb-2 border-b border-blue-100 bg-blue-50/30",children:[e.jsxs(Ue,{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 p-1.5 rounded-md",children:e.jsx(Je,{className:"h-4 w-4 text-blue-600"})}),"Enter Insurance Information"]}),e.jsx(Le,{className:"text-slate-500 ml-10",children:u?e.jsxs("span",{children:["Applying changes to ",e.jsxs("span",{className:"font-bold text-blue-700",children:[p.length," selected items"]}),". All fields below will be updated for these items."]}):e.jsxs("span",{children:["Enter insurance policy details for ",e.jsx("span",{className:"font-semibold text-slate-700",children:f==null?void 0:f.beneficiaryName})]})})]}),(f||u)&&e.jsxs("div",{className:"grid gap-6 p-6",children:[!u&&f&&e.jsxs("div",{className:"rounded-xl border border-blue-100 bg-gradient-to-br from-blue-50/50 to-cyan-50/30 p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-2 border-b border-blue-100/50",children:[e.jsx("span",{className:"bg-white p-1 rounded shadow-sm",children:e.jsx(Je,{className:"h-4 w-4 text-blue-500"})}),e.jsx("h4",{className:"font-semibold text-blue-900",children:"Beneficiary Details"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-y-4 gap-x-6 text-sm",children:[{label:"Serial No",value:f.serialNo},{label:"Reg ID",value:f.regId},{label:"Beneficiary Name",value:f.beneficiaryName},{label:"Father's Name",value:f.fatherName},{label:"Village",value:f.village},{label:"District",value:f.district},{label:"Pump Type",value:f.pumpType},{label:"Company",value:f.company}].map((s,y)=>e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:s.label}),e.jsx("p",{className:"font-semibold text-slate-700",children:s.value||"-"})]},y))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"Policy No"}),e.jsx(z,{value:ae.policyNo,onChange:s=>E({...ae,policyNo:s.target.value}),placeholder:"Enter policy number",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"Policy Date"}),e.jsx(z,{type:"date",value:ae.policyDate,onChange:s=>E({...ae,policyDate:s.target.value}),className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"Insurance Company"}),e.jsx(z,{value:ae.insuranceCompany,onChange:s=>E({...ae,insuranceCompany:s.target.value}),placeholder:"Enter company name",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"Insurance Form (PDF/Image)"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(z,{type:"file",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:j,className:"hidden",id:"insurance-form-file"}),e.jsxs(G,{variant:"outline",onClick:()=>{var s;return(s=document.getElementById("insurance-form-file"))==null?void 0:s.click()},className:"border-dashed border-blue-300 bg-blue-50/50 hover:bg-blue-50 text-blue-700 w-full h-24 flex flex-col gap-2 relative overflow-hidden group transition-all",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-100/0 group-hover:bg-blue-100/20 transition-colors"}),e.jsx(Fe,{className:"h-6 w-6 relative z-10"}),e.jsx("span",{className:"relative z-10",children:ae.insuranceForm?"Change File":"Click to upload form"})]}),ae.insuranceForm&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-50 text-green-700 rounded-md border border-green-200 animate-in fade-in slide-in-from-left-2",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:ae.insuranceForm})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-slate-100 pb-6 pr-6",children:[e.jsx(G,{variant:"outline",onClick:()=>ee(!1),disabled:H,className:"px-6 bg-white hover:bg-slate-50 text-slate-700 border-slate-200",children:"Cancel"}),e.jsx(G,{onClick:J,disabled:H,className:"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-lg shadow-cyan-500/20 px-8",children:H?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Submit Insurance"})]})]})]})})})]})}function et(){const[m,v]=d.useState("pending"),[C,_]=d.useState(!1),[w,Z]=d.useState([]),[X,Q]=d.useState([]),[f,ne]=d.useState(null),[ae,E]=d.useState(!1),[re,ee]=d.useState(!0),[D,le]=d.useState(!1),[te,F]=d.useState({}),[H,k]=d.useState([]),[p,T]=d.useState(!1),[u,W]=d.useState({jccReceivingDate:"",jccAgeing:"",jccCopy:null,invoiceDate:"",invoiceNo:"",jccCompletionDate:"",jccAgeingRbp:""}),U=s=>{if(!s)return"";const y=s.match(/[-\w]{25,}/);return`https://drive.google.com/file/d/${y?y[0]:s}/preview`},O=async()=>{console.log("Fetching JCC Data...");try{const s="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",y="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",g=new URLSearchParams({action:"read",sheet:"Project Main",sheetName:"Project Main",id:y.trim()}),c=await fetch(`${s}?${g.toString()}`);if(!c.ok)throw new Error("Network Error");const B=await c.json(),t=Array.isArray(B)?B:B.data||[];if(t.length===0){Z([]),Q([]),ee(!1);return}const P=5;if(!t[P]){ee(!1);return}const b=t[P].map(r=>String(r).trim()).map(r=>r.toLowerCase()),o=r=>b.findIndex(n=>r.every(i=>n.replace(/\s+/g,"").includes(i))),x={serialNo:o(["serial"]),regId:o(["reg","id"]),beneficiaryName:o(["beneficiary","name"]),fatherName:o(["father"]),village:o(["village"]),block:o(["block"]),district:o(["district"]),pumpType:o(["pump","type"]),company:o(["company"]),amount:o(["amount"]),jccReceivingDate:o(["jcc","receiving"]),jccCompletionDate:o(["jcc","completion"]),jccAgeing:o(["jcc","ageing","auto"]),jccCopy:o(["jcc","copy"]),invoiceDate:o(["invoice","date"]),invoiceNo:o(["invoice","no"]),jccAgeingRbp:o(["jcc","ageing","rbp"]),actual6:(()=>{const r=o(["actual","6"]);return r!==-1?r:o(["insurance"])})(),planned7:o(["planned","7"]),actual7:(()=>{const r=o(["actual","7"]);return r!==-1?r:o(["jcc"])})()};x.amount===-1&&(x.amount=o(["total","amount"])),F(x);const S=[],Y=[];for(let r=P+1;r<t.length;r++){const n=t[r];if(!n||!n[x.regId])continue;const i=N=>N!==-1&&n[N]!==void 0?n[N]:"",h={serialNo:i(x.serialNo),regId:i(x.regId),beneficiaryName:i(x.beneficiaryName),fatherName:i(x.fatherName),village:i(x.village),block:i(x.block),district:i(x.district),pumpType:i(x.pumpType),company:i(x.company),amount:i(x.amount),jccReceivingDate:i(x.jccReceivingDate),jccCompletionDate:i(x.jccCompletionDate),jccAgeing:i(x.jccAgeing),jccCopy:i(x.jccCopy),invoiceDate:i(x.invoiceDate),invoiceNo:i(x.invoiceNo),jccAgeingRbp:i(x.jccAgeingRbp),actual6:i(x.actual6),planned7:i(x.planned7),actual7:i(x.actual7),rowIndex:r+1},V=h.planned7&&String(h.planned7).trim()!=="";h.actual7&&String(h.actual7).trim()!==""?Y.push(h):V&&S.push(h)}Z(S),Q(Y)}catch(s){console.error("Fetch Data Error:",s)}finally{ee(!1)}};d.useEffect(()=>{O();const s=setTimeout(()=>ee(!1),15e3);return()=>clearTimeout(s)},[]),d.useEffect(()=>{if(C){const s=setTimeout(()=>{E(!1),setTimeout(()=>_(!1),300)},2e3);return()=>clearTimeout(s)}},[C]),d.useEffect(()=>{if(u.jccCompletionDate&&u.jccReceivingDate){const s=new Date(u.jccCompletionDate),y=new Date(u.jccReceivingDate),g=Math.abs(s.getTime()-y.getTime()),c=Math.ceil(g/(1e3*60*60*24));W(B=>({...B,jccAgeing:`${c} days`}))}},[u.jccCompletionDate,u.jccReceivingDate]);const q=s=>{console.log("Process JCC clicked for:",s),_(!1),T(!1);try{ne(s),W({jccReceivingDate:s.jccReceivingDate||"",jccCompletionDate:s.jccCompletionDate||"",jccAgeing:s.jccAgeing||"",jccCopy:null,invoiceDate:s.invoiceDate||"",invoiceNo:s.invoiceNo||"",jccAgeingRbp:s.jccAgeingRbp||""}),E(!0)}catch(y){console.error("Error opening dialog:",y)}},de=(s,y)=>{k(y?g=>[...g,s]:g=>g.filter(c=>c!==s))},se=()=>{T(!0),ne(null),_(!1),W({jccReceivingDate:"",jccAgeing:"",jccCopy:null,invoiceDate:"",invoiceNo:"",jccCompletionDate:"",jccAgeingRbp:""}),E(!0)},j=s=>{s.target.files&&s.target.files[0]&&W({...u,jccCopy:s.target.files[0].name})},J=async()=>{if(!(!f&&(!p||H.length===0))){le(!0);try{const s="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",y="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo";let g=u.jccCopy;const c=document.getElementById("jcc-copy-file");if(c&&c.files[0]){const b=c.files[0],o=new FileReader;g=await new Promise((x,S)=>{o.onload=async Y=>{const r=Y.target.result.split(",")[1],n=p?`BULK_${Date.now()}_${b.name}`:b.name,i=new URLSearchParams({action:"uploadFile",fileName:n,mimeType:b.type,base64Data:r,folderId:"1pqyJUlUD0zwnojUvNezJgxzim8gjUfmM"});try{const V=await(await fetch(s,{method:"POST",body:i})).json();V.success&&V.fileUrl?x(V.fileUrl):S("Upload failed")}catch(h){S(h)}},o.readAsDataURL(b)})}let B=[];p?B=w.filter(b=>H.includes(b.serialNo)):B=[f];const t=B.map(async b=>{const o={},x=(i,h)=>{const V=te[i];V!==void 0&&V>=0&&(o[V]=h)};x("jccReceivingDate",u.jccReceivingDate),x("jccCompletionDate",u.jccCompletionDate),x("jccAgeing",u.jccAgeing),x("invoiceDate",u.invoiceDate),x("invoiceNo",u.invoiceNo),x("jccAgeingRbp",u.jccAgeingRbp),x("jccCopy",g);const S=new Date,Y=`${S.getFullYear()}/${String(S.getMonth()+1).padStart(2,"0")}/${String(S.getDate()).padStart(2,"0")} ${String(S.getHours()).padStart(2,"0")}:${String(S.getMinutes()).padStart(2,"0")}:${String(S.getSeconds()).padStart(2,"0")}`;x("actual7",Y);const r=new URLSearchParams({action:"update",sheet:"Project Main",sheetName:"Project Main",id:y,rowIndex:b.rowIndex,rowData:JSON.stringify(o)});return(await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r})).json()}),A=(await Promise.all(t)).filter(b=>b.status==="error"||b.result==="error");if(A.length>0)throw new Error(`${A.length} updates failed.`);await O(),ne(null),T(!1),k([]),_(!0)}catch(s){console.error("Submission Error:",s),alert("Error submitting form: "+s.message)}finally{le(!1)}}};return e.jsxs("div",{className:"space-y-8 p-6 md:p-8 max-w-[1600px] mx-auto bg-slate-50/50 min-h-screen animate-fade-in-up",children:[e.jsxs(Ee,{defaultValue:"pending",className:"w-full",onValueChange:v,children:[e.jsxs($e,{className:"grid w-full grid-cols-2 relative p-1 bg-slate-100/80 h-14 rounded-xl border border-slate-200",children:[e.jsx("div",{className:`absolute top-1 bottom-1 left-1 w-[calc(50%-0.5rem)] rounded-lg bg-white shadow-sm transition-all duration-300 ease-in-out ${m==="history"?"translate-x-full":"translate-x-0"}`}),e.jsx(Se,{value:"pending",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Pending Actions"}),e.jsx(Se,{value:"history",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"History & Records"})]}),e.jsx(Ce,{value:"pending",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-left-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(Ke,{className:"h-4 w-4 text-blue-600"})}),"Pending JCC"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[H.length>=2&&e.jsxs(G,{onClick:se,className:"bg-blue-600 hover:bg-blue-700 text-white shadow-md shadow-blue-200 transition-all duration-300 animate-in fade-in slide-in-from-right-4",size:"sm",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"JCC Selected (",H.length,")"]}),e.jsxs($,{variant:"outline",className:"bg-yellow-100 text-yellow-700 border-yellow-200 px-3 py-1",children:[w.length," Pending"]})]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-4 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap w-12",children:"Select"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap min-w-[150px]",children:"Action"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Block"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Type"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:re?Array.from({length:5}).map((s,y)=>e.jsxs(R,{className:"animate-pulse",children:[e.jsx(a,{children:e.jsx("div",{className:"h-8 w-24 bg-slate-200 rounded-full mx-auto"})}),Array.from({length:9}).map((g,c)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded"})},c))]},y)):w.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:10,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(Ke,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No pending JCC records found"})]})})}):w.map(s=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"px-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(ze,{checked:H.includes(s.serialNo),onCheckedChange:y=>de(s.serialNo,y),"aria-label":`Select row ${s.serialNo}`,className:"checkbox-3d border-slate-400 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 h-5 w-5 shadow-sm transition-all duration-300 ease-out active:scale-75 hover:scale-110 data-[state=checked]:scale-110"})})}),e.jsx(a,{children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>q(s),disabled:H.length>=2,className:"bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white border border-blue-200 shadow-xs text-xs font-semibold h-8 px-4 rounded-full flex items-center gap-2 transition-all duration-300 mx-auto disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),"JCC"]})}),e.jsx(a,{className:"whitespace-nowrap font-mono text-xs text-slate-500 bg-slate-50 py-1 px-2 rounded-md mx-auto w-fit",children:s.regId}),e.jsx(a,{className:"whitespace-nowrap font-medium text-slate-800",children:s.beneficiaryName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.village}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.block}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.district}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.pumpType}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.company}),e.jsxs(a,{className:"whitespace-nowrap font-medium text-slate-700",children:["",s.amount]}),e.jsx(a,{children:e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Pending"})})]},s.serialNo))})]})}),e.jsx("div",{className:"block md:hidden space-y-4 p-4 bg-slate-50",children:re?e.jsx("div",{className:"text-center p-4 text-slate-500",children:"Loading..."}):w.map(s=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{variant:"secondary",className:"bg-slate-100 text-slate-600",children:s.serialNo}),e.jsx("h4",{className:"font-semibold text-base text-slate-800",children:s.beneficiaryName}),e.jsx("p",{className:"text-muted-foreground text-xs font-mono",children:s.regId})]}),e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200 text-xs",children:"Pending"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3 text-xs border-t border-b py-3 my-2 border-slate-100",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Father's Name"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.fatherName})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Village"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.village})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"District"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.district})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Company"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.company})]}),e.jsxs("div",{className:"col-span-2 flex justify-between items-center bg-slate-50 p-2 rounded",children:[e.jsx("span",{className:"font-semibold text-slate-600",children:"Amount:"}),e.jsxs("span",{className:"font-bold text-slate-800",children:["",s.amount]})]})]}),e.jsxs(G,{size:"sm",disabled:H.length>=2,className:"w-full bg-linear-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-md disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>q(s),children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Complete JCC"]})]})},s.serialNo))})]})]})}),e.jsx(Ce,{value:"history",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-right-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(pe,{className:"h-4 w-4 text-blue-600"})}),"JCC History"]}),e.jsxs($,{variant:"outline",className:"bg-blue-100 text-blue-700 border-blue-200 px-3 py-1",children:[X.length," Records"]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"JCC Completion Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Invoice No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"JCC Copy"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:re?Array.from({length:5}).map((s,y)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:10}).map((g,c)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded"})},c))},y)):X.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:10,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(pe,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No JCC records yet."})]})})}):X.map(s=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{children:e.jsx("span",{className:"font-mono text-xs text-slate-500 bg-slate-50 py-1 px-2 rounded-md",children:s.regId})}),e.jsx(a,{className:"whitespace-nowrap font-medium text-slate-800",children:s.beneficiaryName}),e.jsx(a,{className:"text-slate-600",children:s.village}),e.jsx(a,{className:"text-slate-600",children:s.district}),e.jsx(a,{className:"text-slate-600",children:s.company}),e.jsxs(a,{className:"text-slate-700 font-medium",children:["",s.amount]}),e.jsx(a,{className:"text-slate-600 bg-blue-50/30",children:s.jccCompletionDate}),e.jsx(a,{className:"font-medium text-blue-700 bg-blue-50/50",children:s.invoiceNo}),e.jsx(a,{children:s.jccCopy?e.jsx($,{variant:"outline",className:"bg-blue-50 text-blue-700 hover:bg-blue-100 cursor-pointer border-blue-200 gap-1",onClick:()=>window.open(U(s.jccCopy),"_blank"),children:s.jccCopy.includes("drive.google.com")?"View Document":"View"}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx(a,{children:e.jsx($,{className:"bg-green-100 text-green-800 border-green-200",children:"Completed"})})]},s.serialNo))})]})}),e.jsx("div",{className:"block md:hidden space-y-4 p-4 bg-slate-50",children:X.map(s=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-semibold text-blue-900",children:s.serialNo}),e.jsx("p",{className:"text-base font-medium text-slate-800",children:s.beneficiaryName}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:[s.district,"  ",s.village]})]}),e.jsx($,{className:"bg-green-100 text-green-800 border-green-200",children:"Completed"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs border-t border-slate-100 pt-2 mt-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Completion:"})," ",s.jccCompletionDate]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Invoice:"})," ",e.jsx("span",{className:"text-blue-700 font-medium",children:s.invoiceNo})]}),e.jsxs("div",{className:"col-span-2 flex justify-between items-center bg-slate-50 p-2 rounded mt-1",children:[e.jsx("span",{className:"font-medium text-slate-600",children:"Amount:"}),e.jsxs("span",{className:"font-bold text-slate-900",children:["",s.amount]})]}),s.jccCopy&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Copy:"})," ",e.jsx("span",{className:"text-blue-600 underline cursor-pointer",onClick:()=>window.open(U(s.jccCopy),"_blank"),children:"View Document"})]})]})]})},s.serialNo))})]})]})})]}),e.jsx(Be,{open:ae,onOpenChange:E,children:e.jsx(Te,{showCloseButton:!C,className:`max-w-4xl max-h-[90vh] overflow-y-auto p-0 gap-0 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none] ${C?"bg-transparent !shadow-none !border-none":"bg-white"}`,children:C?e.jsxs("div",{className:"flex flex-col items-center justify-center w-full p-8 text-center space-y-6 animate-in fade-in duration-300",children:[e.jsx("div",{className:"rounded-full bg-white p-5 shadow-2xl shadow-white/20 ring-8 ring-white/10 animate-in zoom-in duration-500 ease-out",children:e.jsx(Ne,{className:"h-16 w-16 text-green-600 scale-110"})}),e.jsx("h2",{className:"text-3xl font-bold text-white drop-shadow-md animate-in slide-in-from-bottom-4 fade-in duration-500 delay-150 ease-out tracking-wide",children:"Submitted Successfully!"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{className:"p-6 pb-2 border-b border-blue-100 bg-blue-50/30",children:[e.jsxs(Ue,{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 p-1.5 rounded-md",children:e.jsx(Ke,{className:"h-4 w-4 text-blue-600"})}),"Enter JCC Completion Information"]}),e.jsx(Le,{className:"text-slate-500 ml-10",children:p?e.jsxs("span",{children:["Applying changes to ",e.jsxs("span",{className:"font-bold text-blue-700",children:[H.length," selected items"]}),". All fields below will be updated for these items."]}):e.jsxs("span",{children:["Enter Job Completion Certificate details for ",e.jsx("span",{className:"font-semibold text-slate-700",children:f==null?void 0:f.beneficiaryName})]})})]}),(f||p)&&e.jsxs("div",{className:"grid gap-6 p-6",children:[!p&&f&&e.jsxs("div",{className:"rounded-xl border border-blue-100 bg-gradient-to-br from-blue-50/50 to-cyan-50/30 p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-2 border-b border-blue-100/50",children:[e.jsx("span",{className:"bg-white p-1 rounded shadow-sm",children:e.jsx(Ne,{className:"h-4 w-4 text-blue-500"})}),e.jsx("h4",{className:"font-semibold text-blue-900",children:"Beneficiary Details"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-y-4 gap-x-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Serial No"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.serialNo})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Reg ID"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.regId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Beneficiary Name"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.beneficiaryName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Father's Name"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.fatherName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Village"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.village})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Block"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.block})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"District"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.district})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Pump Type"}),e.jsx("p",{className:"font-medium text-slate-700",children:f.pumpType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Company"}),e.jsx("p",{className:"font-medium text-slate-700",children:f.company})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"JCC Receiving Date"}),e.jsx(z,{type:"date",value:u.jccReceivingDate,onChange:s=>W({...u,jccReceivingDate:s.target.value}),className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"JCC Completion Date"}),e.jsx(z,{type:"date",value:u.jccCompletionDate,onChange:s=>W({...u,jccCompletionDate:s.target.value}),className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"JCC Ageing (Auto)"}),e.jsx(z,{value:u.jccAgeing,readOnly:!0,placeholder:"Calculated automatically",className:"border-slate-200 bg-slate-50 text-slate-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"Invoice Date"}),e.jsx(z,{type:"date",value:u.invoiceDate,onChange:s=>W({...u,invoiceDate:s.target.value}),className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"Invoice No"}),e.jsx(z,{value:u.invoiceNo,onChange:s=>W({...u,invoiceNo:s.target.value}),placeholder:"Enter invoice number",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"JCC Ageing (RBP)"}),e.jsx(z,{value:u.jccAgeingRbp,onChange:s=>W({...u,jccAgeingRbp:s.target.value}),placeholder:"Enter RBP ageing",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"JCC Copy"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(z,{type:"file",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",onChange:j,className:"hidden",id:"jcc-copy-file"}),e.jsxs(G,{variant:"outline",onClick:()=>{var s;return(s=document.getElementById("jcc-copy-file"))==null?void 0:s.click()},className:"border-dashed border-blue-300 bg-blue-50/50 hover:bg-blue-50 text-blue-700 w-full h-24 flex flex-col gap-2 relative overflow-hidden group transition-all",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-100/0 group-hover:bg-blue-100/20 transition-colors"}),e.jsx(Fe,{className:"h-6 w-6 relative z-10"}),e.jsx("span",{className:"relative z-10",children:u.jccCopy?"Change JCC Copy":"Click to upload JCC Copy (PDF/Image/Word)"})]}),u.jccCopy&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-50 text-green-700 rounded-md border border-green-200 whitespace-nowrap self-start",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:u.jccCopy})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4 pt-4 border-t border-slate-100 pb-6 pr-6",children:[e.jsx(G,{variant:"outline",onClick:()=>E(!1),disabled:D,className:"px-6 bg-white hover:bg-slate-50 text-slate-700 border-slate-200",children:"Cancel"}),e.jsx(G,{onClick:J,disabled:D,className:"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-lg shadow-cyan-500/20 px-8",children:D?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Submit JCC"})]})]})]})})})]})}function st(){const[m,v]=d.useState("pending"),[C,_]=d.useState(!1),[w,Z]=d.useState([]),[X,Q]=d.useState([]),[f,ne]=d.useState(null),[ae,E]=d.useState(!1),[re,ee]=d.useState(!0),[D,le]=d.useState(!1),[te,F]=d.useState({}),[H,k]=d.useState([]),[p,T]=d.useState(!1),[u,W]=d.useState({jccAtDo:"",doJccReceivingFile:null,doAgeing:"",jccAtRo:"",roAgeing:"",jccAtZo:"",zoAgeing:"",jccAtHo:"",hoAgeing:""}),U=s=>{if(!s)return"";const y=s.match(/[-\w]{25,}/);return`https://drive.google.com/file/d/${y?y[0]:s}/preview`},O=async()=>{console.log("Fetching JCC Status Data...");try{const s="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",y="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",g=new URLSearchParams({action:"read",sheet:"Project Main",sheetName:"Project Main",id:y.trim()}),c=await fetch(`${s}?${g.toString()}`);if(!c.ok)throw new Error("Network Error");const B=await c.json(),t=Array.isArray(B)?B:B.data||[];if(t.length===0){Z([]),Q([]),ee(!1);return}const P=5;if(!t[P]){ee(!1);return}const b=t[P].map(n=>String(n).trim()).map(n=>n.toLowerCase()),o=n=>b.findIndex(i=>n.every(h=>i.replace(/\s+/g,"").includes(h))),x={serialNo:o(["serial"]),regId:o(["reg","id"]),beneficiaryName:o(["beneficiary","name"]),fatherName:o(["father"]),village:o(["village"]),block:o(["block"]),district:o(["district"]),pumpType:o(["pump","type"]),company:o(["company"]),jccCertificateNo:o(["invoice","no"]),jccDate:o(["jcc","completion"]),jccAtDo:o(["jcc","at","do"]),doJccReceivingFile:o(["do","jcc","receiving"]),doAgeing:o(["do","ageing"]),jccAtRo:o(["ro","date"]),roAgeing:o(["ro","ageing"]),jccAtZo:o(["zo","date"]),zoAgeing:o(["zo","ageing"]),jccAtHo:o(["ho","date"]),hoAgeing:o(["ho","ageing"]),actual7:(()=>{const n=o(["actual","7"]);return n!==-1?n:o(["jcc","completion"])})(),planned8:o(["planned","8"]),actual8:(()=>{const n=o(["actual","8"]);return n!==-1?n:o(["jcc","status"])})()},S=o(["jcc","cert"]);S!==-1&&(x.jccCertificateNo=S),F(x);const Y=[],r=[];for(let n=P+1;n<t.length;n++){const i=t[n];if(!i||!i[x.regId])continue;const h=L=>L!==-1&&i[L]!==void 0?i[L]:"",V={serialNo:h(x.serialNo),regId:h(x.regId),beneficiaryName:h(x.beneficiaryName),fatherName:h(x.fatherName),village:h(x.village),block:h(x.block),district:h(x.district),pumpType:h(x.pumpType),company:h(x.company),jccCertificateNo:h(x.jccCertificateNo),jccDate:h(x.jccDate),jccAtDo:h(x.jccAtDo),doJccReceivingFile:h(x.doJccReceivingFile),doAgeing:h(x.doAgeing),jccAtRo:h(x.jccAtRo),roAgeing:h(x.roAgeing),jccAtZo:h(x.jccAtZo),zoAgeing:h(x.zoAgeing),jccAtHo:h(x.jccAtHo),hoAgeing:h(x.hoAgeing),actual7:h(x.actual7),planned8:h(x.planned8),actual8:h(x.actual8),rowIndex:n+1},I=V.planned8&&String(V.planned8).trim()!=="";V.actual8&&String(V.actual8).trim()!==""?r.push(V):I&&Y.push(V)}Z(Y),Q(r)}catch(s){console.error("Fetch Data Error:",s)}finally{ee(!1)}};d.useEffect(()=>{O();const s=setTimeout(()=>ee(!1),15e3);return()=>clearTimeout(s)},[]),d.useEffect(()=>{if(C){const s=setTimeout(()=>{E(!1),setTimeout(()=>_(!1),300)},2e3);return()=>clearTimeout(s)}},[C]);const q=s=>{T(!1),ne(s),_(!1),W({jccAtDo:s.jccAtDo||"",doJccReceivingFile:s.doJccReceivingFile||null,doAgeing:s.doAgeing||"",jccAtRo:s.jccAtRo||"",roAgeing:s.roAgeing||"",jccAtZo:s.jccAtZo||"",zoAgeing:s.zoAgeing||"",jccAtHo:s.jccAtHo||"",hoAgeing:s.hoAgeing||""}),E(!0)},de=(s,y)=>{k(y?g=>[...g,s]:g=>g.filter(c=>c!==s))},se=()=>{T(!0),ne(null),_(!1),W({jccAtDo:"",doJccReceivingFile:null,doAgeing:"",jccAtRo:"",roAgeing:"",jccAtZo:"",zoAgeing:"",jccAtHo:"",hoAgeing:""}),E(!0)},j=s=>{s.target.files&&s.target.files[0]&&W({...u,doJccReceivingFile:s.target.files[0].name})},J=async()=>{if(!(!f&&(!p||H.length===0))){le(!0);try{const s="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",y="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo";let g=u.doJccReceivingFile;const c=document.getElementById("do-jcc-receiving-file");if(c&&c.files[0]){const b=c.files[0],o=new FileReader;g=await new Promise((x,S)=>{o.onload=async Y=>{const r=Y.target.result.split(",")[1],n=p?`BULK_${Date.now()}_${b.name}`:b.name,i=new URLSearchParams({action:"uploadFile",fileName:n,mimeType:b.type,base64Data:r,folderId:"1pqyJUlUD0zwnojUvNezJgxzim8gjUfmM"});try{const V=await(await fetch(s,{method:"POST",body:i})).json();V.success&&V.fileUrl?x(V.fileUrl):S("Upload failed")}catch(h){S(h)}},o.readAsDataURL(b)})}let B=[];p?B=w.filter(b=>H.includes(b.serialNo)):B=[f];const t=B.map(async b=>{const o={},x=(i,h)=>{const V=te[i];V!==void 0&&V>=0&&(o[V]=h)};x("jccAtDo",u.jccAtDo),x("doJccReceivingFile",g),x("doAgeing",u.doAgeing),x("jccAtRo",u.jccAtRo),x("roAgeing",u.roAgeing),x("jccAtZo",u.jccAtZo),x("zoAgeing",u.zoAgeing),x("jccAtHo",u.jccAtHo),x("hoAgeing",u.hoAgeing);const S=new Date,Y=`${S.getFullYear()}/${String(S.getMonth()+1).padStart(2,"0")}/${String(S.getDate()).padStart(2,"0")} ${String(S.getHours()).padStart(2,"0")}:${String(S.getMinutes()).padStart(2,"0")}:${String(S.getSeconds()).padStart(2,"0")}`;x("actual8",Y);const r=new URLSearchParams({action:"update",sheet:"Project Main",sheetName:"Project Main",id:y,rowIndex:b.rowIndex,rowData:JSON.stringify(o)});return(await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r})).json()}),A=(await Promise.all(t)).filter(b=>b.status==="error"||b.result==="error");if(A.length>0)throw new Error(`${A.length} updates failed.`);await O(),ne(null),T(!1),k([]),_(!0)}catch(s){console.error("Submission Error:",s),alert("Error submitting form: "+s.message)}finally{le(!1)}}};return e.jsxs("div",{className:"space-y-8 p-6 md:p-8 max-w-[1600px] mx-auto bg-slate-50/50 min-h-screen animate-fade-in-up",children:[e.jsxs(Ee,{defaultValue:"pending",className:"w-full",onValueChange:v,children:[e.jsxs($e,{className:"grid w-full grid-cols-2 relative p-1 bg-slate-100/80 h-14 rounded-xl border border-slate-200",children:[e.jsx("div",{className:`absolute top-1 bottom-1 left-1 w-[calc(50%-0.5rem)] rounded-lg bg-white shadow-sm transition-all duration-300 ease-in-out ${m==="history"?"translate-x-full":"translate-x-0"}`}),e.jsx(Se,{value:"pending",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Pending Actions"}),e.jsx(Se,{value:"history",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"History & Records"})]}),e.jsx(Ce,{value:"pending",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-left-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(qe,{className:"h-4 w-4 text-blue-600"})}),"Pending Status Updates"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[H.length>=2&&e.jsxs(G,{onClick:se,className:"bg-blue-600 hover:bg-blue-700 text-white shadow-md shadow-blue-200 transition-all duration-300 animate-in fade-in slide-in-from-right-4",size:"sm",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Status Selected (",H.length,")"]}),e.jsxs($,{variant:"outline",className:"bg-yellow-100 text-yellow-700 border-yellow-200 px-3 py-1",children:[w.length," Pending"]})]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-4 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap w-12",children:"Select"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap min-w-[150px]",children:"Action"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Block"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"JCC Cert No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"JCC Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:re?Array.from({length:5}).map((s,y)=>e.jsxs(R,{className:"animate-pulse",children:[e.jsx(a,{children:e.jsx("div",{className:"h-8 w-24 bg-slate-200 rounded-full mx-auto"})}),Array.from({length:9}).map((g,c)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded"})},c))]},y)):w.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:10,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(qe,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No pending JCC status records found"})]})})}):w.map(s=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"px-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(ze,{checked:H.includes(s.serialNo),onCheckedChange:y=>de(s.serialNo,y),"aria-label":`Select row ${s.serialNo}`,className:"checkbox-3d border-slate-400 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 h-5 w-5 shadow-sm transition-all duration-300 ease-out active:scale-75 hover:scale-110 data-[state=checked]:scale-110"})})}),e.jsx(a,{children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>q(s),disabled:H.length>=2,className:"bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white border border-blue-200 shadow-xs text-xs font-semibold h-8 px-4 rounded-full flex items-center gap-2 transition-all duration-300 mx-auto disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"Status"]})}),e.jsx(a,{className:"whitespace-nowrap font-mono text-xs text-slate-500 bg-slate-50 py-1 px-2 rounded-md mx-auto w-fit",children:s.regId}),e.jsx(a,{className:"whitespace-nowrap font-medium text-slate-800",children:s.beneficiaryName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.village}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.block}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.district}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.company}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.jccCertificateNo||"-"}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.jccDate||"-"}),e.jsx(a,{children:e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Pending"})})]},s.serialNo))})]})}),e.jsx("div",{className:"block md:hidden space-y-4 p-4 bg-slate-50",children:re?e.jsx("div",{className:"text-center p-4 text-slate-500",children:"Loading..."}):w.map(s=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{variant:"secondary",className:"bg-slate-100 text-slate-600",children:s.serialNo}),e.jsx("h4",{className:"font-semibold text-base text-slate-800",children:s.beneficiaryName}),e.jsx("p",{className:"text-muted-foreground text-xs font-mono",children:s.regId})]}),e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200 text-xs",children:"Pending"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3 text-xs border-t border-b py-3 my-2 border-slate-100",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Father's Name"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.fatherName})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Village"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.village})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"District"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.district})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Company"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.company})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium text-slate-600",children:"JCC Cert:"})," ",e.jsx("span",{className:"text-slate-800",children:s.jccCertificateNo||"-"})]})]}),e.jsxs(G,{size:"sm",disabled:H.length>=2,className:"w-full bg-linear-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-md disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>q(s),children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Update Status"]})]})},s.serialNo))})]})]})}),e.jsx(Ce,{value:"history",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-right-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(pe,{className:"h-4 w-4 text-blue-600"})}),"JCC Status History"]}),e.jsxs($,{variant:"outline",className:"bg-blue-100 text-blue-700 border-blue-200 px-3 py-1",children:[X.length," Records"]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"JCC Cert No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"JCC at DO"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"JCC at HO"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:re?Array.from({length:5}).map((s,y)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:9}).map((g,c)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded"})},c))},y)):X.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:9,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(pe,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No JCC status records yet."})]})})}):X.map(s=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{children:e.jsx("span",{className:"font-mono text-xs text-slate-500 bg-slate-50 py-1 px-2 rounded-md",children:s.regId})}),e.jsx(a,{className:"whitespace-nowrap font-medium text-slate-800",children:s.beneficiaryName}),e.jsx(a,{className:"text-slate-600",children:s.village}),e.jsx(a,{className:"text-slate-600",children:s.district}),e.jsx(a,{className:"text-slate-600",children:s.company}),e.jsx(a,{className:"text-slate-600",children:s.jccCertificateNo||"-"}),e.jsx(a,{className:"text-slate-600 bg-blue-50/30",children:s.jccAtDo||"-"}),e.jsx(a,{className:"text-slate-600 bg-blue-50/30",children:s.jccAtHo||"-"}),e.jsx(a,{children:e.jsx($,{className:"bg-green-100 text-green-800 border-green-200",children:"Completed"})})]},s.serialNo))})]})}),e.jsx("div",{className:"block md:hidden space-y-4 p-4 bg-slate-50",children:X.map(s=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-semibold text-blue-900",children:["#",s.serialNo]}),e.jsx("p",{className:"text-base font-medium text-slate-800",children:s.beneficiaryName}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:[s.district,"  ",s.village]})]}),e.jsx($,{className:"bg-green-100 text-green-800 border-green-200",children:"Completed"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs border-t border-slate-100 pt-2 mt-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-500",children:"JCC at DO:"})," ",s.jccAtDo||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-500",children:"JCC at HO:"})," ",s.jccAtHo||"-"]}),s.doJccReceivingFile&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium text-slate-500",children:"DO File:"})," ",e.jsx("span",{className:"text-blue-600 underline cursor-pointer",onClick:()=>window.open(U(s.doJccReceivingFile),"_blank"),children:"View Document"})]})]})]})},s.serialNo))})]})]})})]}),e.jsx(Be,{open:ae,onOpenChange:E,children:e.jsx(Te,{showCloseButton:!C,className:`max-w-4xl max-h-[90vh] overflow-y-auto p-0 gap-0 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none] ${C?"bg-transparent !shadow-none !border-none":"bg-white"}`,children:C?e.jsxs("div",{className:"flex flex-col items-center justify-center w-full p-8 text-center space-y-6 animate-in fade-in duration-300",children:[e.jsx("div",{className:"rounded-full bg-white p-5 shadow-2xl shadow-white/20 ring-8 ring-white/10 animate-in zoom-in duration-500 ease-out",children:e.jsx(Ne,{className:"h-16 w-16 text-green-600 scale-110"})}),e.jsx("h2",{className:"text-3xl font-bold text-white drop-shadow-md animate-in slide-in-from-bottom-4 fade-in duration-500 delay-150 ease-out tracking-wide",children:"Submitted Successfully!"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{className:"p-6 pb-2 border-b border-blue-100 bg-blue-50/30",children:[e.jsxs(Ue,{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 p-1.5 rounded-md",children:e.jsx(qe,{className:"h-4 w-4 text-blue-600"})}),"Enter JCC Status Information"]}),e.jsx(Le,{className:"text-slate-500 ml-10",children:p?e.jsxs("span",{children:["Applying changes to ",e.jsxs("span",{className:"font-bold text-blue-700",children:[H.length," selected items"]}),". All fields below will be updated for these items."]}):e.jsxs("span",{children:["Enter JCC status details for ",e.jsx("span",{className:"font-semibold text-slate-700",children:f==null?void 0:f.beneficiaryName})]})})]}),(f||p)&&e.jsxs("div",{className:"grid gap-6 p-6",children:[!p&&f&&e.jsxs("div",{className:"rounded-xl border border-blue-100 bg-gradient-to-br from-blue-50/50 to-cyan-50/30 p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-2 border-b border-blue-100/50",children:[e.jsx("span",{className:"bg-white p-1 rounded shadow-sm",children:e.jsx(Ne,{className:"h-4 w-4 text-blue-500"})}),e.jsx("h4",{className:"font-semibold text-blue-900",children:"Beneficiary Details"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-y-4 gap-x-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Serial No"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.serialNo})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Reg ID"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.regId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Beneficiary Name"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.beneficiaryName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Father's Name"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.fatherName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Village"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.village})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Block"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.block})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"District"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.district})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Pump Type"}),e.jsx("p",{className:"font-medium text-slate-700",children:f.pumpType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Company"}),e.jsx("p",{className:"font-medium text-slate-700",children:f.company})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"JCC at DO (Date)"}),e.jsx(z,{type:"date",value:u.jccAtDo,onChange:s=>W({...u,jccAtDo:s.target.value}),className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"DO JCC Receiving (File)"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(z,{type:"file",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",onChange:j,className:"hidden",id:"do-jcc-receiving-file"}),e.jsxs(G,{variant:"outline",onClick:()=>{var s;return(s=document.getElementById("do-jcc-receiving-file"))==null?void 0:s.click()},className:"border-dashed border-blue-300 bg-blue-50/50 hover:bg-blue-50 text-blue-700 w-full h-24 flex flex-col gap-2 relative overflow-hidden group transition-all",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-100/0 group-hover:bg-blue-100/20 transition-colors"}),e.jsx(Fe,{className:"h-6 w-6 relative z-10"}),e.jsx("span",{className:"relative z-10",children:u.doJccReceivingFile?"Change File":"Click to upload DO File"})]}),u.doJccReceivingFile&&e.jsxs("div",{className:"flex items-center gap-2 p-1.5 bg-green-50 text-green-700 rounded-md border border-green-200 text-xs self-start",children:[e.jsx(Ne,{className:"h-3 w-3"}),e.jsx("span",{className:"font-medium truncate max-w-[200px]",children:u.doJccReceivingFile})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"DO Ageing"}),e.jsx(z,{value:u.doAgeing,onChange:s=>W({...u,doAgeing:s.target.value}),placeholder:"Enter DO Ageing",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"JCC at RO (Date)"}),e.jsx(z,{type:"date",value:u.jccAtRo,onChange:s=>W({...u,jccAtRo:s.target.value}),className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"RO Ageing"}),e.jsx(z,{value:u.roAgeing,onChange:s=>W({...u,roAgeing:s.target.value}),placeholder:"Enter RO Ageing",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"JCC at ZO (Date)"}),e.jsx(z,{type:"date",value:u.jccAtZo,onChange:s=>W({...u,jccAtZo:s.target.value}),className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"ZO Ageing"}),e.jsx(z,{value:u.zoAgeing,onChange:s=>W({...u,zoAgeing:s.target.value}),placeholder:"Enter ZO Ageing",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"JCC at HO (Date)"}),e.jsx(z,{type:"date",value:u.jccAtHo,onChange:s=>W({...u,jccAtHo:s.target.value}),className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"HO Ageing"}),e.jsx(z,{value:u.hoAgeing,onChange:s=>W({...u,hoAgeing:s.target.value}),placeholder:"Enter HO Ageing",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 bg-white"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4 pt-4 border-t border-slate-100 pb-6 pr-6",children:[e.jsx(G,{variant:"outline",onClick:()=>E(!1),disabled:D,className:"px-6 bg-white hover:bg-slate-50 text-slate-700 border-slate-200",children:"Cancel"}),e.jsx(G,{onClick:J,disabled:D,className:"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-lg shadow-cyan-500/20 px-8",children:D?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Submit Status"})]})]})]})})})]})}function at(){const[m,v]=d.useState(""),[C,_]=d.useState(""),[w,Z]=d.useState(""),[X,Q]=d.useState(!1),[f,ne]=d.useState(!1),ae=ts(),E=async re=>{re.preventDefault(),Q(!0),Z("");try{const ee="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",D="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo";console.log("Attempting login..."),console.log("Script URL:",ee);const le=D.trim();console.log("Sheet ID:",le);const te=new URLSearchParams({action:"read",sheet:"Login Master",sheetName:"Login Master",id:le}),F=await fetch(`${ee}?${te.toString()}`);if(!F.ok)throw new Error("Failed to connect to login server.");const H=await F.json();if(console.log("Login Data Received:",H),H.success===!1)throw console.error("API Error:",H.error),new Error(H.error||"Sheet connection failed");const k=Array.isArray(H)?H:H.data||[];if(k.length<2){console.warn("No data rows found (only header or empty)."),Z("No user data available.");return}const p=k[0].map(O=>String(O).toLowerCase().trim().replace(/\s+/g,""));console.log("Parsed Headers:",p);const T=p.indexOf("userid"),u=p.indexOf("pass"),W=u!==-1?u:p.indexOf("password");if(T===-1||W===-1){console.error("Critical: 'User ID' or 'Pass' column not found in headers."),Z("Server Error: Invalid Sheet Structure.");return}let U=null;for(let O=1;O<k.length;O++){const q=k[O];if(!q||q.length<=Math.max(T,W))continue;const de=String(q[T]).trim(),se=String(q[W]).trim();if(de===m.trim()&&se===C.trim()){U={},k[0].forEach((j,J)=>{U[j]=q[J]});break}}U?(console.log("User matched:",U),localStorage.setItem("isAuthenticated","true"),localStorage.setItem("username",U["User Name"]||m),localStorage.setItem("userRole",U.Role||"User"),ae("/dashboard")):(console.warn("No matching user found for:",m),Z("Invalid User ID or Password"))}catch(ee){console.error("Login Error:",ee),Z(ee.message||"Something went wrong. Please try again.")}finally{Q(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden bg-slate-50",children:[e.jsx("style",{children:`
        @keyframes blob-1 {
          0% { transform: translate(0px, 0px) scale(1); }
          33% { transform: translate(300px, -50px) scale(1.2); }
          66% { transform: translate(100px, 150px) scale(0.8); }
          100% { transform: translate(0px, 0px) scale(1); }
        }
        @keyframes blob-2 {
          0% { transform: translate(0px, 0px) scale(1); }
          33% { transform: translate(-250px, 100px) scale(1.1); }
          66% { transform: translate(50px, 50px) scale(0.9); }
          100% { transform: translate(0px, 0px) scale(1); }
        }
        @keyframes blob-3 {
          0% { transform: translate(0px, 0px) scale(1); }
          33% { transform: translate(-150px, -150px) scale(0.9); }
          66% { transform: translate(100px, -50px) scale(1.3); }
          100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob-1 {
          animation: blob-1 20s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
        }
        .animate-blob-2 {
          animation: blob-2 20s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
        }
        .animate-blob-3 {
          animation: blob-3 20s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
        }
      `}),e.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-blue-400/20 rounded-full blur-[100px] mix-blend-multiply animate-blob-1"}),e.jsx("div",{className:"absolute top-[10%] right-[-10%] w-[50%] h-[50%] bg-cyan-400/20 rounded-full blur-[100px] mix-blend-multiply animate-blob-2"}),e.jsx("div",{className:"absolute bottom-[-10%] left-[20%] w-[50%] h-[50%] bg-purple-400/20 rounded-full blur-[100px] mix-blend-multiply animate-blob-3"})]}),e.jsxs(ce,{className:"w-full max-w-md border border-white/40 shadow-2xl bg-white/60 backdrop-blur-xl rounded-3xl relative z-10 overflow-hidden animate-fade-in-up",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-cyan-500 to-blue-600"}),e.jsxs(ge,{className:"space-y-4 text-center pt-8 pb-8",children:[e.jsx("div",{className:"mx-auto bg-white p-4 rounded-2xl shadow-lg shadow-blue-500/10 mb-1 border border-blue-50",children:e.jsx(js,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-slate-800",children:"Welcome Back"}),e.jsx("p",{className:"text-slate-500 text-sm font-medium",children:"Enter your credentials to access the admin portal"})]})]}),e.jsxs(oe,{className:"px-8 pb-10 space-y-6",children:[e.jsxs("form",{onSubmit:E,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"username",className:"text-xs font-semibold text-slate-600 uppercase tracking-wider ml-1",children:"User ID"}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors",children:e.jsx(ua,{className:"h-5 w-5"})}),e.jsx(z,{id:"username",type:"text",placeholder:"Enter User ID",value:m,onChange:re=>v(re.target.value),className:"pl-10 h-11 bg-white/50 border-slate-200 focus-visible:ring-2 focus-visible:ring-blue-500/20 focus-visible:border-blue-200 transition-all rounded-xl shadow-sm text-base"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"password",className:"text-xs font-semibold text-slate-600 uppercase tracking-wider ml-1",children:"Password"}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors",children:e.jsx(ba,{className:"h-5 w-5"})}),e.jsx(z,{id:"password",type:f?"text":"password",placeholder:"Enter your password",value:C,onChange:re=>_(re.target.value),className:"pl-10 pr-10 h-11 bg-white/50 border-slate-200 focus-visible:ring-2 focus-visible:ring-blue-500/20 focus-visible:border-blue-200 transition-all rounded-xl shadow-sm text-base"}),e.jsxs(G,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-11 w-11 text-slate-400 hover:text-blue-600 hover:bg-transparent",onClick:()=>ne(!f),children:[f?e.jsx(ga,{className:"h-4 w-4"}):e.jsx(fa,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:f?"Hide password":"Show password"})]})]})]}),w&&e.jsx("div",{className:"bg-red-50 border border-red-100 text-red-600 text-sm py-2 px-3 rounded-lg text-center font-medium animate-in fade-in slide-in-from-top-1",children:w}),e.jsx(G,{type:"submit",className:"w-full h-12 bg-linear-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white shadow-lg shadow-blue-500/25 transition-all duration-300 rounded-xl font-semibold text-base hover:scale-[1.02] active:scale-[0.98]",disabled:X,children:X?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Verifying..."})]}):e.jsxs("span",{className:"flex items-center justify-center gap-2",children:["Sign In to Dashboard ",e.jsx(ja,{className:"w-5 h-5"})]})})]}),e.jsx("div",{className:"text-center pt-2",children:e.jsxs("p",{className:"text-[10px] text-slate-400 font-medium tracking-widest uppercase flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-slate-200"}),"Powered By Botivate",e.jsx("span",{className:"w-8 h-[1px] bg-slate-200"})]})})]})]})]})}function tt(){const[m,v]=d.useState([]),[C,_]=d.useState([]),[w,Z]=d.useState(null),[X,Q]=d.useState(!1),[f,ne]=d.useState("pending"),[ae,E]=d.useState(!1),[re,ee]=d.useState([]),[D,le]=d.useState(!1),te=(r,n)=>{ee(n?i=>[...i,r]:i=>i.filter(h=>h!==r))},[F,H]=d.useState({beneficiaryName:"",company:"",installer:"",otherRemark:"",loiFileName:null,loiFileObj:null,mrNo:"",mrDate:"",amount:"",paidBy:"",beneficiaryShare:""}),[k,p]=d.useState([]),[T,u]=d.useState([]),[W,U]=d.useState({}),[O,q]=d.useState({}),[de,se]=d.useState(!0),[j,J]=d.useState(!1),[s,y]=d.useState(!1),[g,c]=d.useState(null),B=async()=>{se(!0);try{const r="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",n="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",i=new URLSearchParams({action:"read",sheet:"Project Main",sheetName:"Project Main",id:n.trim()}),h=await fetch(`${r}?${i.toString()}`);if(!h.ok)throw new Error("Network Error");const V=await h.json(),I=Array.isArray(V)?V:V.data||[];if(I.length===0){v([]),se(!1);return}let N=-1;const L=["regid","beneficiaryname","village"];for(let ke=0;ke<Math.min(I.length,10);ke++){const ue=I[ke];if(!Array.isArray(ue))continue;const De=ue.map(Ye=>String(Ye).toLowerCase().replace(/\s+/g,""));if(L.filter(Ye=>De.includes(Ye)).length>=2){N=ke;break}}if(N===-1&&I.length>5&&(N=5),N===-1||!I[N]){console.error("Could not identify header row"),se(!1);return}const K=I[N].map(ke=>String(ke).trim()),he=K.map(ke=>ke.toLowerCase()),xe=ke=>he.findIndex(ue=>ke.every(De=>ue.includes(De))),ie={serialNo:xe(["serial"]),regId:xe(["reg","id"]),beneficiaryName:xe(["beneficiary","name"]),fatherName:xe(["father"]),village:xe(["village"]),block:xe(["block"]),district:xe(["district"]),category:xe(["category"]),pumpSource:xe(["pump","source"]),pumpType:xe(["pump","type"]),planned1:xe(["planned","1"]),actual1:xe(["actual","1"]),delay1:xe(["delay","1"]),company:xe(["company"]),installer:xe(["installer"]),loiFileName:xe(["loi","file"]),mrNo:xe(["mr","no"]),mrDate:xe(["mr","date"]),amount:xe(["amount"]),paidBy:xe(["paid","by"]),beneficiaryShare:xe(["share"]),otherRemark:xe(["remark"])},Ve={};Object.keys(ie).forEach(ke=>{ie[ke]!==-1&&(Ve[ke]=K[ie[ke]])}),U(Ve),q(ie);const rs=[],ns=[];for(let ke=N+1;ke<I.length;ke++){const ue=I[ke];if(!ue||ue.length===0||ie.regId===-1||!ue[ie.regId])continue;const De={serialNo:ue[ie.serialNo]||"-",regId:ue[ie.regId]||"-",beneficiaryName:ue[ie.beneficiaryName]||"-",fatherName:ue[ie.fatherName]||"-",village:ue[ie.village]||"-",block:ue[ie.block]||"-",district:ue[ie.district]||"-",category:ue[ie.category]||"-",pumpSource:ue[ie.pumpSource]||"-",pumpType:ue[ie.pumpType]||"-",company:ue[ie.company]||"-",installer:ue[ie.installer]||"",loiFileName:ue[ie.loiFileName]||"",mrNo:ue[ie.mrNo]||"",mrDate:ue[ie.mrDate]||"",amount:ue[ie.amount]||"",paidBy:ue[ie.paidBy]||"",beneficiaryShare:ue[ie.beneficiaryShare]||"",otherRemark:ue[ie.otherRemark]||"",actual1:ue[ie.actual1]||"",planned1:ue[ie.planned1]||"",rowIndex:ke+1},Ye=De.planned1&&String(De.planned1).trim()!=="",ks=!De.actual1||String(De.actual1).trim()==="";Ye&&ks?rs.push(De):De.actual1&&String(De.actual1).trim()!==""&&ns.push(De)}v(rs),_(ns),y(!0)}catch(r){console.error("Error fetching data:",r)}finally{se(!1)}},t=async()=>{try{const r="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",n="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",i=new URLSearchParams({action:"read",sheet:"Master Drop-Down",sheetName:"Master Drop-Down",id:n.trim()}),h=await fetch(`${r}?${i.toString()}`);if(!h.ok)return;const V=await h.json(),I=Array.isArray(V)?V:V.data||[];if(I.length<2)return;const N=I[0].map(ie=>String(ie).trim().toLowerCase()),L=N.findIndex(ie=>ie.includes("installer")),K=N.findIndex(ie=>ie.includes("share")&&(ie.includes("beneficiary")||ie.includes("benificiary")));if(L===-1&&K===-1)return;const he=new Set,xe=new Set;for(let ie=1;ie<I.length;ie++){const Ve=I[ie];Ve&&(L!==-1&&Ve[L]&&he.add(String(Ve[L]).trim()),K!==-1&&Ve[K]&&xe.add(String(Ve[K]).trim()))}p(Array.from(he).filter(Boolean).sort()),u(Array.from(xe).filter(Boolean).sort())}catch(r){console.error("Error fetching master data:",r)}};d.useEffect(()=>{B(),t()},[]),d.useEffect(()=>{if(ae){const r=setTimeout(()=>{Q(!1),setTimeout(()=>E(!1),300)},2e3);return()=>clearTimeout(r)}},[ae]);const P=r=>{Z(r),le(!1),E(!1),H({beneficiaryName:r.beneficiaryName,company:r.company,installer:"",otherRemark:"",loiFileName:null,loiFileObj:null,mrNo:"",mrDate:"",amount:"",paidBy:"",beneficiaryShare:""}),Q(!0)},A=()=>{re.length<2||(Z(null),le(!0),E(!1),H({beneficiaryName:"Multiple Beneficiaries",company:"Multiple Companies",installer:"",otherRemark:"",loiFileName:null,loiFileObj:null,mrNo:"",mrDate:"",amount:"",paidBy:"",beneficiaryShare:""}),Q(!0))},b=r=>{if(r.target.files&&r.target.files[0]){const n=r.target.files[0];H({...F,loiFileName:n.name,loiFileObj:n})}},o=r=>new Promise((n,i)=>{const h=new FileReader;h.readAsDataURL(r),h.onload=()=>n(h.result.split(",")[1]),h.onerror=V=>i(V)}),x=r=>{const n=i=>String(i).padStart(2,"0");return`${r.getFullYear()}-${n(r.getMonth()+1)}-${n(r.getDate())} ${n(r.getHours())}:${n(r.getMinutes())}:${n(r.getSeconds())}`},S=r=>{if(!r||r.includes("/preview"))return r;const n=r.match(/[-\w]{25,}/);return n?`https://drive.google.com/file/d/${n[0]}/preview`:r},Y=async()=>{if(!(!w&&!D)){J(!0);try{const r="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",n="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo";let i="";if(F.loiFileObj){const I=await o(F.loiFileObj),N=new URLSearchParams({action:"uploadFile",base64Data:I,fileName:F.loiFileObj.name,mimeType:F.loiFileObj.type,folderId:"1pqyJUlUD0zwnojUvNezJgxzim8gjUfmM"}),L="1pqyJUlUD0zwnojUvNezJgxzim8gjUfmM",he=await(await fetch(r,{method:"POST",body:N})).json();if(!he.success||!he.fileUrl)throw new Error("File upload failed");i=he.fileUrl}const V=(D?m.filter(I=>re.includes(I.serialNo)):[w]).map(async I=>{const N={},L=(he,xe)=>{const ie=O[he];ie!==void 0&&ie>=0&&xe!==""&&(N[ie]=xe)};L("installer",F.installer),L("beneficiaryShare",F.beneficiaryShare),L("mrNo",F.mrNo?`'${F.mrNo}`:""),L("mrDate",F.mrDate),L("amount",F.amount),L("paidBy",F.paidBy),L("otherRemark",F.otherRemark),L("actual1",x(new Date)),i&&L("loiFileName",i);const K=new URLSearchParams({action:"update",sheetName:"Project Main",id:n,rowIndex:I.rowIndex,rowData:JSON.stringify(N)});return fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:K.toString()})});await Promise.all(V),E(!0),B(),D&&ee([])}catch(r){console.error(r)}finally{J(!1)}}};return e.jsxs("div",{className:"space-y-8 p-6 md:p-8 max-w-[1600px] mx-auto bg-slate-50/50 min-h-screen animate-fade-in-up",children:[e.jsxs(Ee,{defaultValue:"pending",value:f,onValueChange:ne,className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-2 relative p-1 bg-slate-100/80 h-14 rounded-xl border border-slate-200",children:[e.jsx("div",{className:`absolute top-1 bottom-1 left-1 w-[calc(50%-0.5rem)] rounded-lg bg-white shadow-sm transition-all duration-300 ease-in-out ${f==="history"?"translate-x-full":"translate-x-0"}`}),e.jsx(Se,{value:"pending",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Pending LOI & MR"}),e.jsx(Se,{value:"history",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Processed History"})]}),e.jsx(Ce,{value:"pending",className:"mt-6 focus-visible:outline-hidden",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(pe,{className:"h-4 w-4 text-blue-600"})}),"Pending LOI & MR"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[re.length>=2&&e.jsxs(G,{onClick:A,className:"bg-blue-600 hover:bg-blue-700 text-white shadow-md shadow-blue-200 transition-all duration-300 animate-in fade-in slide-in-from-right-4",size:"sm",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Process Selected (",re.length,")"]}),e.jsxs($,{variant:"outline",className:"bg-yellow-100 text-yellow-700 border-yellow-200 px-3 py-1",children:[m.length," Pending"]})]})]})}),e.jsx(oe,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto max-h-[70vh] overflow-y-auto relative [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"[&_th]:sticky [&_th]:top-0 [&_th]:z-10 [&_th]:bg-blue-50 shadow-sm",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-4 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap w-12",children:"Select"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap w-32",children:"Action"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Father's Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Block"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Category"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Source"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Type"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:de?Array.from({length:8}).map((r,n)=>e.jsxs(R,{className:"animate-pulse",children:[e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-12 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-32 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-28 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-16 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})})]},`skeleton-${n}`)):m.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:13,className:"h-32 text-center text-muted-foreground",children:"No pending items found."})}):m.map(r=>e.jsxs(R,{className:"hover:bg-blue-50/50 transition-colors",children:[e.jsx(a,{className:"px-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(ze,{checked:re.includes(r.serialNo),onCheckedChange:n=>te(r.serialNo,n),"aria-label":`Select row ${r.serialNo}`,className:"checkbox-3d border-slate-400 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 h-5 w-5 shadow-sm transition-all duration-300 ease-out active:scale-75 hover:scale-110 data-[state=checked]:scale-110"})})}),e.jsx(a,{children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>P(r),disabled:re.length>=2,className:"bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white border border-blue-200 shadow-xs text-xs font-semibold h-8 px-4 rounded-full flex items-center gap-2 transition-all duration-300 mx-auto disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(_e,{className:"h-3.5 w-3.5"}),"Process"]})}),e.jsx(a,{className:"text-slate-600 font-mono text-xs",children:r.regId}),e.jsx(a,{className:"font-medium text-slate-800",children:r.beneficiaryName}),e.jsx(a,{className:"text-slate-600",children:r.fatherName}),e.jsx(a,{className:"text-slate-600",children:r.village}),e.jsx(a,{className:"text-slate-600",children:r.block}),e.jsx(a,{className:"text-slate-600",children:r.district}),e.jsx(a,{className:"text-slate-600",children:r.category}),e.jsx(a,{className:"text-slate-600",children:r.pumpSource}),e.jsx(a,{className:"text-slate-600",children:r.pumpType}),e.jsx(a,{className:"text-slate-600 font-medium",children:r.company}),e.jsx(a,{children:e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Pending"})})]},r.serialNo))})]})})})]})}),e.jsx(Ce,{value:"history",className:"mt-6 focus-visible:outline-hidden",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(Ne,{className:"h-4 w-4 text-blue-600"})}),"Processed History"]}),e.jsxs($,{variant:"outline",className:"bg-blue-100 text-blue-700 border-blue-200 px-3 py-1",children:[C.length," Records"]})]})}),e.jsx(oe,{className:"p-0",children:e.jsx("div",{className:"hidden md:block overflow-x-auto max-h-[70vh] overflow-y-auto relative [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"[&_th]:sticky [&_th]:top-0 [&_th]:z-10 [&_th]:bg-blue-50 shadow-sm",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Father's Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Block"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Category"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Source"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Type"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Installer"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Other Remark"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"LOI Document"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Paid By"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Share"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:de?Array.from({length:6}).map((r,n)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:28}).map((i,h)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded mx-auto"})},h))},`history-skeleton-${n}`)):C.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:28,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:"No foundation history found."})}):C.map(r=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"text-slate-600 font-mono text-xs",children:r.regId}),e.jsx(a,{className:"font-medium text-slate-800",children:r.beneficiaryName}),e.jsx(a,{className:"text-slate-600",children:r.fatherName}),e.jsx(a,{className:"text-slate-600",children:r.village}),e.jsx(a,{className:"text-slate-600",children:r.block}),e.jsx(a,{className:"text-slate-600",children:r.district}),e.jsx(a,{className:"text-slate-600",children:r.category}),e.jsx(a,{className:"text-slate-600",children:r.pumpSource}),e.jsx(a,{className:"text-slate-600",children:r.pumpType}),e.jsx(a,{className:"text-slate-600",children:r.company}),e.jsx(a,{className:"text-slate-600",children:r.installer||"-"}),e.jsx(a,{className:"text-slate-500 italic",children:r.otherRemark||"-"}),e.jsx(a,{children:r.loiFileName?r.loiFileName.startsWith("http")?e.jsxs("a",{href:S(r.loiFileName),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-xs cursor-pointer hover:text-blue-800 flex items-center justify-center gap-1",children:[e.jsx(Fe,{className:"h-4 w-4"}),"View Document"]}):e.jsxs("span",{className:"text-slate-600 text-xs flex items-center justify-center gap-1",children:[e.jsx(pe,{className:"h-4 w-4"}),r.loiFileName]}):"-"}),e.jsx(a,{className:"text-slate-600",children:r.mrNo||"-"}),e.jsx(a,{className:"text-slate-600",children:r.mrDate||"-"}),e.jsxs(a,{className:"font-medium text-slate-800",children:["",r.amount||"0"]}),e.jsx(a,{className:"text-slate-600",children:r.paidBy||"-"}),e.jsx(a,{className:"text-slate-600",children:r.beneficiaryShare||"-"}),e.jsx(a,{children:e.jsx($,{className:"bg-green-100 text-green-800 shadow-sm border border-green-200",children:"Processing Complete"})})]},r.serialNo))})]})})})]})})]}),e.jsx(Be,{open:X,onOpenChange:Q,children:e.jsx(Te,{showCloseButton:!ae,className:`max-w-4xl max-h-[90vh] overflow-y-auto p-0 gap-0 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none] ${ae?"bg-transparent !shadow-none !border-none":""}`,children:ae?e.jsxs("div",{className:"flex flex-col items-center justify-center w-full p-8 text-center space-y-6 animate-in fade-in duration-300",children:[e.jsx("div",{className:"rounded-full bg-white p-5 shadow-2xl shadow-white/20 ring-8 ring-white/10 animate-in zoom-in duration-500 ease-out",children:e.jsx(Ne,{className:"h-16 w-16 text-green-600 scale-110"})}),e.jsx("h2",{className:"text-3xl font-bold text-white drop-shadow-md animate-in slide-in-from-bottom-4 fade-in duration-500 delay-150 ease-out tracking-wide",children:"Submitted Successfully!"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{className:"p-6 pb-2 border-b border-blue-100 bg-blue-50/30",children:[e.jsxs(Ue,{className:"text-xl font-bold bg-linear-to-r from-blue-600 to-blue-600 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 p-1.5 rounded-md",children:e.jsx(_e,{className:"h-4 w-4 text-blue-600"})}),D?"Batch Process Items":"Process LOI & MR"]}),e.jsx(Le,{className:"text-slate-500 ml-10",children:D?e.jsxs("span",{children:["Applying changes to ",e.jsxs("span",{className:"font-bold text-blue-700",children:[re.length," selected items"]}),". All fields below will be updated for these items."]}):e.jsxs("span",{children:["Processing application for ",e.jsx("span",{className:"font-semibold text-slate-700",children:w==null?void 0:w.beneficiaryName})," ",e.jsx("span",{className:"font-mono text-xs bg-slate-100 px-1 py-0.5 rounded text-slate-600 border border-slate-200",children:w==null?void 0:w.serialNo})]})})]}),(w||D)&&e.jsxs("div",{className:"p-6 space-y-6",children:[!D&&w&&e.jsxs("div",{className:"rounded-xl border border-blue-100 bg-linear-to-br from-blue-50/50 to-blue-50/30 p-5 shadow-sm",children:[e.jsxs("h3",{className:"text-sm font-bold text-blue-900 mb-4 flex items-center gap-2 border-b border-blue-100 pb-2",children:[e.jsx("span",{className:"bg-white p-1 rounded shadow-sm",children:e.jsx(Ne,{className:"h-4 w-4 text-blue-500"})}),"BENEFICIARY DETAILS"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-y-5 gap-x-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Reg ID"}),e.jsx("div",{className:"font-medium text-slate-700 font-mono bg-white/50 px-2 py-1 rounded border border-blue-100/50 inline-block",children:w.regId})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Father's Name"}),e.jsx("p",{className:"font-medium text-slate-700",children:w.fatherName})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Village & Block"}),e.jsxs("p",{className:"font-medium text-slate-700",children:[w.village,", ",w.block]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"District"}),e.jsx("p",{className:"font-medium text-slate-700",children:w.district})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Category"}),e.jsx("p",{className:"font-medium text-slate-700",children:w.category})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Pump Type"}),e.jsx($,{variant:"secondary",className:"bg-white text-blue-700 border-blue-200 shadow-sm font-medium",children:w.pumpType})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-5 w-1 bg-blue-500 rounded-full"}),e.jsx("h3",{className:"text-sm font-bold text-slate-800 uppercase tracking-wide",children:"Processing Details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Beneficiary Name"}),e.jsx(z,{value:F.beneficiaryName,readOnly:!0,className:"bg-slate-100/50 border-slate-200 text-slate-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Company"}),e.jsx(z,{value:F.company,readOnly:!0,className:"bg-slate-100/50 border-slate-200 text-slate-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Installer Name"}),e.jsxs(Xe,{value:F.installer,onValueChange:r=>H({...F,installer:r}),children:[e.jsx(es,{className:"border-slate-200 focus:border-blue-400 focus:ring-blue-100",children:e.jsx(Qe,{placeholder:"Select Installer"})}),e.jsx(ss,{children:k.length>0?k.map(r=>e.jsx(Me,{className:"focus:bg-blue-50 focus:text-blue-900",value:r,children:r},r)):e.jsx("div",{className:"p-2 text-sm text-slate-500 text-center",children:"Loading..."})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"MR No"}),e.jsx(z,{value:F.mrNo,onChange:r=>H({...F,mrNo:r.target.value}),placeholder:"e.g. MR/2025/001",className:"border-slate-200 focus:border-cyan-400 focus:ring-cyan-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"MR Date"}),e.jsx(z,{type:"date",value:F.mrDate,onChange:r=>H({...F,mrDate:r.target.value}),className:"border-slate-200 focus:border-cyan-400 focus:ring-cyan-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Amount ()"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2 text-slate-500",children:""}),e.jsx(z,{type:"number",value:F.amount,onChange:r=>H({...F,amount:r.target.value}),placeholder:"0.00",className:"pl-7 border-slate-200 focus:border-cyan-400 focus:ring-cyan-100"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Paid By"}),e.jsx(z,{value:F.paidBy,onChange:r=>H({...F,paidBy:r.target.value}),placeholder:"Enter payer name",className:"border-slate-200 focus:border-cyan-400 focus:ring-cyan-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Beneficiary Share"}),e.jsxs(Xe,{value:F.beneficiaryShare,onValueChange:r=>H({...F,beneficiaryShare:r}),children:[e.jsx(es,{className:"border-slate-200 focus:border-blue-400 focus:ring-blue-100",children:e.jsx(Qe,{placeholder:"Select Share"})}),e.jsx(ss,{children:T.length>0?T.map(r=>e.jsx(Me,{className:"focus:bg-blue-50 focus:text-blue-900",value:r,children:r},r)):e.jsx("div",{className:"p-2 text-sm text-slate-500 text-center",children:"Loading..."})})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"LOI Document"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-200 rounded-xl p-4 bg-slate-50/50 flex flex-col items-center justify-center gap-2 hover:bg-slate-50 transition-all cursor-pointer group border-blue-100/50 hover:border-blue-200",onClick:()=>{var r;return(r=document.getElementById("loi-upload"))==null?void 0:r.click()},children:[e.jsx("div",{className:"h-10 w-10 bg-white rounded-full flex items-center justify-center shadow-sm border border-slate-100 group-hover:scale-110 transition-transform",children:e.jsx(Fe,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 group-hover:text-blue-600 transition-colors",children:F.loiFileName?F.loiFileName:"Click to Upload LOI Document"}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"PDF, DOC, DOCX up to 10MB"})]}),e.jsx(z,{type:"file",accept:".pdf,.doc,.docx",onChange:b,className:"hidden",id:"loi-upload"})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Other Remark"}),e.jsx(z,{value:F.otherRemark,onChange:r=>H({...F,otherRemark:r.target.value}),placeholder:"Any notes...",className:"border-slate-200 focus:border-cyan-400 focus:ring-cyan-100"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4 pt-4 border-t border-slate-100",children:[e.jsx(G,{variant:"outline",onClick:()=>Q(!1),className:"h-10 px-6 border-slate-200 text-slate-700 hover:bg-slate-100 hover:text-slate-800",children:"Cancel"}),e.jsx(G,{onClick:Y,disabled:j,className:"h-10 px-8 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-lg shadow-cyan-500/20 transition-all",children:j?"Submitting...":"Submit"})]})]})]})})})]})}function lt(){const[m,v]=d.useState("pending"),[C,_]=d.useState(!1),[w,Z]=d.useState([]),[X,Q]=d.useState([]),[f,ne]=d.useState(null),[ae,E]=d.useState(!1),[re,ee]=d.useState(!0),[D,le]=d.useState(!1),[te,F]=d.useState({}),[H,k]=d.useState([]),[p,T]=d.useState(!1),[u,W]=d.useState({paymentDate:"",paymentAmount:"",gst:"",tds:"",sd:"",balance:""}),U=async()=>{console.log("Fetching Payment Data...");try{const j="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",J="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",s=new URLSearchParams({action:"read",sheet:"Project Main",sheetName:"Project Main",id:J.trim()}),y=await fetch(`${j}?${s.toString()}`);if(!y.ok)throw new Error("Network Error");const g=await y.json(),c=Array.isArray(g)?g:g.data||[];if(c.length===0){Z([]),Q([]),ee(!1);return}const B=5;if(!c[B]){ee(!1);return}const P=c[B].map(S=>String(S).trim()).map(S=>S.toLowerCase()),A=S=>P.findIndex(Y=>S.every(r=>Y.replace(/\s+/g,"").includes(r))),b={serialNo:A(["serial"]),regId:A(["reg","id"]),beneficiaryName:A(["beneficiary","name"]),fatherName:A(["father"]),village:A(["village"]),block:A(["block"]),district:A(["district"]),pumpType:A(["pump","type"]),company:A(["company"]),jccAtHo:A(["ho","date"]),paymentDate:A(["payment","date"]),paymentAmount:P.findIndex((S,Y)=>{const r=A(["payment","date"]);return Y>r&&S.includes("amount")}),gst:A(["gst"]),tds:A(["tds"]),sd:A(["sd"]),balance:A(["balance"]),actual8:(()=>{const S=A(["actual","8"]);return S!==-1?S:A(["jcc","status"])})(),actual9:(()=>{const S=A(["actual","9"]);return S!==-1?S:A(["payment","date"])})(),planned9:A(["planned","9"])};F(b);const o=[],x=[];for(let S=B+1;S<c.length;S++){const Y=c[S];if(!Y||!Y[b.regId])continue;const r=V=>V!==-1&&Y[V]!==void 0?Y[V]:"",n={serialNo:r(b.serialNo),regId:r(b.regId),beneficiaryName:r(b.beneficiaryName),fatherName:r(b.fatherName),village:r(b.village),block:r(b.block),district:r(b.district),pumpType:r(b.pumpType),company:r(b.company),jccAtHo:r(b.jccAtHo),paymentDate:r(b.paymentDate),paymentAmount:r(b.paymentAmount),gst:r(b.gst),tds:r(b.tds),sd:r(b.sd),balance:r(b.balance),actual8:r(b.actual8),planned9:r(b.planned9),actual9:r(b.actual9),rowIndex:S+1},i=n.planned9&&String(n.planned9).trim()!=="";n.actual9&&String(n.actual9).trim()!==""?x.push(n):i&&o.push(n)}Z(o),Q(x)}catch(j){console.error("Fetch Data Error:",j)}finally{ee(!1)}};d.useEffect(()=>{U();const j=setTimeout(()=>ee(!1),15e3);return()=>clearTimeout(j)},[]),d.useEffect(()=>{if(C){const j=setTimeout(()=>{E(!1),setTimeout(()=>_(!1),300)},2e3);return()=>clearTimeout(j)}},[C]);const O=j=>{T(!1),ne(j),_(!1),W({paymentDate:j.paymentDate||"",paymentAmount:j.paymentAmount||"",gst:j.gst||"",tds:j.tds||"",sd:j.sd||"",balance:j.balance||""}),E(!0)},q=(j,J)=>{k(J?s=>[...s,j]:s=>s.filter(y=>y!==j))},de=()=>{T(!0),ne(null),_(!1),W({paymentDate:"",paymentAmount:"",gst:"",tds:"",sd:"",balance:""}),E(!0)},se=async()=>{if(!(!f&&(!p||H.length===0))){le(!0);try{const j="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",J="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo";let s=[];p?s=w.filter(B=>H.includes(B.serialNo)):s=[f];const y=s.map(async B=>{const t={},P=(S,Y)=>{const r=te[S];r!==void 0&&r>=0&&(t[r]=Y)};P("paymentDate",u.paymentDate),P("paymentAmount",u.paymentAmount),P("gst",u.gst),P("tds",u.tds),P("sd",u.sd),P("balance",u.balance);const A=new Date,b=`${A.getFullYear()}/${String(A.getMonth()+1).padStart(2,"0")}/${String(A.getDate()).padStart(2,"0")} ${String(A.getHours()).padStart(2,"0")}:${String(A.getMinutes()).padStart(2,"0")}:${String(A.getSeconds()).padStart(2,"0")}`;P("actual9",b);const o=new URLSearchParams({action:"update",sheet:"Project Main",sheetName:"Project Main",id:J,rowIndex:B.rowIndex,rowData:JSON.stringify(t)});return(await fetch(j,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o})).json()}),c=(await Promise.all(y)).filter(B=>B.status==="error"||B.result==="error");if(c.length>0)throw new Error(`${c.length} updates failed.`);await U(),ne(null),T(!1),k([]),_(!0)}catch(j){console.error("Submission Error:",j),alert("Error submitting form: "+j.message)}finally{le(!1)}}};return e.jsxs("div",{className:"space-y-8 p-6 md:p-8 max-w-[1600px] mx-auto bg-slate-50/50 min-h-screen animate-fade-in-up",children:[e.jsxs(Ee,{defaultValue:"pending",className:"w-full",onValueChange:v,children:[e.jsxs($e,{className:"grid w-full grid-cols-2 relative p-1 bg-slate-100/80 h-14 rounded-xl border border-slate-200",children:[e.jsx("div",{className:`absolute top-1 bottom-1 left-1 w-[calc(50%-0.5rem)] rounded-lg bg-white shadow-sm transition-all duration-300 ease-in-out ${m==="history"?"translate-x-full":"translate-x-0"}`}),e.jsx(Se,{value:"pending",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Pending Payments"}),e.jsx(Se,{value:"history",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Payment History"})]}),e.jsx(Ce,{value:"pending",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-left-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(He,{className:"h-4 w-4 text-blue-600"})}),"Pending Payments"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[H.length>=2&&e.jsxs(G,{onClick:de,className:"bg-blue-600 hover:bg-blue-700 text-white shadow-md shadow-blue-200 transition-all duration-300 animate-in fade-in slide-in-from-right-4",size:"sm",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Pay Selected (",H.length,")"]}),e.jsxs($,{variant:"outline",className:"bg-yellow-100 text-yellow-700 border-yellow-200 px-3 py-1",children:[w.length," Pending"]})]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-4 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap w-12",children:"Select"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap min-w-[120px]",children:"Action"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"JCC at HO"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:re?Array.from({length:5}).map((j,J)=>e.jsxs(R,{className:"animate-pulse",children:[e.jsx(a,{children:e.jsx("div",{className:"h-8 w-24 bg-slate-200 rounded-full mx-auto"})}),Array.from({length:8}).map((s,y)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded"})},y))]},J)):w.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:9,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(He,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No pending payment records found"})]})})}):w.map(j=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"px-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(ze,{checked:H.includes(j.serialNo),onCheckedChange:J=>q(j.serialNo,J),"aria-label":`Select row ${j.serialNo}`,className:"checkbox-3d border-slate-400 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 h-5 w-5 shadow-sm transition-all duration-300 ease-out active:scale-75 hover:scale-110 data-[state=checked]:scale-110"})})}),e.jsx(a,{children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>O(j),disabled:H.length>=2,className:"bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white border border-blue-200 shadow-xs text-xs font-semibold h-8 px-4 rounded-full flex items-center gap-2 transition-all duration-300 mx-auto disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(He,{className:"h-3.5 w-3.5"}),"Pay"]})}),e.jsx(a,{className:"whitespace-nowrap font-mono text-xs text-slate-500 bg-slate-50 py-1 px-2 rounded-md mx-auto w-fit",children:j.regId}),e.jsx(a,{className:"whitespace-nowrap font-medium text-slate-800",children:j.beneficiaryName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:j.village}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:j.district}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:j.company}),e.jsxs(a,{className:"whitespace-nowrap text-slate-800 font-medium",children:["",j.paymentAmount||"0"]}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:j.jccAtHo||"-"}),e.jsx(a,{children:e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Pending"})})]},j.serialNo))})]})}),e.jsx("div",{className:"lg:hidden space-y-4 p-4 bg-slate-50",children:re?e.jsx("div",{className:"text-center p-4 text-slate-500",children:"Loading..."}):w.map(j=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{variant:"secondary",className:"bg-slate-100 text-slate-600",children:j.serialNo}),e.jsx("h4",{className:"font-semibold text-base text-slate-800",children:j.beneficiaryName})]}),e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200 text-xs",children:"Pending"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3 text-xs border-t border-b py-3 my-2 border-slate-100",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Village"}),e.jsx("span",{className:"font-medium text-slate-700",children:j.village})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Amount"}),e.jsxs("span",{className:"font-medium text-slate-700",children:["",j.amount||"0"]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Company"}),e.jsx("span",{className:"font-medium text-slate-700",children:j.company})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"District"}),e.jsx("span",{className:"font-medium text-slate-700",children:j.district})]})]}),e.jsxs(G,{size:"sm",disabled:H.length>=2,className:"w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-md disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>O(j),children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"Process Payment"]})]})},j.serialNo))})]})]})}),e.jsx(Ce,{value:"history",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-right-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(He,{className:"h-4 w-4 text-blue-600"})}),"Payment History"]}),e.jsxs($,{variant:"outline",className:"bg-blue-100 text-blue-700 border-blue-200 px-3 py-1",children:[X.length," Records"]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"hidden lg:block overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Payment Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"GST"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"TDS"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Balance"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:re?Array.from({length:5}).map((j,J)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:9}).map((s,y)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded"})},y))},J)):X.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:9,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(He,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No payment records found"})]})})}):X.map(j=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{children:e.jsx("span",{className:"font-mono text-xs text-slate-500 bg-slate-50 py-1 px-2 rounded-md",children:j.regId})}),e.jsx(a,{className:"whitespace-nowrap font-medium text-slate-800",children:j.beneficiaryName}),e.jsx(a,{className:"text-slate-600",children:j.district}),e.jsx(a,{className:"text-slate-600 bg-blue-50/30",children:j.paymentDate||"-"}),e.jsxs(a,{className:"text-slate-800 font-medium bg-blue-50/30",children:["",j.paymentAmount]}),e.jsxs(a,{className:"text-slate-600 bg-blue-50/30",children:["",j.gst]}),e.jsxs(a,{className:"text-slate-600 bg-blue-50/30",children:["",j.tds]}),e.jsxs(a,{className:"text-green-700 font-bold bg-green-50/50",children:["",j.balance]}),e.jsx(a,{children:e.jsx($,{className:"bg-green-100 text-green-800 border-green-200",children:"Paid"})})]},j.serialNo))})]})}),e.jsx("div",{className:"lg:hidden space-y-4 p-4 bg-slate-50",children:X.map(j=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-semibold text-blue-900",children:["#",j.serialNo]}),e.jsx("p",{className:"text-base font-medium text-slate-800",children:j.beneficiaryName})]}),e.jsx($,{className:"bg-green-100 text-green-800 border-green-200",children:"Paid"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs border-t border-slate-100 pt-2 mt-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Amount:"})," ","",j.paymentAmount]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Date:"})," ",j.paymentDate]}),e.jsx("div",{className:"col-span-2",children:e.jsxs("span",{className:"font-bold text-green-700",children:["Balance: ",j.balance]})})]})]})},j.serialNo))})]})]})})]}),e.jsx(Be,{open:ae,onOpenChange:E,children:e.jsx(Te,{showCloseButton:!C,className:`max-w-4xl max-h-[90vh] overflow-y-auto p-0 gap-0 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none] ${C?"bg-transparent !shadow-none !border-none":"bg-white"}`,children:C?e.jsxs("div",{className:"flex flex-col items-center justify-center w-full p-8 text-center space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"rounded-full bg-white p-5 shadow-2xl shadow-green-900/20 ring-8 ring-white/10 animate-in zoom-in duration-500 ease-out relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-green-500/30 animate-ping opacity-75"}),e.jsx(Na,{className:"h-16 w-16 text-green-600 scale-110"})]}),e.jsx("h2",{className:"text-3xl font-bold text-white drop-shadow-md animate-in slide-in-from-bottom-4 fade-in duration-500 delay-150 ease-out tracking-wide",children:"Payment Successful!"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{className:"p-6 pb-2 border-b border-blue-100 bg-blue-50/30",children:[e.jsxs(Ue,{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 p-1.5 rounded-md",children:e.jsx(He,{className:"h-4 w-4 text-blue-600"})}),"Process Payment"]}),e.jsx(Le,{className:"text-slate-500 ml-10",children:p?e.jsxs("span",{children:["Applying changes to ",e.jsxs("span",{className:"font-bold text-blue-700",children:[H.length," selected items"]}),". All fields below will be updated for these items."]}):e.jsxs("span",{children:["Enter payment details for ",e.jsx("span",{className:"font-semibold text-slate-700",children:f==null?void 0:f.beneficiaryName})]})})]}),(f||p)&&e.jsxs("div",{className:"grid gap-6 p-6",children:[!p&&f&&e.jsxs("div",{className:"rounded-xl border border-blue-100 bg-gradient-to-br from-blue-50/50 to-cyan-50/30 p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-2 border-b border-blue-100/50",children:[e.jsx("span",{className:"bg-white p-1 rounded shadow-sm",children:e.jsx(Ne,{className:"h-4 w-4 text-blue-500"})}),e.jsx("h4",{className:"font-semibold text-blue-900",children:"Beneficiary Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-y-4 gap-x-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Serial No"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.serialNo})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Name"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.beneficiaryName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"District"}),e.jsx("p",{className:"font-semibold text-slate-700",children:f.district})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Pump Type"}),e.jsx("p",{className:"font-medium text-slate-700",children:f.pumpType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600/70 uppercase tracking-wider block mb-1",children:"Company"}),e.jsx("p",{className:"font-medium text-slate-700",children:f.company})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"Payment Date"}),e.jsx(z,{type:"date",value:u.paymentDate,onChange:j=>W({...u,paymentDate:j.target.value}),className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"Amount"}),e.jsx(z,{type:"number",value:u.paymentAmount,onChange:j=>W({...u,paymentAmount:j.target.value}),placeholder:"Enter Amount",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"GST"}),e.jsx(z,{type:"number",value:u.gst,onChange:j=>W({...u,gst:j.target.value}),placeholder:"Enter GST",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"TDS"}),e.jsx(z,{type:"number",value:u.tds,onChange:j=>W({...u,tds:j.target.value}),placeholder:"Enter TDS",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"SD"}),e.jsx(z,{type:"number",value:u.sd,onChange:j=>W({...u,sd:j.target.value}),placeholder:"Enter SD",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-slate-700 font-medium",children:"Balance"}),e.jsx(z,{type:"number",value:u.balance,onChange:j=>W({...u,balance:j.target.value}),placeholder:"Enter Balance",className:"border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-slate-100 pb-6 pr-6",children:[e.jsx(G,{variant:"outline",onClick:()=>E(!1),disabled:D,className:"px-6 bg-white hover:bg-slate-50 text-slate-700 border-slate-200",children:"Cancel"}),e.jsx(G,{onClick:se,disabled:D,className:"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-lg shadow-cyan-500/20 px-8",children:D?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Submit Payment"})]})]})]})})})]})}function rt(){const[m,v]=d.useState(!1),[C,_]=d.useState([]),[w,Z]=d.useState(!1),[X,Q]=d.useState(!0),[f,ne]=d.useState(null),ae=async()=>{Q(!0),ne(null);try{const p="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",T="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",u=new URLSearchParams({action:"read",sheet:"Project Main",sheetName:"Project Main",id:T.trim()}),W=await fetch(`${p}?${u.toString()}`);if(!W.ok)throw new Error("Network response was not ok");const U=await W.json();if(U.success===!1)throw new Error(U.error||"Sheet API returned an error");const O=Array.isArray(U)?U:U.data||[];if(console.log("Raw Rows received:",O),O.length===0){_([]);return}let q=-1;const de=["regid","beneficiaryname","village"];for(let y=0;y<Math.min(O.length,10);y++){const g=O[y];if(!Array.isArray(g))continue;const c=g.map(t=>String(t).toLowerCase().replace(/\s+/g,""));if(de.filter(t=>c.includes(t)).length>=2){q=y,console.log("Header row found at index:",y);break}}if(q===-1&&O.length>5)console.warn("Could not auto-detect header row. Falling back to Index 5 (Row 6)."),q=5;else if(q===-1)throw new Error("Could not identify header row in Sheet");const se=O[q].map(y=>String(y).trim().toLowerCase());console.log("Headers used:",se);const j=y=>se.findIndex(g=>y.every(c=>g.includes(c))),J={serialNo:j(["serial"]),regId:j(["reg","id"]),beneficiaryName:j(["beneficiary","name"]),fatherName:j(["father"]),village:j(["village"]),block:j(["block"]),district:j(["district"]),category:j(["category"]),pumpSource:j(["pump","source"]),pumpType:j(["pump","type"]),company:j(["company"])};console.log("Column Mapping:",J);const s=[];for(let y=q+1;y<O.length;y++){const g=O[y];!g||g.length===0||J.regId===-1||!g[J.regId]||s.push({serialNo:g[J.serialNo]||"-",regId:g[J.regId]||"-",beneficiaryName:g[J.beneficiaryName]||"-",fatherName:g[J.fatherName]||"-",village:g[J.village]||"-",block:g[J.block]||"-",district:g[J.district]||"-",category:g[J.category]||"-",pumpSource:g[J.pumpSource]||"-",pumpType:g[J.pumpType]||"-",company:g[J.company]||"-"})}console.log("Parsed Data:",s),_(s),Z(!0)}catch(p){console.error("Fetch Error:",p),ne(p.message)}finally{Q(!1)}};d.useEffect(()=>{ae()},[]);const[E,re]=d.useState(""),ee=C.filter(p=>Object.values(p).some(T=>T.toString().toLowerCase().includes(E.toLowerCase()))),[D,le]=d.useState({regId:"",beneficiaryName:"",fatherName:"",village:"",block:"",district:"",category:"",pumpSource:"",pumpType:"",company:""}),te=()=>{const p=Date.now().toString().slice(-6);return`SR${(C.length+1).toString().padStart(4,"0")}-${p}`},F=p=>{le({...D,[p.target.name]:p.target.value})},H=()=>{const p={...D,serialNo:te()};_([p,...C]),v(!1),le({regId:"",beneficiaryName:"",fatherName:"",village:"",block:"",district:"",category:"",pumpSource:"",pumpType:"",company:""})},k={total:C.length,districts:new Set(C.map(p=>p.district).filter(p=>p!=="-")).size,villages:new Set(C.map(p=>p.village).filter(p=>p!=="-")).size};return e.jsxs("div",{className:"space-y-6 px-4 pt-2 pb-4 md:px-8 md:pt-4 md:pb-8 max-w-[1600px] mx-auto animate-fade-in-up min-h-screen bg-slate-50/50",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-700 to-cyan-600 bg-clip-text text-transparent",children:"Registration Portal"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Centralized beneficiary registry and project data."})]}),e.jsxs("div",{className:"relative w-full md:w-72",children:[e.jsx(is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx(z,{placeholder:"Search beneficiaries, IDs...",value:E,onChange:p=>re(p.target.value),className:"pl-9 bg-white border-slate-200 focus-visible:ring-blue-500 transition-all hover:border-blue-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(ce,{className:"bg-white/80 backdrop-blur border-blue-100 shadow-sm hover:shadow-md transition-all",children:e.jsxs(oe,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase",children:"Total Beneficiaries"}),e.jsx("h3",{className:"text-2xl font-bold text-slate-800",children:k.total})]}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-600",children:e.jsx(ys,{className:"h-5 w-5"})})]})}),e.jsx(ce,{className:"bg-white/80 backdrop-blur border-purple-100 shadow-sm hover:shadow-md transition-all",children:e.jsxs(oe,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase",children:"Districts Covered"}),e.jsx("h3",{className:"text-2xl font-bold text-slate-800",children:k.districts})]}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-purple-50 flex items-center justify-center text-purple-600",children:e.jsx(wa,{className:"h-5 w-5"})})]})}),e.jsx(ce,{className:"bg-white/80 backdrop-blur border-emerald-100 shadow-sm hover:shadow-md transition-all",children:e.jsxs(oe,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase",children:"Villages Reach"}),e.jsx("h3",{className:"text-2xl font-bold text-slate-800",children:k.villages})]}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-emerald-50 flex items-center justify-center text-emerald-600",children:e.jsx(ya,{className:"h-5 w-5"})})]})})]}),e.jsx(Be,{open:m,onOpenChange:v,children:e.jsxs(Te,{className:"max-w-2xl max-h-[75vh] md:max-h-[80vh] flex flex-col p-6 overflow-visible",children:[e.jsx(Oe,{className:"shrink-0",children:e.jsx(Ue,{className:"bg-linear-to-r from-cyan-500 to-blue-600 bg-clip-text text-transparent pb-1",children:"Beneficiary Registration"})}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"regId",className:"text-sm font-medium text-slate-700",children:"Reg ID"}),e.jsx(z,{id:"regId",name:"regId",value:D.regId,onChange:F,className:"h-10 text-sm focus-visible:ring-blue-100",placeholder:"Enter Reg ID"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"category",className:"text-sm font-medium text-slate-700",children:"Category"}),e.jsx(z,{id:"category",name:"category",value:D.category,onChange:F,className:"h-10 text-sm focus-visible:ring-blue-100",placeholder:"Enter Category"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(M,{htmlFor:"beneficiaryName",className:"text-sm font-medium text-slate-700",children:"Beneficiary Name"}),e.jsx(z,{id:"beneficiaryName",name:"beneficiaryName",value:D.beneficiaryName,onChange:F,className:"h-10 text-sm focus-visible:ring-blue-100",placeholder:"Enter Beneficiary Name"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(M,{htmlFor:"fatherName",className:"text-sm font-medium text-slate-700",children:"Father's Name"}),e.jsx(z,{id:"fatherName",name:"fatherName",value:D.fatherName,onChange:F,className:"h-10 text-sm focus-visible:ring-blue-100",placeholder:"Enter Father's Name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"village",className:"text-sm font-medium text-slate-700",children:"Village"}),e.jsx(z,{id:"village",name:"village",value:D.village,onChange:F,className:"h-10 text-sm focus-visible:ring-blue-100",placeholder:"Village Name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"block",className:"text-sm font-medium text-slate-700",children:"Block"}),e.jsx(z,{id:"block",name:"block",value:D.block,onChange:F,className:"h-10 text-sm focus-visible:ring-blue-100",placeholder:"Block Name"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(M,{htmlFor:"district",className:"text-sm font-medium text-slate-700",children:"District"}),e.jsx(z,{id:"district",name:"district",value:D.district,onChange:F,className:"h-10 text-sm focus-visible:ring-blue-100",placeholder:"District Name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"pumpSource",className:"text-sm font-medium text-slate-700",children:"Pump Source"}),e.jsx(z,{id:"pumpSource",name:"pumpSource",value:D.pumpSource,onChange:F,className:"h-10 text-sm focus-visible:ring-blue-100",placeholder:"Source"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"pumpType",className:"text-sm font-medium text-slate-700",children:"Pump Type"}),e.jsx(z,{id:"pumpType",name:"pumpType",value:D.pumpType,onChange:F,className:"h-10 text-sm focus-visible:ring-blue-100",placeholder:"Type"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(M,{htmlFor:"company",className:"text-sm font-medium text-slate-700",children:"Company"}),e.jsx(z,{id:"company",name:"company",value:D.company,onChange:F,className:"h-10 text-sm focus-visible:ring-blue-100",placeholder:"Company Name"})]})]})}),e.jsxs("div",{className:"flex justify-end items-center gap-3 mt-4 pt-4 border-t shrink-0 bg-slate-50/50 -mx-6 px-6 -mb-4 pb-4",children:[e.jsx(G,{variant:"outline",onClick:()=>v(!1),className:"h-10 min-w-[100px]",children:"Cancel"}),e.jsx(G,{onClick:H,className:"bg-linear-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 h-10 min-w-[100px] shadow-sm",children:"Submit"})]})]})}),e.jsx(ce,{className:"border border-blue-100 shadow-lg shadow-blue-50/50 overflow-hidden bg-white",children:e.jsx(oe,{className:"!p-0",children:e.jsx("div",{className:"overflow-x-auto min-h-[300px] max-h-[70vh] [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:e.jsxs(we,{className:"w-full text-sm text-left",children:[e.jsx(ye,{className:"bg-slate-50 sticky top-0 z-20 shadow-sm",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-12 px-4 py-3 text-xs font-bold text-slate-600 uppercase tracking-wider text-center w-[120px] bg-slate-50/95 backdrop-blur",children:"Serial No"}),e.jsx(l,{className:"h-12 px-4 py-3 text-xs font-bold text-slate-600 uppercase tracking-wider text-center bg-slate-50/95 backdrop-blur",children:"Reg ID"}),e.jsx(l,{className:"h-12 px-4 py-3 text-xs font-bold text-slate-600 uppercase tracking-wider text-center min-w-[180px] bg-slate-50/95 backdrop-blur",children:"Beneficiary Name"}),e.jsx(l,{className:"h-12 px-4 py-3 text-xs font-bold text-slate-600 uppercase tracking-wider text-center min-w-[150px] bg-slate-50/95 backdrop-blur",children:"Father's Name"}),e.jsx(l,{className:"h-12 px-4 py-3 text-xs font-bold text-slate-600 uppercase tracking-wider text-center bg-slate-50/95 backdrop-blur",children:"Village"}),e.jsx(l,{className:"h-12 px-4 py-3 text-xs font-bold text-slate-600 uppercase tracking-wider text-center bg-slate-50/95 backdrop-blur",children:"Block"}),e.jsx(l,{className:"h-12 px-4 py-3 text-xs font-bold text-slate-600 uppercase tracking-wider text-center bg-slate-50/95 backdrop-blur",children:"District"}),e.jsx(l,{className:"h-12 px-4 py-3 text-xs font-bold text-slate-600 uppercase tracking-wider text-center bg-slate-50/95 backdrop-blur",children:"Category"}),e.jsx(l,{className:"h-12 px-4 py-3 text-xs font-bold text-slate-600 uppercase tracking-wider text-center bg-slate-50/95 backdrop-blur",children:"Pump Source"}),e.jsx(l,{className:"h-12 px-4 py-3 text-xs font-bold text-slate-600 uppercase tracking-wider text-center bg-slate-50/95 backdrop-blur",children:"Pump Type"}),e.jsx(l,{className:"h-12 px-4 py-3 text-xs font-bold text-slate-600 uppercase tracking-wider text-center bg-slate-50/95 backdrop-blur",children:"Company"})]})}),e.jsx(ve,{children:X?Array.from({length:8}).map((p,T)=>e.jsxs(R,{className:"animate-pulse",children:[e.jsx(a,{children:e.jsx("div",{className:"h-4 w-8 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-16 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-32 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-12 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-16 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-16 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})})]},`skeleton-${T}`)):ee.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:11,className:"h-32 text-center text-muted-foreground bg-slate-50/50",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx(is,{className:"h-8 w-8 text-slate-300 mb-2"}),e.jsx("p",{children:"No matching records found."})]})})}):ee.map(p=>e.jsxs(R,{className:"hover:bg-blue-50/50 transition-all duration-200 border-b border-slate-50 last:border-0 hover:shadow-sm",children:[e.jsx(a,{className:"font-mono text-center text-xs text-slate-500 bg-slate-50/30",children:p.serialNo}),e.jsx(a,{className:"text-center text-xs font-medium text-slate-700",children:p.regId}),e.jsx(a,{className:"text-center font-semibold text-slate-800 text-sm",children:p.beneficiaryName}),e.jsx(a,{className:"text-center text-slate-600 text-sm",children:p.fatherName}),e.jsx(a,{className:"text-center text-slate-600 text-sm",children:p.village}),e.jsx(a,{className:"text-center text-slate-600 text-sm",children:p.block}),e.jsx(a,{className:"text-center text-slate-600 text-sm",children:p.district}),e.jsx(a,{className:"text-center text-slate-600 text-sm",children:p.category}),e.jsx(a,{className:"text-center text-slate-600 text-sm",children:p.pumpSource}),e.jsx(a,{className:"text-center text-slate-600 text-sm",children:p.pumpType}),e.jsx(a,{className:"text-center text-slate-600 text-sm font-medium",children:p.company})]},p.serialNo))})]})})})})]})}function nt(){const[m,v]=d.useState([]),[C,_]=d.useState([]),[w,Z]=d.useState(null),[X,Q]=d.useState(!1),[f,ne]=d.useState(!0),[ae,E]=d.useState(!1),[re,ee]=d.useState("pending"),[D,le]=d.useState(!1),[te,F]=d.useState([]),[H,k]=d.useState(!1),p=(c,B)=>{F(B?t=>[...t,c]:t=>t.filter(P=>P!==c))},[T,u]=d.useState({}),[W,U]=d.useState({}),[O,q]=d.useState({sanctionNo:"",sanctionDate:"",sanctionFile:null,sanctionFileObj:null,remarks:""}),de=async()=>{ne(!0);try{const c="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",B="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",t=new URLSearchParams({action:"read",sheet:"Project Main",sheetName:"Project Main",id:B.trim()}),P=await fetch(`${c}?${t.toString()}`);if(!P.ok)throw new Error("Network Error");const A=await P.json(),b=Array.isArray(A)?A:A.data||[];if(b.length===0){v([]),_([]),ne(!1);return}let o=-1;const x=["regid","beneficiaryname","village"];for(let I=0;I<Math.min(b.length,10);I++){const N=b[I];if(!Array.isArray(N))continue;const L=N.map(K=>String(K).toLowerCase().replace(/\s+/g,""));if(x.filter(K=>L.includes(K)).length>=2){o=I;break}}if(o===-1&&b.length>5&&(o=5),o===-1||!b[o]){console.error("Could not identify header row"),ne(!1);return}const S=b[o].map(I=>String(I).trim()),Y=S.map(I=>I.toLowerCase()),r=I=>Y.findIndex(N=>I.every(L=>N.includes(L))),n={serialNo:r(["serial"]),regId:r(["reg","id"]),beneficiaryName:r(["beneficiary","name"]),fatherName:r(["father"]),village:r(["village"]),block:r(["block"]),district:r(["district"]),category:r(["category"]),pumpSource:r(["pump","source"]),pumpType:r(["pump","type"]),company:r(["company"]),installer:r(["installer"]),otherRemark:r(["remark"]),loiDocument:r(["loi","file"]),mrNo:r(["mr","no"]),mrDate:r(["mr","date"]),amount:r(["amount"]),paidBy:r(["paid","by"]),beneficiaryShare:r(["share"]),sanctionNo:r(["sanction","no"]),sanctionDate:r(["sanction","date"]),sanctionFile:(()=>{const I=r(["sanction","file"]);if(I!==-1)return I;const N=r(["sanction","doc"]);return N!==-1?N:r(["sanction","letter"])})(),planned2:r(["planned","2"]),actual2:r(["actual","2"]),actual1:r(["actual","1"])},i={};Object.keys(n).forEach(I=>{n[I]!==-1&&(i[I]=S[n[I]])}),u(i),U(n);const h=[],V=[];for(let I=o+1;I<b.length;I++){const N=b[I];if(!N||N.length===0||n.regId===-1||!N[n.regId])continue;const L={serialNo:N[n.serialNo]||"-",regId:N[n.regId]||"-",beneficiaryName:N[n.beneficiaryName]||"-",fatherName:N[n.fatherName]||"-",village:N[n.village]||"-",block:N[n.block]||"-",district:N[n.district]||"-",category:N[n.category]||"-",pumpSource:N[n.pumpSource]||"-",pumpType:N[n.pumpType]||"-",company:N[n.company]||"-",installer:N[n.installer]||"-",otherRemark:N[n.otherRemark]||"",loiDocument:N[n.loiDocument]||"",mrNo:N[n.mrNo]||"-",mrDate:N[n.mrDate]||"-",amount:N[n.amount]||"-",paidBy:N[n.paidBy]||"-",beneficiaryShare:N[n.beneficiaryShare]||"-",sanctionNo:N[n.sanctionNo]||"",sanctionDate:N[n.sanctionDate]||"",sanctionFile:N[n.sanctionFile]||"",loiFileName:N[n.loiDocument]||"",planned2:N[n.planned2],actual2:N[n.actual2],actual1:N[n.actual1],rowIndex:I+1},K=L.actual1&&String(L.actual1).trim()!=="",he=L.planned2&&String(L.planned2).trim()!=="",xe=L.actual2&&String(L.actual2).trim()!=="";he&&!xe?h.push(L):xe&&V.push(L)}v(h),_(V)}catch(c){console.error("Error fetching data:",c)}finally{ne(!1)}};d.useEffect(()=>{de()},[]),d.useEffect(()=>{if(D){const c=setTimeout(()=>{Q(!1),setTimeout(()=>le(!1),300)},2e3);return()=>clearTimeout(c)}},[D]);const se=c=>{Z(c),k(!1),le(!1),q({sanctionNo:"",sanctionDate:"",sanctionFile:null,sanctionFileObj:null,remarks:""}),Q(!0)},j=()=>{te.length<2||(Z(null),k(!0),le(!1),q({sanctionNo:"",sanctionDate:"",sanctionFile:null,sanctionFileObj:null,remarks:""}),Q(!0))},J=c=>{c.target.files&&c.target.files[0]&&q({...O,sanctionFile:c.target.files[0].name,sanctionFileObj:c.target.files[0]})},s=c=>new Promise((B,t)=>{const P=new FileReader;P.readAsDataURL(c),P.onload=()=>B(P.result.split(",")[1]),P.onerror=A=>t(A)}),y=c=>{if(!c||c.includes("/preview"))return c;const B=c.match(/[-\w]{25,}/);return B?`https://drive.google.com/file/d/${B[0]}/preview`:c},g=async()=>{if(!(!w&&!H)){E(!0);try{const c="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",B="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo";let t="";if(O.sanctionFileObj){const x=await s(O.sanctionFileObj),S=new URLSearchParams({action:"uploadFile",base64Data:x,fileName:O.sanctionFileObj.name,mimeType:O.sanctionFileObj.type,folderId:"1pqyJUlUD0zwnojUvNezJgxzim8gjUfmM"}),r=await(await fetch(c,{method:"POST",body:S})).json();if(!r.success||!r.fileUrl)throw new Error("Sanction file upload failed");t=r.fileUrl}const P=H?m.filter(x=>te.includes(x.serialNo)):[w],A=new Date,b=`${A.getFullYear()}/${String(A.getMonth()+1).padStart(2,"0")}/${String(A.getDate()).padStart(2,"0")} ${String(A.getHours()).padStart(2,"0")}:${String(A.getMinutes()).padStart(2,"0")}:${String(A.getSeconds()).padStart(2,"0")}`,o=P.map(async x=>{const S={},Y=(n,i)=>{const h=W[n];h!==void 0&&h>=0&&i!==void 0&&i!==null&&i!==""&&(S[h]=i)};Y("sanctionNo",O.sanctionNo?`'${O.sanctionNo}`:""),Y("sanctionDate",O.sanctionDate),Y("actual2",b),t&&Y("sanctionFile",t);const r=new URLSearchParams({action:"update",sheetName:"Project Main",id:B,rowIndex:x.rowIndex,rowData:JSON.stringify(S)});return fetch(c,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()})});await Promise.all(o),await de(),le(!0),H&&F([])}catch(c){console.error("Submission error:",c),alert("Failed to submit data.")}finally{E(!1)}}};return e.jsxs("div",{className:"space-y-8 p-6 md:p-8 max-w-[1600px] mx-auto bg-slate-50/50 min-h-screen animate-fade-in-up",children:[e.jsxs(Ee,{defaultValue:"pending",value:re,onValueChange:ee,className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-2 relative p-1 bg-slate-100/80 h-14 rounded-xl border border-slate-200",children:[e.jsx("div",{className:`absolute top-1 bottom-1 left-1 w-[calc(50%-0.5rem)] rounded-lg bg-white shadow-sm transition-all duration-300 ease-in-out ${re==="history"?"translate-x-full":"translate-x-0"}`}),e.jsx(Se,{value:"pending",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Pending Sanctions"}),e.jsx(Se,{value:"history",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Sanction History"})]}),e.jsx(Ce,{value:"pending",className:"mt-6 focus-visible:outline-hidden animate-in fade-in-0 slide-in-from-left-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(pe,{className:"h-4 w-4 text-blue-600"})}),"Pending for Sanction"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[te.length>=2&&e.jsxs(G,{onClick:j,className:"bg-blue-600 hover:bg-blue-700 text-white shadow-md shadow-blue-200 transition-all duration-300 animate-in fade-in slide-in-from-right-4",size:"sm",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Sanction Selected (",te.length,")"]}),e.jsxs($,{variant:"outline",className:"bg-yellow-100 text-yellow-700 border-yellow-200 px-3 py-1",children:[m.length," Pending"]})]})]})}),e.jsx(oe,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-4 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap w-12",children:"Select"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap w-32",children:"Action"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Father's Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Block"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Category"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Source"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Type"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Installer"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Other Remark"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"LOI Document"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Paid By"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Share"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:f?Array.from({length:8}).map((c,B)=>e.jsxs(R,{className:"animate-pulse",children:[e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-12 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-32 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-28 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-16 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-32 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-16 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-24 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})}),e.jsx(a,{children:e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded mx-auto"})})]},`skeleton-${B}`)):m.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:21,className:"h-32 text-center text-muted-foreground",children:"No pending items found."})}):m.map(c=>e.jsxs(R,{className:"hover:bg-blue-50/50 transition-colors",children:[e.jsx(a,{className:"px-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(ze,{checked:te.includes(c.serialNo),onCheckedChange:B=>p(c.serialNo,B),"aria-label":`Select row ${c.serialNo}`,className:"checkbox-3d border-slate-400 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 h-5 w-5 shadow-sm transition-all duration-300 ease-out active:scale-75 hover:scale-110 data-[state=checked]:scale-110"})})}),e.jsx(a,{children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>se(c),disabled:te.length>=2,className:"bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white border border-blue-200 shadow-xs text-xs font-semibold h-8 px-4 rounded-full flex items-center gap-2 transition-all duration-300 mx-auto disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"Sanction"]})}),e.jsx(a,{className:"text-slate-600 font-mono text-xs",children:c.regId}),e.jsx(a,{className:"font-medium text-slate-800",children:c.beneficiaryName}),e.jsx(a,{className:"text-slate-600",children:c.fatherName}),e.jsx(a,{className:"text-slate-600",children:c.village}),e.jsx(a,{className:"text-slate-600",children:c.block}),e.jsx(a,{className:"text-slate-600",children:c.district}),e.jsx(a,{className:"text-slate-600",children:c.category}),e.jsx(a,{className:"text-slate-600",children:c.pumpSource}),e.jsx(a,{className:"text-slate-600",children:c.pumpType}),e.jsx(a,{className:"text-slate-600",children:c.company}),e.jsx(a,{className:"text-slate-600",children:c.installer}),e.jsx(a,{className:"text-slate-500 italic",children:c.otherRemark||"-"}),e.jsx(a,{children:c.loiDocument?c.loiDocument.startsWith("http")?e.jsxs("a",{href:y(c.loiDocument),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-xs flex items-center justify-center gap-1",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Preview"]}):e.jsx("span",{className:"text-slate-600 text-xs",children:c.loiDocument}):"-"}),e.jsx(a,{className:"text-slate-600",children:c.mrNo}),e.jsx(a,{className:"text-slate-600",children:c.mrDate}),e.jsxs(a,{className:"font-medium text-slate-800",children:["",c.amount]}),e.jsx(a,{className:"text-slate-600",children:c.paidBy}),e.jsx(a,{className:"text-slate-600",children:c.beneficiaryShare||"-"}),e.jsx(a,{children:e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Pending"})})]},c.serialNo))})]})})})]})}),e.jsx(Ce,{value:"history",className:"mt-6 focus-visible:outline-hidden animate-in fade-in-0 slide-in-from-right-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(Ne,{className:"h-4 w-4 text-blue-600"})}),"Sanctioned History"]}),e.jsxs($,{variant:"outline",className:"bg-blue-100 text-blue-700 border-blue-200 px-3 py-1",children:[C.length," Records"]})]})}),e.jsx(oe,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Father's Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Block"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Category"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Source"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Type"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Installer"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Other Remark"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"LOI Document"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"MR Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Paid By"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Share"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Sanction No"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Sanction Date"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Sanction Doc"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:f?Array.from({length:6}).map((c,B)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:28}).map((t,P)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded mx-auto"})},P))},`history-skeleton-${B}`)):C.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:28,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:"No foundation history found."})}):C.map(c=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"text-slate-600 font-mono text-xs",children:c.regId}),e.jsx(a,{className:"font-medium text-slate-800",children:c.beneficiaryName}),e.jsx(a,{className:"text-slate-600",children:c.fatherName}),e.jsx(a,{className:"text-slate-600",children:c.village}),e.jsx(a,{className:"text-slate-600",children:c.block}),e.jsx(a,{className:"text-slate-600",children:c.district}),e.jsx(a,{className:"text-slate-600",children:c.category}),e.jsx(a,{className:"text-slate-600",children:c.pumpSource}),e.jsx(a,{className:"text-slate-600",children:c.pumpType}),e.jsx(a,{className:"text-slate-600",children:c.company}),e.jsx(a,{className:"text-slate-600",children:c.installer}),e.jsx(a,{className:"text-slate-500 italic",children:c.otherRemark||"-"}),e.jsx(a,{children:c.loiFileName?c.loiFileName.startsWith("http")?e.jsxs("a",{href:y(c.loiFileName),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-xs flex items-center justify-center gap-1",children:[e.jsx(Fe,{className:"h-4 w-4"}),"View Document"]}):e.jsx("span",{className:"text-slate-600 text-xs",children:c.loiFileName}):"-"}),e.jsx(a,{className:"text-slate-600",children:c.mrNo}),e.jsx(a,{className:"text-slate-600",children:c.mrDate}),e.jsxs(a,{className:"font-medium text-slate-800",children:["",c.amount]}),e.jsx(a,{className:"text-slate-600",children:c.paidBy}),e.jsx(a,{className:"text-slate-600",children:c.beneficiaryShare||"-"}),e.jsx(a,{className:"bg-blue-50/50",children:c.sanctionNo?e.jsx("span",{className:"text-blue-600 underline text-xs cursor-pointer font-medium hover:text-blue-800",children:c.sanctionNo}):"-"}),e.jsx(a,{className:"bg-blue-50/50 text-blue-700 font-mono text-xs",children:c.sanctionDate}),e.jsx(a,{children:c.sanctionFile?c.sanctionFile.startsWith("http")?e.jsxs("a",{href:y(c.sanctionFile),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-xs flex items-center justify-center gap-1",children:[e.jsx(Fe,{className:"h-4 w-4"}),"View Document"]}):e.jsx("span",{className:"text-slate-600 text-xs",children:c.sanctionFile}):"-"}),e.jsx(a,{children:e.jsx($,{className:"bg-green-100 text-green-800 shadow-sm border border-green-200",children:"Sanctioned"})})]},c.serialNo))})]})})})]})})]}),e.jsx(Be,{open:X,onOpenChange:Q,children:e.jsx(Te,{showCloseButton:!D,className:`max-w-4xl max-h-[90vh] overflow-y-auto p-0 gap-0 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none] ${D?"bg-transparent !shadow-none !border-none":""}`,children:D?e.jsxs("div",{className:"flex flex-col items-center justify-center w-full p-8 text-center space-y-6 animate-in fade-in duration-300",children:[e.jsx("div",{className:"rounded-full bg-white p-5 shadow-2xl shadow-white/20 ring-8 ring-white/10 animate-in zoom-in duration-500 ease-out",children:e.jsx(Ne,{className:"h-16 w-16 text-green-600 scale-110"})}),e.jsx("h2",{className:"text-3xl font-bold text-white drop-shadow-md animate-in slide-in-from-bottom-4 fade-in duration-500 delay-150 ease-out tracking-wide",children:"Approved Successfully!"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{className:"p-6 pb-2 border-b border-blue-100 bg-blue-50/30",children:[e.jsxs(Ue,{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 p-1.5 rounded-md",children:e.jsx(pe,{className:"h-4 w-4 text-blue-600"})}),"Process Sanction Order"]}),e.jsx(Le,{className:"text-slate-500 ml-10",children:H?e.jsxs("span",{children:["Applying changes to ",e.jsxs("span",{className:"font-bold text-blue-700",children:[te.length," selected items"]}),". All fields below will be updated for these items."]}):e.jsxs("span",{children:["Processing sanction for ",e.jsx("span",{className:"font-semibold text-slate-700",children:w==null?void 0:w.beneficiaryName})," ",e.jsx("span",{className:"font-mono text-xs bg-slate-100 px-1 py-0.5 rounded text-slate-600 border border-slate-200",children:w==null?void 0:w.serialNo})]})})]}),(w||H)&&e.jsxs("div",{className:"p-6 space-y-6",children:[w&&!H&&e.jsxs("div",{className:"rounded-xl border border-blue-100 bg-linear-to-br from-blue-50/50 to-cyan-50/30 p-5 shadow-sm",children:[e.jsxs("h3",{className:"text-sm font-bold text-blue-900 mb-4 flex items-center gap-2 border-b border-blue-100 pb-2",children:[e.jsx("span",{className:"bg-white p-1 rounded shadow-sm",children:e.jsx(Ne,{className:"h-4 w-4 text-blue-500"})}),"BENEFICIARY DETAILS"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-y-5 gap-x-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Reg ID"}),e.jsx("div",{className:"font-medium text-slate-700 font-mono bg-white/50 px-2 py-1 rounded border border-blue-100/50 inline-block",children:w.regId})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Father's Name"}),e.jsx("p",{className:"font-medium text-slate-700",children:w.fatherName})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Village & Block"}),e.jsxs("p",{className:"font-medium text-slate-700",children:[w.village,", ",w.block]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"District"}),e.jsx("p",{className:"font-medium text-slate-700",children:w.district})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Pump Type"}),e.jsx($,{variant:"secondary",className:"bg-white text-blue-700 border-blue-200 shadow-sm font-medium",children:w.pumpType})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-900/60 block mb-1",children:"Company"}),e.jsx("p",{className:"font-medium text-slate-700 font-mono text-xs",children:w.company})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-5 w-1 bg-cyan-500 rounded-full"}),e.jsx("h3",{className:"text-sm font-bold text-slate-800 uppercase tracking-wide",children:"Sanction Details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Sanction Number"}),e.jsx(z,{value:O.sanctionNo,onChange:c=>q({...O,sanctionNo:c.target.value}),placeholder:"Enter sanction serial no",className:"h-10 border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 transition-all bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Sanction Date"}),e.jsx(z,{type:"date",value:O.sanctionDate,onChange:c=>q({...O,sanctionDate:c.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400 focus-visible:ring-cyan-100 transition-all bg-white"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Sanction Document"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-200 rounded-xl p-4 bg-slate-50/50 flex flex-col items-center justify-center gap-2 hover:bg-slate-50 transition-all cursor-pointer group border-blue-100/50 hover:border-blue-200",onClick:()=>{var c;return(c=document.getElementById("sanction-file"))==null?void 0:c.click()},children:[e.jsx("div",{className:"h-10 w-10 bg-white rounded-full flex items-center justify-center shadow-sm border border-slate-100 group-hover:scale-110 transition-transform",children:e.jsx(Fe,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 group-hover:text-blue-600 transition-colors",children:O.sanctionFile?O.sanctionFile:"Click to Upload Sanction Document"}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"PDF, DOC, DOCX up to 10MB"})]}),e.jsx(z,{type:"file",accept:".pdf,.doc,.docx",onChange:J,className:"hidden",id:"sanction-file"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4 pt-4 border-t border-slate-100",children:[e.jsx(G,{variant:"outline",onClick:()=>Q(!1),disabled:ae,className:"h-10 px-6 border-slate-200 text-slate-700 hover:bg-slate-100 hover:text-slate-800",children:"Cancel"}),e.jsx(G,{onClick:g,disabled:ae,className:"h-10 px-8 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-lg shadow-blue-500/20 transition-all",children:ae?"Processing...":"Approve & Sanction"})]})]})]})})})]})}function it(){const[m,v]=d.useState([]),[C,_]=d.useState([]),[w,Z]=d.useState(null),[X,Q]=d.useState(!1),[f,ne]=d.useState(!1),[ae,E]=d.useState("pending"),[re,ee]=d.useState(!0),[D,le]=d.useState([]),[te,F]=d.useState(!1),[H,k]=d.useState(!1),[p,T]=d.useState({moduleMake:"",moduleSerialNo1:"",moduleSerialNo2:"",moduleSerialNo3:"",moduleSerialNo4:"",moduleSerialNo5:"",moduleSerialNo6:"",moduleSerialNo7:"",moduleSerialNo8:"",moduleSerialNo9:"",controllerMake:"",controllerNo:"",rmsNo:"",pumpMake:"",pumpSerialNo:"",motorSerialNo:"",structureMake:"",photoPrint:""}),[u,W]=d.useState({}),[U,O]=d.useState(!1),q=async()=>{console.log("Fetching System Info Data...");try{const s="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",y="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",g=new URLSearchParams({action:"read",sheet:"Project Main",sheetName:"Project Main",id:y.trim()}),c=await fetch(`${s}?${g.toString()}`);if(!c.ok)throw new Error("Network Error");const B=await c.json(),t=Array.isArray(B)?B:B.data||[];if(t.length===0){console.warn("No rows found in sheet"),v([]),_([]),ee(!1),k(!0);return}const P=5;if(!t[P]){console.error("Header row missing"),ee(!1),k(!0);return}const b=t[P].map(r=>String(r).trim()).map(r=>r.toLowerCase()),o=r=>b.findIndex(n=>r.every(i=>n.replace(/\s+/g,"").includes(i))),x={serialNo:o(["serial"]),regId:o(["reg","id"]),beneficiaryName:o(["beneficiary","name"]),fatherName:o(["father"]),village:o(["village"]),block:o(["block"]),district:o(["district"]),pumpType:o(["pump","type"]),company:o(["company"]),moduleMake:o(["module","make"]),moduleSerialNo1:o(["module","sno1"]),moduleSerialNo2:o(["module","sno2"]),moduleSerialNo3:o(["module","sno3"]),moduleSerialNo4:o(["module","sno4"]),moduleSerialNo5:o(["module","sno5"]),moduleSerialNo6:o(["module","sno6"]),moduleSerialNo7:o(["module","sno7"]),moduleSerialNo8:o(["module","sno8"]),moduleSerialNo9:o(["module","sno9"]),controllerMake:o(["controller","make"]),controllerNo:o(["controller","no"]),rmsNo:o(["rms","no"]),pumpMake:o(["pump","make"]),pumpSerialNo:o(["pump","serial"]),motorSerialNo:o(["motor","serial"]),structureMake:o(["strucutre","make"]),actual4:(()=>{const r=o(["actual","4"]);return r!==-1?r:o(["installation","done"])})(),planned5:o(["planned","5"]),actual5:(()=>{const r=o(["actual","5"]);return r!==-1?r:o(["system","info"])})()};console.log("Col Map:",x),W(x);const S=[],Y=[];for(let r=P+1;r<t.length;r++){const n=t[r];if(!n||!n[x.regId])continue;const i=N=>N!==-1&&n[N]!==void 0?n[N]:"",h={serialNo:i(x.serialNo),regId:i(x.regId),beneficiaryName:i(x.beneficiaryName),fatherName:i(x.fatherName),village:i(x.village),block:i(x.block),district:i(x.district),pumpType:i(x.pumpType),company:i(x.company),moduleMake:i(x.moduleMake),controllerMake:i(x.controllerMake),pumpMake:i(x.pumpMake),structureMake:i(x.structureMake),actual4:i(x.actual4),planned5:i(x.planned5),actual5:i(x.actual5),rowIndex:r+1},V=h.planned5&&String(h.planned5).trim()!=="";h.actual5&&String(h.actual5).trim()!==""?Y.push(h):V&&S.push(h)}v(S),_(Y)}catch(s){console.error("Fetch Data Error:",s)}finally{ee(!1),k(!0)}},de=s=>{console.log("Opening Process Dialog for:",s),ne(!1),F(!1),Z(s),T({moduleMake:s.moduleMake||"",moduleSerialNo1:s.moduleSerialNo1||"",moduleSerialNo2:s.moduleSerialNo2||"",moduleSerialNo3:s.moduleSerialNo3||"",moduleSerialNo4:s.moduleSerialNo4||"",moduleSerialNo5:s.moduleSerialNo5||"",moduleSerialNo6:s.moduleSerialNo6||"",moduleSerialNo7:s.moduleSerialNo7||"",moduleSerialNo8:s.moduleSerialNo8||"",moduleSerialNo9:s.moduleSerialNo9||"",controllerMake:s.controllerMake||"",controllerNo:s.controllerNo||"",rmsNo:s.rmsNo||"",pumpMake:s.pumpMake||"",pumpSerialNo:s.pumpSerialNo||"",motorSerialNo:s.motorSerialNo||"",structureMake:s.structureMake||"",photoPrint:""}),Q(!0)},se=(s,y)=>{le(y?g=>[...g,s]:g=>g.filter(c=>c!==s))},j=()=>{F(!0),Z(null),ne(!1),T({moduleMake:"",moduleSerialNo1:"",moduleSerialNo2:"",moduleSerialNo3:"",moduleSerialNo4:"",moduleSerialNo5:"",moduleSerialNo6:"",moduleSerialNo7:"",moduleSerialNo8:"",moduleSerialNo9:"",controllerMake:"",controllerNo:"",rmsNo:"",pumpMake:"",pumpSerialNo:"",motorSerialNo:"",structureMake:"",photoPrint:""}),Q(!0)},J=async()=>{if(!(!w&&(!te||D.length===0))){O(!0);try{const s="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",y="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo";let g=[];te?g=m.filter(P=>D.includes(P.serialNo)):g=[w];const c=g.map(async P=>{const A={},b=(r,n)=>{const i=u[r];if(i!==void 0&&i>=0&&n!==void 0&&n!==null){let h=n;typeof n=="string"&&n.startsWith("0")&&n.length>1&&!isNaN(n)&&(h="'"+n),A[i]=h}};b("moduleMake",p.moduleMake),b("moduleSerialNo1",p.moduleSerialNo1),b("moduleSerialNo2",p.moduleSerialNo2),b("moduleSerialNo3",p.moduleSerialNo3),b("moduleSerialNo4",p.moduleSerialNo4),b("moduleSerialNo5",p.moduleSerialNo5),b("moduleSerialNo6",p.moduleSerialNo6),b("moduleSerialNo7",p.moduleSerialNo7),b("moduleSerialNo8",p.moduleSerialNo8),b("moduleSerialNo9",p.moduleSerialNo9),b("controllerMake",p.controllerMake),b("controllerNo",p.controllerNo),b("rmsNo",p.rmsNo),b("pumpMake",p.pumpMake),b("pumpSerialNo",p.pumpSerialNo),b("motorSerialNo",p.motorSerialNo),b("structureMake",p.structureMake);const o=new Date,x=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")} ${String(o.getHours()).padStart(2,"0")}:${String(o.getMinutes()).padStart(2,"0")}:${String(o.getSeconds()).padStart(2,"0")}`;b("actual5",x);const S=new URLSearchParams({action:"update",sheetName:"Project Main",id:y,rowIndex:P.rowIndex,rowData:JSON.stringify(A)});return(await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:S.toString()})).json()}),t=(await Promise.all(c)).filter(P=>P.status==="error");if(t.length>0)throw new Error(`${t.length} updates failed. Check console.`);await q(),Z(null),F(!1),le([]),O(!1),ne(!0)}catch(s){console.error("Submission Error:",s),alert("Error submitting data. Please try again."),O(!1)}}};return d.useEffect(()=>{q();const s=setTimeout(()=>ee(!1),15e3);return()=>clearTimeout(s)},[]),d.useEffect(()=>{if(f){const s=setTimeout(()=>{Q(!1),setTimeout(()=>ne(!1),300)},2e3);return()=>clearTimeout(s)}},[f]),e.jsxs("div",{className:"space-y-8 p-6 md:p-8 max-w-[1600px] mx-auto bg-slate-50/50 min-h-screen animate-fade-in-up",children:[e.jsxs(Ee,{defaultValue:"pending",value:ae,onValueChange:E,className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-2 relative p-1 bg-slate-100/80 h-14 rounded-xl border border-slate-200",children:[e.jsx("div",{className:`absolute top-1 bottom-1 left-1 w-[calc(50%-0.5rem)] rounded-lg bg-white shadow-sm transition-all duration-300 ease-in-out ${ae==="history"?"translate-x-full":"translate-x-0"}`}),e.jsx(Se,{value:"pending",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"Pending System Info"}),e.jsx(Se,{value:"history",className:"z-10 h-full data-[state=active]:bg-transparent data-[state=active]:text-blue-700 data-[state=active]:shadow-none transition-colors duration-200 text-base font-medium text-slate-500",children:"System Info History"})]}),e.jsx(Ce,{value:"pending",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-left-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(as,{className:"h-4 w-4 text-blue-600"})}),"Pending System Information"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[D.length>=2&&e.jsxs(G,{onClick:j,className:"bg-blue-600 hover:bg-blue-700 text-white shadow-md shadow-blue-200 transition-all duration-300 animate-in fade-in slide-in-from-right-4",size:"sm",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"System Info Selected (",D.length,")"]}),e.jsxs($,{variant:"outline",className:"bg-yellow-100 text-yellow-700 border-yellow-200 px-3 py-1",children:[m.length," Pending"]})]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto overflow-y-auto max-h-[calc(100vh-220px)] relative",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center [&_td]:align-middle",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50 sticky top-0 z-10",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-4 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap w-12",children:"Select"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap w-32",children:"Action"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Father's Name"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Block"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"District"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Type"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Company"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Install Status"})]})}),e.jsx(ve,{children:re?Array.from({length:6}).map((s,y)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:11}).map((g,c)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded mx-auto"})},c))},`pending-skel-${y}`)):m.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:11,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(as,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No pending system info tasks"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Completed installations will appear here."})]})})}):m.map(s=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"px-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(ze,{checked:D.includes(s.serialNo),onCheckedChange:y=>se(s.serialNo,y),"aria-label":`Select row ${s.serialNo}`,className:"checkbox-3d border-slate-400 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 h-5 w-5 shadow-sm transition-all duration-300 ease-out active:scale-75 hover:scale-110 data-[state=checked]:scale-110"})})}),e.jsx(a,{children:e.jsxs(G,{size:"sm",disabled:D.length>=2,className:"h-8 px-4 rounded-full bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white border border-blue-200 hover:border-blue-600 transition-all duration-300 shadow-sm text-xs font-semibold flex items-center gap-2 mx-auto disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>de(s),children:[e.jsx(_e,{className:"h-3.5 w-3.5"}),"Process"]})}),e.jsx(a,{className:"text-slate-600 font-mono text-xs",children:s.regId}),e.jsx(a,{className:"font-medium text-slate-800",children:s.beneficiaryName}),e.jsx(a,{className:"text-slate-600",children:s.fatherName}),e.jsx(a,{className:"text-slate-600",children:s.village}),e.jsx(a,{className:"text-slate-600",children:s.block}),e.jsx(a,{className:"text-slate-600",children:s.district}),e.jsx(a,{className:"text-slate-600",children:s.pumpType}),e.jsx(a,{className:"text-slate-600",children:s.company}),e.jsx(a,{children:e.jsx($,{className:"bg-green-100 text-green-700 hover:bg-green-200",children:"Installed"})})]},s.serialNo))})]})}),e.jsx("div",{className:"md:hidden space-y-4 p-4 bg-slate-50",children:m.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white rounded-xl border border-dashed border-slate-200",children:e.jsx("p",{children:"No pending tasks found."})}):m.map(s=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{variant:"secondary",className:"bg-slate-100 text-slate-600",children:s.serialNo}),e.jsx("h4",{className:"font-semibold text-base text-slate-800",children:s.beneficiaryName})]}),e.jsx($,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200 text-xs",children:"Pending Info"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3 text-xs border-t border-b py-3 my-2 border-slate-100",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Village"}),e.jsx("p",{className:"font-medium text-slate-700",children:s.village})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"District"}),e.jsx("p",{className:"font-medium text-slate-700",children:s.district})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Company"}),e.jsx("p",{className:"font-medium text-slate-700",children:s.company})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Pump Type"}),e.jsx("p",{className:"font-medium text-slate-700",children:s.pumpType})]})]}),e.jsxs(G,{size:"sm",disabled:D.length>=2,className:"w-full bg-linear-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white shadow-md disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>de(s),children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Update Info"]})]})},s.serialNo))})]})]})}),e.jsx(Ce,{value:"history",className:"mt-6 focus-visible:ring-0 focus-visible:outline-none animate-in fade-in-0 slide-in-from-right-4 duration-500 ease-out",children:e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-0.5 h-10 flex items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:e.jsx(Ne,{className:"h-4 w-4 text-blue-600"})}),"System Information History"]}),e.jsxs($,{variant:"outline",className:"bg-blue-100 text-blue-700 border-blue-200 px-3 py-1",children:[C.length," Records"]})]})}),e.jsxs(oe,{className:"p-0",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto overflow-y-auto max-h-[calc(100vh-220px)] relative",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center [&_td]:align-middle",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50 sticky top-0 z-10",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Reg ID"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Beneficiary"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Village"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Module Make"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Controller Make"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Pump Make"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Structure Make"}),e.jsx(l,{className:"h-14 px-6 text-xs font-bold text-slate-600 uppercase tracking-wider whitespace-nowrap",children:"Status"})]})}),e.jsx(ve,{children:re?Array.from({length:6}).map((s,y)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:8}).map((g,c)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded mx-auto"})},c))},`history-skel-${y}`)):C.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:8,className:"h-48 text-center text-slate-500 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(Ne,{className:"h-6 w-6 text-slate-400"})}),e.jsx("p",{children:"No processed records yet."})]})})}):C.map(s=>e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"whitespace-nowrap font-mono text-xs text-slate-600",children:s.regId}),e.jsx(a,{className:"whitespace-nowrap font-medium text-slate-800",children:s.beneficiaryName}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.village}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.moduleMake||"-"}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.controllerMake||"-"}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.pumpMake||"-"}),e.jsx(a,{className:"whitespace-nowrap text-slate-600",children:s.structureMake||"-"}),e.jsx(a,{className:"whitespace-nowrap",children:e.jsx($,{className:"bg-green-100 text-green-800 border-green-200",children:"Processed"})})]},s.serialNo))})]})}),e.jsx("div",{className:"md:hidden space-y-4 p-4 bg-slate-50",children:C.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white rounded-xl border border-dashed border-slate-200",children:e.jsx("p",{children:"No processed records yet."})}):C.map(s=>e.jsx(ce,{className:"bg-white border text-sm shadow-sm",children:e.jsxs(oe,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"font-bold text-blue-900 block text-xs tracking-wider",children:s.serialNo}),e.jsx("h4",{className:"font-semibold text-base text-slate-800",children:s.beneficiaryName})]}),e.jsx($,{className:"bg-green-100 text-green-800 text-xs",children:"Processed"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs border-t border-b py-3 my-2 border-slate-100",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Module Make"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.moduleMake||"-"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase font-semibold",children:"Controller"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.controllerMake||"-"})]})]})]})},s.serialNo))})]})]})})]}),e.jsx(Be,{open:X,onOpenChange:Q,children:e.jsx(Te,{showCloseButton:!f,className:`max-w-4xl max-h-[90vh] overflow-y-auto p-0 gap-0 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none] ${f?"bg-transparent !shadow-none !border-none":"bg-white"}`,children:f?e.jsxs("div",{className:"flex flex-col items-center justify-center w-full p-8 text-center space-y-6 animate-in fade-in duration-300",children:[e.jsx("div",{className:"rounded-full bg-white p-5 shadow-2xl shadow-white/20 ring-8 ring-white/10 animate-in zoom-in duration-500 ease-out",children:e.jsx(Ne,{className:"h-16 w-16 text-green-600 scale-110"})}),e.jsx("h2",{className:"text-3xl font-bold text-white drop-shadow-md animate-in slide-in-from-bottom-4 fade-in duration-500 delay-150 ease-out tracking-wide",children:"Saved Successfully!"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{className:"p-6 pb-2 border-b border-blue-100 bg-blue-50/30",children:[e.jsxs(Ue,{className:"text-xl font-bold bg-linear-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 p-1.5 rounded-md",children:e.jsx(as,{className:"h-4 w-4 text-blue-600"})}),"Update System Information"]}),e.jsx(Le,{className:"text-slate-500 ml-10",children:te?e.jsxs("span",{children:["Applying changes to ",e.jsxs("span",{className:"font-bold text-blue-700",children:[D.length," selected items"]}),". All fields below will be updated for these items."]}):e.jsxs("span",{children:["Update technical details for ",e.jsx("span",{className:"font-semibold text-slate-700",children:w==null?void 0:w.beneficiaryName})," ",e.jsx("span",{className:"font-mono text-xs bg-slate-100 px-1 py-0.5 rounded text-slate-600 border border-slate-200",children:w==null?void 0:w.serialNo})]})})]}),(w||te)&&e.jsxs("div",{className:"grid gap-6 p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-800 border-l-4 border-cyan-500 pl-3 uppercase tracking-wide flex items-center gap-2",children:"Technical Specifications"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:[e.jsxs("div",{className:"space-y-2 lg:col-span-3",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Module Make"}),e.jsx(z,{value:p.moduleMake,onChange:s=>T({...p,moduleMake:s.target.value}),placeholder:"e.g. Adani/Tata",className:"h-10 border-slate-200 focus:border-cyan-400"})]}),[1,2,3,4,5,6,7,8,9].map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{className:"text-sm font-medium text-slate-700",children:["Module Serial No ",s]}),e.jsx(z,{value:p[`moduleSerialNo${s}`],onChange:y=>T({...p,[`moduleSerialNo${s}`]:y.target.value}),placeholder:`Serial No ${s}`,className:"h-10 border-slate-200 focus:border-cyan-400"})]},s)),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Controller Make"}),e.jsx(z,{value:p.controllerMake,onChange:s=>T({...p,controllerMake:s.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Controller No"}),e.jsx(z,{value:p.controllerNo,onChange:s=>T({...p,controllerNo:s.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"RMS No"}),e.jsx(z,{value:p.rmsNo,onChange:s=>T({...p,rmsNo:s.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Pump Make"}),e.jsx(z,{value:p.pumpMake,onChange:s=>T({...p,pumpMake:s.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Pump Serial No"}),e.jsx(z,{value:p.pumpSerialNo,onChange:s=>T({...p,pumpSerialNo:s.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Motor Serial No"}),e.jsx(z,{value:p.motorSerialNo,onChange:s=>T({...p,motorSerialNo:s.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-sm font-medium text-slate-700",children:"Structure Make"}),e.jsx(z,{value:p.structureMake,onChange:s=>T({...p,structureMake:s.target.value}),className:"h-10 border-slate-200 focus:border-cyan-400"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4 pt-6 border-t border-slate-100 pb-6 pr-6",children:[e.jsx(G,{variant:"outline",onClick:()=>Q(!1),disabled:U,className:"h-10 px-6 border-slate-200 text-slate-700 hover:bg-slate-100 hover:text-slate-800",children:"Cancel"}),e.jsx(G,{onClick:J,disabled:U,className:"h-10 px-8 bg-linear-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 shadow-lg shadow-blue-500/20 transition-all",children:U?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save System Info"})]})]})]})})})]})}function ct({...m}){return e.jsx(Qs,{"data-slot":"popover",...m})}function ot({...m}){return e.jsx(ea,{"data-slot":"popover-trigger",...m})}function dt({className:m,align:v="center",sideOffset:C=4,..._}){return e.jsx(sa,{children:e.jsx(aa,{"data-slot":"popover-content",align:v,sideOffset:C,className:me("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",m),..._})})}function xt(){const[m,v]=d.useState([]),[C,_]=d.useState(!0),[w,Z]=d.useState(!1),[X,Q]=d.useState(!1),[f,ne]=d.useState([]),[ae,E]=d.useState({}),[re,ee]=d.useState(null),[D,le]=d.useState({userName:"",userId:"",password:"",role:"User",pageAccess:[]}),te=async()=>{_(!0);try{const k="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",p="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo",T=new URLSearchParams({action:"read",sheet:"Login Master",sheetName:"Login Master",id:p.trim()}),u=await fetch(`${k}?${T.toString()}`);if(!u.ok)throw new Error("Network Error");const W=await u.json(),U=Array.isArray(W)?W:W.data||[];if(U.length===0){v([]),_(!1);return}let O=-1;for(let g=0;g<Math.min(U.length,10);g++){const c=U[g];if(!Array.isArray(c))continue;const B=c.map(t=>String(t).toLowerCase().trim());if(B.includes("user name")||B.includes("username")&&B.includes("user id")){O=g;break}}O===-1&&(console.warn("Could not find header row, defaulting to 0"),O=0);const q=U[O],de=q.map(g=>String(g).trim().toLowerCase()),se={userName:de.findIndex(g=>g.includes("user name")||g==="username"),userId:de.findIndex(g=>g.includes("user id")||g==="userid"),password:de.findIndex(g=>g.includes("pass")||g.includes("password")),role:de.findIndex(g=>g.includes("role")),pageAccess:de.findIndex(g=>g.includes("page access")||g.includes("access")),pageName:de.findIndex(g=>g.includes("page name")||g.includes("pagename"))},j=g=>g!==-1?q[g]:null;E(se);let J=U.length+1;for(let g=O+1;g<U.length;g++){const c=U[g];if(!c){J=g+1;break}const B=se.userId!==-1?c[se.userId]:"",t=se.userName!==-1?c[se.userName]:"";if((!B||String(B).trim()==="")&&(!t||String(t).trim()==="")){J=g+1;break}}console.log("Calculated Next Row Index:",J),ee(J);const s=[],y=new Set;for(let g=O+1;g<U.length;g++){const c=U[g];c&&(se.userId!==-1&&c[se.userId]&&s.push({userName:se.userName!==-1?c[se.userName]:"",userId:c[se.userId],password:se.password!==-1?c[se.password]:"",role:se.role!==-1?c[se.role]:"User",pageAccess:se.pageAccess!==-1&&c[se.pageAccess]?String(c[se.pageAccess]).split(",").map(B=>B.trim()).filter(Boolean):[],rowIndex:g+1}),se.pageName!==-1&&c[se.pageName]&&y.add(String(c[se.pageName]).trim()))}v(s),ne(Array.from(y).filter(Boolean).sort())}catch(k){console.error("Fetch Data Error:",k)}finally{_(!1)}};d.useEffect(()=>{te()},[]);const F=k=>{le(p=>{const T=p.pageAccess;return T.includes(k)?{...p,pageAccess:T.filter(u=>u!==k)}:{...p,pageAccess:[...T,k]}})},H=async()=>{Q(!0);try{const k="https://script.google.com/macros/s/AKfycbzYOU_cbVwZpSBDBrkK6lzF7XgKMpTZI46Jxs13OrRqVxr5BbbWKt3CJsxjS-Gikon2ag/exec",p="180TFyvYg0oBVZ8OPWSufuPrhnj3G5LzfmUIBEeFn_bo";if(!re)throw new Error("Could not determine next row index");const T={},u=(de,se)=>{de!==-1&&de!==void 0&&(T[de]=se)};u(ae.userName,D.userName),u(ae.userId,D.userId),u(ae.password,D.password),u(ae.role,D.role),u(ae.pageAccess,D.pageAccess.join(", ")),T[5]="Active";const W=new URLSearchParams({action:"update",sheet:"Login Master",sheetName:"Login Master",id:p,rowIndex:re,rowData:JSON.stringify(T)}),O=await(await fetch(k,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:W})).text();console.log("Server Response:",O);let q;try{q=JSON.parse(O)}catch{if(O.toLowerCase().includes("success")||O.toLowerCase().includes("done"))q={success:!0};else throw new Error("Server returned non-JSON: "+O)}if(q.success||q.status==="success"||q.result==="success")Z(!1),le({userName:"",userId:"",password:"",role:"User",pageAccess:[]}),te();else throw new Error("Failed to add user: "+(q.message||q.error||JSON.stringify(q)))}catch(k){console.error("Submit Error:",k),alert("Error adding user. Please try again.")}finally{Q(!1)}};return e.jsxs("div",{className:"space-y-6 max-w-[1600px] mx-auto pb-10 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-slate-900",children:"User Management"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Manage system users, roles, and access permissions."})]}),e.jsxs(G,{className:"bg-blue-600 hover:bg-blue-700 text-white gap-2 shadow-md hover:shadow-lg transition-all",onClick:()=>Z(!0),children:[e.jsx(cs,{className:"h-4 w-4"}),"Add New User"]})]}),e.jsxs(ce,{className:"border border-blue-100 shadow-xl shadow-blue-100/20 bg-white/80 backdrop-blur-sm overflow-hidden",children:[e.jsx(ge,{className:"border-b border-blue-50 bg-blue-50/30 px-6 py-1",children:e.jsxs(je,{className:"text-lg font-semibold text-blue-900 flex items-center gap-2",children:[e.jsx(ys,{className:"h-5 w-5 text-blue-600"}),"Registered Users"]})}),e.jsx(oe,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(we,{className:"[&_th]:text-center [&_td]:text-center",children:[e.jsx(ye,{className:"bg-gradient-to-r from-blue-50/50 to-cyan-50/50",children:e.jsxs(R,{className:"border-b border-blue-100 hover:bg-transparent",children:[e.jsx(l,{className:"h-12 font-bold text-slate-600 w-[150px]",children:"User Name"}),e.jsx(l,{className:"h-12 font-bold text-slate-600 w-[120px]",children:"User ID"}),e.jsx(l,{className:"h-12 font-bold text-slate-600 w-[120px]",children:"Password"}),e.jsx(l,{className:"h-12 font-bold text-slate-600 w-[100px]",children:"Role"}),e.jsx(l,{className:"h-12 font-bold text-slate-600 w-[250px]",children:"Page Access"})]})}),e.jsx(ve,{children:C?Array.from({length:5}).map((k,p)=>e.jsx(R,{className:"animate-pulse",children:Array.from({length:5}).map((T,u)=>e.jsx(a,{children:e.jsx("div",{className:"h-4 bg-slate-100 rounded w-2/3 mx-auto"})},u))},p)):m.length===0?e.jsx(R,{children:e.jsx(a,{colSpan:5,className:"h-32 text-center text-slate-500",children:"No users found."})}):m.map((k,p)=>{var T;return e.jsxs(R,{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx(a,{className:"font-medium text-slate-800",children:k.userName}),e.jsx(a,{className:"font-mono text-xs text-slate-500",children:k.userId}),e.jsx(a,{className:"font-mono text-xs text-slate-500 tracking-wider",children:k.password}),e.jsx(a,{children:e.jsx($,{variant:"outline",className:me("uppercase text-[10px] tracking-wider",((T=k.role)==null?void 0:T.toLowerCase())==="admin"?"bg-blue-50 text-blue-700 border-blue-200":"bg-slate-50 text-slate-700 border-slate-200"),children:k.role})}),e.jsx(a,{children:e.jsx("div",{className:"max-w-[250px] mx-auto text-xs text-slate-600 font-medium whitespace-normal break-words text-center",children:k.pageAccess&&k.pageAccess.length>0?k.pageAccess.join(", "):e.jsx("span",{className:"text-slate-400 italic",children:"No Access"})})})]},p)})})]})})})]}),e.jsx(Be,{open:w,onOpenChange:Z,children:e.jsxs(Te,{className:"max-w-md",children:[e.jsxs(Oe,{children:[e.jsxs(Ue,{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(cs,{className:"h-5 w-5"}),"Add New User"]}),e.jsx(Le,{children:"Create a new user and assign permissions."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"userName",children:"User Name"}),e.jsx(z,{id:"userName",placeholder:"e.g. John Doe",value:D.userName,onChange:k=>le({...D,userName:k.target.value}),className:"focus-visible:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"userId",children:"User ID"}),e.jsx(z,{id:"userId",placeholder:"e.g. user123",value:D.userId,onChange:k=>le({...D,userId:k.target.value}),className:"focus-visible:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"password",children:"Password"}),e.jsx(z,{id:"password",placeholder:"Secret key",value:D.password,onChange:k=>le({...D,password:k.target.value}),className:"focus-visible:ring-blue-500"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Role"}),e.jsxs(Xe,{value:D.role,onValueChange:k=>le({...D,role:k}),children:[e.jsx(es,{className:"focus:ring-blue-500 hover:bg-transparent hover:text-slate-900 border-slate-200 hover:border-blue-300 transition-colors",children:e.jsx(Qe,{placeholder:"Select Role"})}),e.jsxs(ss,{className:"border-blue-50",children:[e.jsx(Me,{value:"Admin",className:"focus:bg-blue-50 focus:text-slate-900 cursor-pointer",children:"Admin"}),e.jsx(Me,{value:"User",className:"focus:bg-blue-50 focus:text-slate-900 cursor-pointer",children:"User"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Page Access"}),e.jsxs(ct,{children:[e.jsx(ot,{asChild:!0,children:e.jsxs(G,{variant:"outline",className:"w-full justify-between text-left font-normal bg-white border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 active:scale-100 hover:border-blue-300 hover:bg-slate-50 hover:text-slate-900 transition-all",children:[e.jsx("span",{className:me("truncate",D.pageAccess.length===0&&"text-muted-foreground"),children:D.pageAccess.length>0?`${D.pageAccess.length} Selected`:"Select Pages"}),e.jsx(va,{className:"ml-2 h-4 w-4 shrink-0 opacity-50 text-slate-500"})]})}),e.jsx(dt,{className:"w-[300px] p-0 shadow-lg border-blue-50",align:"start",children:e.jsx("div",{className:"h-[300px] overflow-y-auto scrollbar-thin scrollbar-thumb-blue-200 scrollbar-track-transparent",children:e.jsx("div",{className:"p-2 grid gap-1",children:f.length===0?e.jsx("div",{className:"p-2 text-sm text-slate-500 text-center",children:"No pages found in sheet."}):f.map(k=>e.jsxs("div",{className:`\r
                                                    flex items-center space-x-2 p-2\r
                                                    hover:bg-blue-50\r
                                                    rounded-md cursor-pointer\r
                                                    transition-colors\r
                                                `,onClick:()=>F(k),children:[e.jsx(ze,{id:`page-${k}`,checked:D.pageAccess.includes(k),onCheckedChange:()=>F(k),className:`\r
                                                        border-slate-300\r
                                                        data-[state=checked]:bg-blue-600\r
                                                        data-[state=checked]:border-blue-600\r
                                                        focus-visible:ring-2\r
                                                        focus-visible:ring-blue-500\r
                                                        focus-visible:ring-offset-2\r
                                                        hover:border-blue-400\r
                                                    `}),e.jsx("label",{htmlFor:`page-${k}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer flex-1",children:k})]},k))})})})]}),D.pageAccess.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:D.pageAccess.map(k=>e.jsx($,{variant:"secondary",className:"text-[10px] bg-blue-50 text-blue-600 hover:bg-blue-100",children:k},k))})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-50 mt-4",children:[e.jsx(G,{variant:"outline",className:"border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900",onClick:()=>Z(!1),disabled:X,children:"Cancel"}),e.jsxs(G,{className:"bg-blue-600 hover:bg-blue-700 text-white shadow-md shadow-blue-600/20",onClick:H,disabled:X||!D.userName||!D.userId,children:[X?e.jsx(Ze,{className:"h-4 w-4 animate-spin mr-2"}):null,"Save User"]})]})]})})]})}function mt({children:m}){return e.jsx(Re,{children:e.jsxs("div",{className:"flex h-dvh md:h-screen",children:[e.jsx(Ie,{}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden min-h-0",children:[e.jsx(Pe,{}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto p-4 md:p-6 bg-background",children:e.jsx(fe,{})}),e.jsx(Ae,{className:"h-8 md:h-12 shrink-0"})]})]})})}function ht(){return e.jsx(Cs,{children:e.jsxs(Ds,{children:[e.jsx(be,{path:"/",element:e.jsx(ka,{})}),e.jsx(be,{path:"/login",element:e.jsx(at,{})}),e.jsx(be,{path:"/dashboard",element:e.jsx(Ba,{children:e.jsx(fe,{})}),children:e.jsx(be,{index:!0,element:e.jsx(Ka,{})})}),e.jsx(be,{path:"/foundation",element:e.jsx(Ta,{children:e.jsx(fe,{})}),children:e.jsx(be,{index:!0,element:e.jsx(qa,{})})}),e.jsx(be,{path:"/installation",element:e.jsx(Oa,{children:e.jsx(fe,{})}),children:e.jsx(be,{index:!0,element:e.jsx(Xa,{})})}),e.jsx(be,{path:"/insurance",element:e.jsx(Ua,{children:e.jsx(fe,{})}),children:e.jsx(be,{index:!0,element:e.jsx(Qa,{})})}),e.jsx(be,{path:"/jcc-completion",element:e.jsx(La,{children:e.jsx(fe,{})}),children:e.jsx(be,{index:!0,element:e.jsx(et,{})})}),e.jsx(be,{path:"/jcc-status",element:e.jsx(za,{children:e.jsx(fe,{})}),children:e.jsx(be,{index:!0,element:e.jsx(st,{})})}),e.jsx(be,{path:"/loi-mr",element:e.jsx(mt,{children:e.jsx(fe,{})}),children:e.jsx(be,{index:!0,element:e.jsx(tt,{})})}),e.jsx(be,{path:"/payment",element:e.jsx(_a,{children:e.jsx(fe,{})}),children:e.jsx(be,{index:!0,element:e.jsx(lt,{})})}),e.jsx(be,{path:"/portal",element:e.jsx(Ea,{children:e.jsx(fe,{})}),children:e.jsx(be,{index:!0,element:e.jsx(rt,{})})}),e.jsx(be,{path:"/sanction",element:e.jsx($a,{children:e.jsx(fe,{})}),children:e.jsx(be,{index:!0,element:e.jsx(nt,{})})}),e.jsx(be,{path:"/system-info",element:e.jsx(Va,{children:e.jsx(fe,{})}),children:e.jsx(be,{index:!0,element:e.jsx(it,{})})}),e.jsx(be,{path:"/setting",element:e.jsx(Ja,{children:e.jsx(fe,{})}),children:e.jsx(be,{index:!0,element:e.jsx(xt,{})})})]})})}Is.createRoot(document.getElementById("root")).render(e.jsx(Ps.StrictMode,{children:e.jsx(ht,{})}));
